## 三、MODBUS 通讯

启用 MODBUS 通讯，并开启目标机台/机组的自动采集任务（详见《说明书》5.3.1. 添加机台下的各类型机台的任务设置，以及 5.4.1.2. 机组任务设置）后，网关会基于 MODBUS 协议，将自动采集任务结果数据存在相应地址中。MODBUS 通讯地址为\<网关 IP\>，端口为 502。使用 MODBUS 通讯，机床最后一段 IP 作为从站 ID 区分。如机床 IP 为 192.168.100.2，该机床对应从站 ID 为 2。使用 MODBUS 时，机床最后一段 IP 不可设置为 0（0 为网关保留从站），且同一网关下连接的各机床 IP 最后一段必须各不相同，否则会出现数据识别别错误。用户可以参照《说明书》5.6.2.MODBUS 配置的说明配置 MODBUS 服务。

**注：网关 MODBUS 服务端地址位设置基于 0 位，客户端如基于 1 位时相应地址位需要加 1。**

---

### 3.1 机台相关数据

MODBUS 数据地址如下：

| 地址 | 名称 | 数据类型 | 单位 | 备注 |
|------|------|----------|------|------|
| 400010 | 连接状态 | UInt16 | – | 1=已连接；2=未连接；3=错误 |
| 400011 | 报警数 | UInt16 | 条 | 当前报警数量 |
| 400012 | CNC 运行状态 | Int16 | – | 当前运行状态码，详见 5.1. 机台状态 |
| 400013 | 累计警报数 | UInt32 | 条 | |
| 400015 | 累计警报时间 | UInt32 | 秒 | |
| 400040~400075 | 第 1 至第 18 轴名称 | String(4) | – | 以 MODBUS 配置中设定的编码转换为长度为 4 的 Byte 数组（2 个地址位）。 |
| 400100 | 加工计数 | UInt32 | 件 | 从机台系统获取的加工计数 |
| 400102 | 主轴倍率 | Float | % | 主轴转速倍率 |
| 400104 | 主轴转速 | Float | 同机床设置 | 进给量倍率 |
| 400106 | 进给倍率 | Float | % | |
| 400108 | 进给速度 | Float | 同机床设置 | |
| 400110~400115 | 第 1 至第 3 主轴负载 | Float | % | |
| 400120 | 快速进给倍率 | Float | % | |
| 400172 | 累计通电时间 1 | Int32 | 分钟 | 时间计算方式详见 1.2.25.ToolLife：刀具寿命数据。如时间数值为 -2147483648，代表机床系统型号不支持该时间数据。 |
| 400174 | 累计通电时间 2 | Int32 | 毫秒 | |
| 400176 | 当前通电时间 1 | Int32 | 分钟 | |
| 400178 | 当前通电时间 2 | Int32 | 毫秒 | |
| 400180 | 累计运行时间 1 | Int32 | 分钟 | |
| 400182 | 累计运行时间 2 | Int32 | 毫秒 | |
| 400184 | 当前运行时间 1 | Int32 | 分钟 | |
| 400186 | 当前运行时间 2 | Int32 | 毫秒 | |
| 400188 | 累计加工时间 1 | Int32 | 分钟 | |
| 400190 | 累计加工时间 2 | Int32 | 毫秒 | |
| 400192 | 当前加工时间 1 | Int32 | 分钟 | |
| 400194 | 当前加工时间 2 | Int32 | 毫秒 | |
| 400196 | 上次循环时间 1 | Int32 | 分钟 | |
| 400198 | 上次循环时间 2 | Int32 | 毫秒 | |
| 400200 | 当前循环时间 1 | Int32 | 分钟 | |
| 400202 | 当前循环时间 2 | Int32 | 毫秒 | |
| 400204 | 当前切削时间 1 | Int32 | 分钟 | |
| 400206 | 当前切削时间 2 | Int32 | 毫秒 | |
| 400208 | 剩余循环时间 1 | Int32 | 分钟 | |
| 400210 | 剩余循环时间 2 | Int32 | 毫秒 | |
| 400220 | 当前刀号 | String(16) | – | 以 MODBUS 配置中设定的编码转换为长度为 16 的 Byte 数组（8 个地址位）。 |
| 400228 | 运行程序名 | String(32) | – | 当前执行子程序名 |
| 400244 | 主程序名 | String(32) | – | 当前主程序名 |
| 400260 | 运行程序段顺序号 | String(16) | – | 当前执行子程序段顺序号 |
| 400268 | 当前程序段 | String(70) | – | 当前运行的程序段内容 |
| 400498 | 当前加工计数 | UInt32 | 件 | 当前监控时间内的加工计数 |
| 400500 | 累计加工计数 | UInt32 | 件 | |
| 400502 | 关机时间 | UInt32 | 秒 | |
| 400504 | 急停时间 | UInt32 | 秒 | |
| 400506 | 待机时间 | UInt32 | 秒 | |
| 400508 | 自动运行时间 | UInt32 | 秒 | |
| 400510 | 调机时间 | UInt32 | 秒 | |
| 400512 | 机台监控开动率 | Float | % | |
| 400520 | 累计关机时间 | UInt32 | 秒 | |
| 400522 | 累计急停时间 | UInt32 | 秒 | |
| 400524 | 累计待机时间 | UInt32 | 秒 | |
| 400526 | 累计自动运行时间 | UInt32 | 秒 | |
| 400528 | 累计调机时间 | UInt32 | 秒 | |
| 400546 | 上次节拍时间 | UInt32 | 秒 | |
| 400600 | 程序堆栈 | String(128) | – | 以 MODBUS 配置中设定的编码转换为长度为 128 的 Byte 数组（64 个地址位）。 |
| 400664 | 当前刀补号 | String(16) | – | |
| 400900 | 预设功率 | Float | % | 激光切割机预设功率 |
| 400902 | 实际功率 | Float | % | 激光切割机实际功率 |
| 401100~401135 | 第 1 至第 18 轴负载 | Float | % | |
| 401136~401171 | 第 1 至第 18 轴机械坐标 | Float | 同机床设置 | |
| 401172~401207 | 第 1 至第 18 轴相对坐标 | Float | 同机床设置 | |
| 401208~401243 | 第 1 至第 18 轴剩余距离 | Float | 同机床设置 | |
| 401244~401279 | 第 1 至第 18 轴绝对坐标 | Float | 同机床设置 | |
| 401400~401405 | 第 1 至第 3 主轴累计过载时间 | UInt32 | 毫秒 | |
| 401410~401445 | 第 1 至第 18 轴累计过载时间 | UInt32 | 毫秒 | |
| 405000 | 警报 1 | String(200) | – | 含警报内容，时间，级别 |
| 405100 | 警报 2 | String(200) | – | 同上 |
| 405200 | 警报 3 | String(200) | – | 同上 |
| 405300 | 警报 4 | String(200) | – | 同上 |
| 405400 | 警报 5 | String(200) | – | 同上 |
| 420000~429999 | 第 1 至 10000 位 PLC 数据 | UInt16 | – | PLC 任务数据与外部 PLC 任务数据，PLC 任务数据在前，外部 PLC 任务数据在后，按照任务顺序排列。32 位型数据，64 位型数据，String 类型数据，以 MODBUS 配置中设定的方式转换为 UInt16。 |

**注 1：** 累计警报数与累计加工计数为自从网关开始自动采集这台设备，累计的警报数与加工计数。这两个值保存在网关中，与 machineID（即机床 IP 后两段）绑定，不会被重置。

**注 2：** 400502-400510 各机台状态时间是机台在监控时间内的各状态时间。400512 机台开动率是机台在监控时间内的开动率。详见《说明书》6.1.1. 机台 OEE 数据。

**注 3：** String(200)表示这个 String 以设置的编码（详见《说明书》5.6.2.MODBUS 配置）转换为长度为 200 的 Byte 数组，换算成 MODBUS 地址位（UInt16）为 100 个地址位。

**注 4：** 上次节拍时间由网关机台节拍数据任务监测。如网关重启后第一个节拍尚未结束，此数值为 0。上次节拍时间定义上与上次循环时间相同，但前者由网关统计，所有可统计产量与状态的机台都支持。后者由机台本身提供，只有部分机台支持。

---

### 3.2 机组相关数据

机组相关数据统一保存于从站 0 中，数据地址如下：

| 地址 | 名称 | 数据类型 | 单位 | 备注 |
|------|------|----------|------|------|
| 400100 | 机组 1 累计加工计数 | UInt32 | 件 | |
| 400102 | 当前机组 1 中关机机台数量 | Int16 | 台 | |
| 400103 | 当前机组 1 中急停机台数量 | Int16 | 台 | |
| 400104 | 当前机组 1 中待机机台数量 | Int16 | 台 | |
| 400105 | 当前机组 1 中自动运行机台数量 | Int16 | 台 | |
| 400106 | 当前机组 1 中调机机台数量 | Int16 | 台 | |
| 400110 | 机组 1 关机时间 | UInt32 | 秒 | |
| 400112 | 机组 1 急停时间 | UInt32 | 秒 | |
| 400114 | 机组 1 待机时间 | UInt32 | 秒 | |
| 400116 | 机组 1 自动运行时间 | UInt32 | 秒 | |
| 400118 | 机组 1 调机时间 | UInt32 | 秒 | |
| 400120 | 机组 1 监控开动率 | Float | % | |
| 400130 | 机组 1 累计关机时间 | UInt32 | 秒 | |
| 400132 | 机组 1 累计急停时间 | UInt32 | 秒 | |
| 400134 | 机组 1 累计待机时间 | UInt32 | 秒 | |
| 400136 | 机组 1 累计自动运行时间 | UInt32 | 秒 | |
| 400138 | 机组 1 累计调机时间 | UInt32 | 秒 | |
| 400200~400299 | 机组 2（相应地址为组 1 对应名称地址加 100） | | | |
| …… | | | | |
| 401600~401699 | 机组 16（相应地址为组 1 对应名称地址加 1500） | | | |

**注 1：** 400100 机组累计加工计数为自从网关开始自动采集这组设备，累计的加工机数。详见《说明书》6.1.3. 机组加工计数。

**注 2：** 400110-400118 机组各状态时间是机组中所有激活状态的机台在监控时间内的各状态时间之和。400120 机组监控开动率是机组在监控时间内的机组开动率。详见《说明书》6.1.2. 机组 OEE 数据。
