## 五、数据库通讯

启用数据库通讯，并开启目标机台/机组的自动采集任务（详见《说明书》5.3.1. 添加机台下的各类型机台的任务设置，以及 5.4.1.2. 机组任务设置）后，网关将自动采集任务结果写入到指定数据库。当前支持的数据库类型包括：InfluxDB v2.x、MySQL、SQL Server、PostgreSQL 等。用户可以参照《说明书》5.6.4. 数据库配置的说明配置数据库服务。

数据库表名为**[表前缀][数据类]**的形式，其中表前缀在网关通讯配置页设置，详见《说明书》5.6.4. 数据库配置；数据库表名称与 MQTT 通讯中的数据类 `type` 相同（详见 1.2. 数据说明）。如下为未设置表前缀、保存模式为日志模式时，数据库各表名（示例）：

| 表名 |
|------|
| alarmhistory |
| alarmlog |
| cncstatus |
| count |
| currenttoolnumber |
| cycle |
| energyconsum |
| feedandspindle |
| groupcount |
| groupcumulative... |
| groupoee |
| load |
| loghistory |
| machine |
| oee |
| offset |
| plc |
| position |
| programblock |
| programinfo |
| timedata |
| toollife |

数据库各表中的字段与对应数据类 `type` 中的数据标签 tag 和数据字段 field 相同（详见 1.2. 数据说明）。以表 `cncStatus` 为例，其表字段包括：

| 字段名 | 数据类型 |
|--------|----------|
| id | BIGINT（自动递增） |
| cncStatus | TEXT |
| adjustedStatus | TEXT |
| alarmStatus | TEXT |
| alarmLevel | TEXT |
| offTime | BIGINT |
| waitTime | BIGINT |
| emergencyTime | BIGINT |
| autoRunTime | BIGINT |
| manualTime | BIGINT |
| channel | VARCHAR(128) |
| machineID | VARCHAR(128) |
| time | DATETIME |
| uid | VARCHAR(128) |
