# 彼络物联网关通讯协议 v1.19.4
<div align="center">
  <h3>深圳市彼络科技有限公司</h3>
  联系电话：18824672282<br>
  <img width="200" height="200" alt="image" src="https://github.com/user-attachments/assets/5669fd4a-db92-4f91-b94b-3b422271b9a7" />
</div>
---

> 本文件所含的信息系彼络科技的专属信息，以保密形式披露。未经彼络科技明示的书面同意，任何人不得使用或向其他任何人披露或复制此等信息。
>
> © BIVROST TECHONOLOGIES Company Limited, 2026
> © 深圳市彼络科技有限公司，2026

---

## 目录

- [一、重要说明](#一重要说明)
  - [1.1 标识说明](#11-标识说明)
    - [1.1.1 machineID 机台标识](#111-machineid-机台标识)
    - [1.1.2 groupID 机组标识](#112-groupid-机组标识)
    - [1.1.3 slaveID 从站标识](#113-slaveid-从站标识)
    - [1.1.4 ID 数据库标识](#114-id-数据库标识)
  - [1.2 数据说明](#12-数据说明)
    - [1.2.1 AlarmHistory：警报历史](#121-alarmhistory警报历史)
    - [1.2.2 AlarmLog：当前警报](#122-alarmlog当前警报)
    - [1.2.3 AxialOverload：伺服轴过载数据](#123-axialoverload伺服轴过载数据)
    - [1.2.4 CNCStatus：机台状态](#124-cncstatus机台状态)
    - [1.2.5 Count：加工计数](#125-count加工计数)
    - [1.2.6 CurrentToolNumber：当前刀号](#126-currenttoolnumber当前刀号)
    - [1.2.7 Cycle：节拍数据](#127-cycle节拍数据)
    - [1.2.8 EnergyConsum：能耗数据](#128-energyconsum能耗数据)
    - [1.2.9 Feed：进给数据](#129-feed进给数据)
    - [1.2.10 FeedAndSpindle：进给倍率数据](#1210-feedandspindle进给倍率数据)
    - [1.2.11 GroupCount：机组加工计数](#1211-groupcount机组加工计数)
    - [1.2.12 GroupCumulativeTime：机组累计状态时间](#1212-groupcumulativetime机组累计状态时间)
    - [1.2.13 GroupOEE：机组 OEE](#1213-groupoee机组-oee)
    - [1.2.14 LaserPower：激光功率](#1214-laserpower激光功率)
    - [1.2.15 Load：负载数据](#1215-load负载数据)
    - [1.2.16 LogHistory：日志历史](#1216-loghistory日志历史)
    - [1.2.17 OEE：机台 OEE 数据](#1217-oee机台-oee-数据)
    - [1.2.18 Offset：刀补数据](#1218-offset刀补数据)
    - [1.2.19 PLC：PLC 数据](#1219-plcplc-数据)
    - [1.2.20 Position：坐标数据](#1220-position坐标数据)
    - [1.2.21 ProgramBlock：程序段](#1221-programblock程序段)
    - [1.2.22 ProgramInfo：当前程序](#1222-programinfo当前程序)
    - [1.2.23 SpindleOverLoad：主轴过载数据](#1223-spindleoverload主轴过载数据)
    - [1.2.24 TimeData：机台时间数据](#1224-timedata机台时间数据)
    - [1.2.25 ToolLife：刀具寿命数据](#1225-toollife刀具寿命数据)
  - [1.3 变量说明](#13-变量说明)
    - [1.3.1 机台状态](#131-机台状态)
    - [1.3.2 警报信息](#132-警报信息)
    - [1.3.3 服务信息](#133-服务信息)

- [二、HTTP 通讯](#二http-通讯)
  - [2.1 基本说明](#21-基本说明)
  - [2.2 错误处理](#22-错误处理)
  - [2.3 鉴权方式](#23-鉴权方式)
  - [2.4 鉴权接口](#24-鉴权接口)
  - [2.5 数据读写接口](#25-数据读写接口)
    - [2.5.1 直接读写](#251-直接读写)
    - [2.5.2 缓存读取](#252-缓存读取)
  - [2.6 文件管理接口](#26-文件管理接口)
  - [2.7 数据分析接口](#27-数据分析接口)
  - [2.8 历史数据接口](#28-历史数据接口)
  - [2.9 网关配置接口](#29-网关配置接口)
  - [2.10 网关功能接口](#210-网关功能接口)

- [三、MODBUS 通讯](#三modbus-通讯)
  - [3.1 机台相关数据](#31-机台相关数据)
  - [3.2 机组相关数据](#32-机组相关数据)

- [四、MQTT 通讯](#四mqtt-通讯)
  - [4.1 数据上报报文格式](#41-数据上报报文格式)
  - [4.2 RPC 接口](#42-rpc-接口)

- [五、数据库通讯](#五数据库通讯)

- [六、模拟机台测试](#六模拟机台测试)

- [七、常见问题](#七常见问题)

- [版本变更历史记录](#版本变更历史记录)

---

## 表格索引

| 表格编号 | 表格名称 | 所在文件 |
|---------|---------|---------|
| 表格 1 | 数据类 | [01_重要说明.md](#一重要说明) |
| 表格 2 | 警报历史 \<field\> 数据字段 | [01_重要说明.md](#一重要说明) |
| 表格 3 | 当前警报 \<field\> 数据字段 | [01_重要说明.md](#一重要说明) |
| 表格 4 | 伺服轴过载数据 \<field\> 数据字段 | [01_重要说明.md](#一重要说明) |
| 表格 5 | 伺服轴过载数据 \<tag\> 数据标签 | [01_重要说明.md](#一重要说明) |
| 表格 6 | 机台状态 \<field\> 数据字段 | [01_重要说明.md](#一重要说明) |
| 表格 7 | 机台状态 \<tag\> 数据标签 | [01_重要说明.md](#一重要说明) |
| 表格 8 | 加工计数 \<field\> 数据字段 | [01_重要说明.md](#一重要说明) |
| 表格 10 | 当前刀号 \<field\> 数据字段 | [01_重要说明.md](#一重要说明) |
| 表格 11 | 当前刀号 \<tag\> 数据标签 | [01_重要说明.md](#一重要说明) |
| 表格 12 | 节拍数据 \<field\> 数据字段 | [01_重要说明.md](#一重要说明) |
| 表格 13 | 能耗数据 \<field\> 数据字段 | [01_重要说明.md](#一重要说明) |
| 表格 14 | 进给数据 \<field\> 数据字段 | [01_重要说明.md](#一重要说明) |
| 表格 15 | 进给数据 \<tag\> 数据标签 | [01_重要说明.md](#一重要说明) |
| 表格 16 | 进给倍率数据 \<field\> 数据字段 | [01_重要说明.md](#一重要说明) |
| 表格 17 | 进给倍率数据 \<tag\> 数据标签 | [01_重要说明.md](#一重要说明) |
| 表格 18 | 机组加工计数 \<field\> 数据字段 | [01_重要说明.md](#一重要说明) |
| 表格 19 | 机组累计状态时间 \<field\> 数据字段 | [01_重要说明.md](#一重要说明) |
| 表格 20 | 机组 OEE \<field\> 数据字段 | [01_重要说明.md](#一重要说明) |
| 表格 21 | 激光功率 \<field\> 数据字段 | [01_重要说明.md](#一重要说明) |
| 表格 22 | 负载数据 \<field\> 数据字段 | [01_重要说明.md](#一重要说明) |
| 表格 23 | 负载数据 \<tag\> 数据标签 | [01_重要说明.md](#一重要说明) |
| 表格 24 | 日志历史 \<field\> 数据字段 | [01_重要说明.md](#一重要说明) |
| 表格 25 | 机台 OEE \<field\> 数据字段 | [01_重要说明.md](#一重要说明) |
| 表格 26 | 刀补数据 \<field\> 数据字段 | [01_重要说明.md](#一重要说明) |
| 表格 27 | 刀补数据 \<tag\> 数据标签 | [01_重要说明.md](#一重要说明) |
| 表格 28 | 刀补数据标签组合 | [01_重要说明.md](#一重要说明) |
| 表格 29 | PLC 数据 \<field\> 数据字段 | [01_重要说明.md](#一重要说明) |
| 表格 30 | PLC 数据 \<tag\> 数据标签 | [01_重要说明.md](#一重要说明) |
| 表格 31 | 坐标数据 \<field\> 数据字段 | [01_重要说明.md](#一重要说明) |
| 表格 32 | 坐标数据 \<tag\> 数据标签 | [01_重要说明.md](#一重要说明) |
| 表格 33 | 程序段 \<field\> 数据字段 | [01_重要说明.md](#一重要说明) |
| 表格 34 | 程序段 \<tag\> 数据标签 | [01_重要说明.md](#一重要说明) |
| 表格 35 | 当前程序 \<field\> 数据字段 | [01_重要说明.md](#一重要说明) |
| 表格 36 | 当前程序 \<tag\> 数据标签 | [01_重要说明.md](#一重要说明) |
| 表格 37 | 主轴过载数据 \<field\> 数据字段 | [01_重要说明.md](#一重要说明) |
| 表格 38 | 主轴过载数据 \<tag\> 数据标签 | [01_重要说明.md](#一重要说明) |
| 表格 39 | 机台时间数据 \<field\> 数据字段 | [01_重要说明.md](#一重要说明) |
| 表格 40 | 各系统型号支持的时间数据 | [01_重要说明.md](#一重要说明) |
| 表格 41 | 刀具寿命数据 \<field\> 数据字段 | [01_重要说明.md](#一重要说明) |
| 表格 42 | 刀具寿命数据 \<tag\> 数据标签 | [01_重要说明.md](#一重要说明) |
| 表格 43 | 刀具寿命数据标签组合 | [01_重要说明.md](#一重要说明) |
| 表格 44 | 刀具寿命类型 | [01_重要说明.md](#一重要说明) |
| 表格 45 | 运行状态 | [01_重要说明.md](#一重要说明) |
| 表格 46 | 警报状态 | [01_重要说明.md](#一重要说明) |
| 表格 47 | 急停状态 | [01_重要说明.md](#一重要说明) |
| 表格 48 | 试运行状态 | [01_重要说明.md](#一重要说明) |
| 表格 49 | 警报级别 | [01_重要说明.md](#一重要说明) |
| 表格 50 | 网关服务运行状态 | [01_重要说明.md](#一重要说明) |
| 表格 51 | 常见错误代码 | [02_HTTP通讯_基础.md](#二http-通讯) |
| 表格 52 | PLC 数据通用区域与参数 | [03_HTTP通讯_数据读写.md](#25-数据读写接口) |
| 表格 53 | PLC 数据特殊区域与参数 | [03_HTTP通讯_数据读写.md](#25-数据读写接口) |
| 表格 54 | PLC 地址位进制前级 | [03_HTTP通讯_数据读写.md](#25-数据读写接口) |
| 表格 55 | PLC 数据类型 | [03_HTTP通讯_数据读写.md](#25-数据读写接口) |
| 表格 56 | 各系统型号默认根目录路径 | [04_HTTP通讯_文件管理.md](#26-文件管理接口) |
| 表格 57 | 各系统型号读取机台文件列表接口对获取子文件夹列表支持 | [04_HTTP通讯_文件管理.md](#26-文件管理接口) |
| 表格 58 | 系统型号对创建/删除机台目录接口的支持 | [04_HTTP通讯_文件管理.md](#26-文件管理接口) |
| 表格 59 | API 命令格式 | [07_HTTP通讯_网关配置.md](#29-网关配置接口) |
| 表格 60 | 机台配置参数 | [07_HTTP通讯_网关配置.md](#29-网关配置接口) |
| 表格 61 | machineType 对应机台类型 | [07_HTTP通讯_网关配置.md](#29-网关配置接口) |
| 表格 62 | 机组配置参数 | [07_HTTP通讯_网关配置.md](#29-网关配置接口) |
| 表格 63 | machines 机台列表信息 | [07_HTTP通讯_网关配置.md](#29-网关配置接口) |
| 表格 64 | 机台任务间隔设置参数 | [07_HTTP通讯_网关配置.md](#29-网关配置接口) |
| 表格 65 | 机组任务间隔设置参数 | [07_HTTP通讯_网关配置.md](#29-网关配置接口) |
| 表格 66 | OEE 监控设置参数 | [07_HTTP通讯_网关配置.md](#29-网关配置接口) |
| 表格 67 | monitorMode 监控模式 | [07_HTTP通讯_网关配置.md](#29-网关配置接口) |
| 表格 68 | availabilityMode 开动率计算方式 | [07_HTTP通讯_网关配置.md](#29-网关配置接口) |
| 表格 69 | 刀具寿命监控设置参数 | [07_HTTP通讯_网关配置.md](#29-网关配置接口) |
| 表格 70 | 加工计数监控设置参数 | [07_HTTP通讯_网关配置.md](#29-网关配置接口) |
| 表格 71 | 过载监控设置参数 | [07_HTTP通讯_网关配置.md](#29-网关配置接口) |
| 表格 72 | 警报监控设置参数 | [07_HTTP通讯_网关配置.md](#29-网关配置接口) |
| 表格 73 | minimumAlarmLevel 最低报警级别 | [07_HTTP通讯_网关配置.md](#29-网关配置接口) |
| 表格 74 | 机台状态监控设置参数 | [07_HTTP通讯_网关配置.md](#29-网关配置接口) |
| 表格 75 | 云平台设置参数 | [07_HTTP通讯_网关配置.md](#29-网关配置接口) |
| 表格 76 | MODBUS 设置参数 | [07_HTTP通讯_网关配置.md](#29-网关配置接口) |
| 表格 77 | MQTT 设置参数 | [07_HTTP通讯_网关配置.md](#29-网关配置接口) |
| 表格 78 | MQTT mode 模式 | [07_HTTP通讯_网关配置.md](#29-网关配置接口) |
| 表格 79 | 数据库设置参数 | [07_HTTP通讯_网关配置.md](#29-网关配置接口) |
| 表格 80 | 数据库类型 | [07_HTTP通讯_网关配置.md](#29-网关配置接口) |
| 表格 81 | 数据库保存模式 | [07_HTTP通讯_网关配置.md](#29-网关配置接口) |
| 表格 82 | 网关文件服务器设置参数 | [07_HTTP通讯_网关配置.md](#29-网关配置接口) |
| 表格 83 | HTTP 设置参数 | [07_HTTP通讯_网关配置.md](#29-网关配置接口) |
| 表格 84 | Hub 设置参数 | [07_HTTP通讯_网关配置.md](#29-网关配置接口) |
| 表格 85 | 远程访问设置参数 | [07_HTTP通讯_网关配置.md](#29-网关配置接口) |


---

# 一、重要说明

用户在阅读本文档时，有些解释内容可以参考《彼络物联网关说明书》（以下简称为《说明书》）。

本章节解释的内容，应用于后续的章节中。用户可以在具体使用中根据引用提示查找本章节的说明内容。

---

## 1.1 标识说明

在通讯中使用到的标识有 machineID 机台标识，groupID 机组标识，slaveID 从站标识，ID 数据库标识，以及 ID 文件标识。

### 1.1.1 machineID 机台标识

网关支持同时连接多台机台设备，需要为每台连接的设备定义唯一的 machineID 机台标识。machineID 可以在网关机台配置页-添加/编辑机台-高级设置中由用户自定义（详见《说明书》5.3.1.5. 高级设置）。默认 machineID 由机台 IP 的第三段与第四段拼接得到，拼接后删除左侧的 0。如 IP 第三段不为 0，则第四段需要补齐三位数。例如 192.168.0.1 对应的 machineID 为 1，192.168.1.12 对应的 machineID 为 1012。

### 1.1.2 groupID 机组标识

网关目前支持最多 16 组机组，需要为每组设备定义唯一的 groupID 机组标识。groupID 可以在网关机组配置页-添加/编辑机台-高级设置中由用户自定义（详见《说明书》5.4.1.3. 高级设置）。默认 groupID 由字母 g 与机组号组成，如"g2"。

### 1.1.3 slaveID 从站标识

slaveID 从站标识用于 MODBUS 通讯的机台数据标识，范围为 1-255。slaveID 可以在网关机台配置页-添加/编辑机台-高级设置中由用户自定义（详见《说明书》5.3.1.5. 高级设置）。默认 slaveID 为机台 IP 第四段。

### 1.1.4 ID 数据库标识

ID 数据库标识是用户、机台、或机组在本地数据库中的标识。ID 在新建用户、机台、或机组时，在数据库中自动生成，不能由用户创建或修改。

---

## 1.2 数据说明

`<type>` 数据类如下表：

**表格 1 数据类**

| 序号 | type | 说明 |
|------|------|------|
| 1 | AlarmHistory | 警报历史 |
| 2 | AlarmLog | 当前警报 |
| 3 | AxialOverload | 伺服轴过载数据 |
| 4 | CNCStatus | 机台状态 |
| 5 | Count | 加工计数 |
| 6 | CurrentToolNumber | 当前刀号 |
| 7 | Cycle | 节拍数据 |
| 8 | EnergyConsum | 能耗数据 |
| 9 | Feed | 进给数据 |
| 10 | FeedAndSpindle | 进给倍率数据 |
| 11 | GroupCount | 机组加工计数 |
| 12 | GroupCumulativeTime | 机组累计状态时间 |
| 13 | GroupOEE | 机组 OEE 数据 |
| 14 | LaserPower | 激光功率 |
| 15 | Load | 负载数据 |
| 16 | LogHistory | 日志历史 |
| 17 | OEE | 机台 OEE 数据 |
| 18 | Offset | 刀补数据 |
| 19 | PLC | PLC 数据 |
| 20 | Position | 坐标数据 |
| 21 | ProgramBlock | 程序段 |
| 22 | ProgramInfo | 当前程序 |
| 23 | SpindleOverload | 主轴过载数据 |
| 24 | TimeData | 机台时间数据 |
| 25 | ToolLife | 刀具寿命数据 |

所有数据类中的 `<field>` 数据字段与 `<tag>` 数据标签如下。如数据类中未列出 `<tag>` 数据标签代表该数据类不需要数据标签。

### 1.2.1 AlarmHistory：警报历史

**表格 2 警报历史 \<field\> 数据字段**

| 字段 | 类型 | 说明 |
|------|------|------|
| alarmActive | Bool | true：激活警报状态；false：解除警报状态 |
| alarmLevel | String | 警报级别 |
| alarmMsg | String | 警报内容 |
| cumulativeAlarmCount | UInt32 | 累计警报数 |

> 累计警报数为自从网关开始自动采集这台设备，累计的警报数。该值保存在网关中，与 machineID 机台标识绑定，不会被重置。

### 1.2.2 AlarmLog：当前警报

**表格 3 当前警报 \<field\> 数据字段**

| 字段 | 类型 | 说明 |
|------|------|------|
| alarmLevel | String[] | 警报级别 |
| alarmMsg | String[] | 警报内容 |
| alarmTime | String[] | 警报时间 |
| cumulativeAlarmTime | UInt32 | 累计警报时间[秒] |

### 1.2.3 AxialOverload：伺服轴过载数据

**表格 4 伺服轴过载数据 \<field\> 数据字段**

| 字段 | 类型 | 说明 |
|------|------|------|
| cumulativeTime | UInt32 | 累计过载时间[毫秒] |

> 累计过载时间为自从网关开始自动采集这台设备，累计的轴过载时间。该值保存在网关中，与 machineID 机台标识绑定，不会被重置。

**表格 5 伺服轴过载数据 \<tag\> 数据标签**

| 序号 | 标签 | 类型 | 缩写 | 说明 |
|------|------|------|------|------|
| 1 | axisNo | Int32 | A | 轴号 |

### 1.2.4 CNCStatus：机台状态

**表格 6 机台状态 \<field\> 数据字段**

| 字段 | 类型 | 说明 |
|------|------|------|
| alarmStatus | String | 警报状态，见表格 45 警报状态、表格 48 警报级别 |
| alarmLevel | String | 警报级别，如有多个警报，取这些警报中的最高级别。如无警报，则不返回。详见表格 48 警报级别 |
| cncStatus | String | CNC 运行状态，见表格 44 运行状态 |
| adjustedStatus | String | 修正的 CNC 运行状态。如果启用状态修正（详见《说明书》5.5.8. 机台状态监控设置），根据设定的规则得到修正后的机台状态。如未启用状态修正，此字段数据与 cncStatus 数据一致。在 OEE、状态累计时间等涉及机台状态的计算中，优先使用 adjustedStatus 判断状态 |
| mode | String | \*运行模式，随系统型号 |
| programStatus | String | \*程序状态，随系统型号 |
| emergencyStatus | String | \*急停状态，见表格 46 急停状态 |
| dryRunStatus | String | \*试运行状态，见表格 47 试运行状态 |
| OffTime | UInt32 | 累计关机时间[秒] |
| WaitTime | UInt32 | 累计待机时间[秒] |
| EmergencyTime | UInt32 | 累计急停时间[秒] |
| AutoRunTime | UInt32 | 累计自动运行时间[秒] |
| ManualTime | UInt32 | 累计调机时间[秒] |

> 累计状态时间为自从网关开始自动采集这台设备，累计的各状态时间。该值保存在网关中，与 machineID 机台标识绑定，不会被重置。
>
> \*：状态详情，在以下情况返回：
> 1. 使用接口 2.5.1.3. readCNCStatusDetails 读取机台状态详情、2.5.2.1. readTaskData 读取机台任务数据，或 2.5.2.2. batchReadTaskData 批量读取机台任务数据。
> 2. 启用机台状态任务，且在任务配置-机台状态监控设置，启用状态详情，机台状态任务返回这些字段。

**表格 7 机台状态 \<tag\> 数据标签**

| 序号 | 标签 | 类型 | 缩写 | 说明 |
|------|------|------|------|------|
| 1 | channel | Int32 | C | 通道号，如不存在则代表默认通道 |

### 1.2.5 Count：加工计数

**表格 8 加工计数 \<field\> 数据字段**

| 字段 | 类型 | 说明 |
|------|------|------|
| count | Int32 | 机台系统记录的当前加工件数 |
| cumulativeCount | UInt32 | 累计加工计数 |
| currentCount | Int32 | 当前产量 |

> 累计加工计数为自从网关开始自动采集这台设备，累计的加工计数。该值保存在网关中，与 machineID 机台标识绑定，不会被重置。当前产量为机台在监控时间内的产量统计。

### 1.2.6 CurrentToolNumber：当前刀号

**表格 9 当前刀号 \<field\> 数据字段**（原文表格编号为 9）

| 字段 | 类型 | 说明 |
|------|------|------|
| toolNumber | String | 当前刀号 |
| toolOffsetNum | String | 当前刀补号 |

**表格 10 当前刀号 \<tag\> 数据标签**

| 序号 | 标签 | 类型 | 缩写 | 说明 |
|------|------|------|------|------|
| 1 | channel | Int32 | C | 通道号，如不存在则代表默认通道 |

### 1.2.7 Cycle：节拍数据

**表格 11 节拍数据 \<field\> 数据字段**

| 字段 | 类型 | 说明 |
|------|------|------|
| lastCycleTime | Int64 | 上次节拍时间[秒]，由网关机台节拍数据任务监测。如网关重启后第一个节拍尚未结束，此数值为 0。上次节拍时间定义上与 1.2.24 TimeData 中的上次循环时间相同，区别在于：前者由网关统计，所有可统计产量与状态的机台都支持；后者由机台本身提供，只有部分机台支持 |
| lastTotalTime | Int64 | 上次节拍结束到此节拍结束的总时间[秒]，包括非运行时间 |
| mainPrgmName | String | 上次节拍主程序名 |
| deltaCount | Int32 | 前后节拍计数变化值，当此值大于 1 时，节拍时间等于此次计数变化期间的运行时间除以计数变化值 |

### 1.2.8 EnergyConsum：能耗数据

**表格 12 能耗数据 \<field\> 数据字段**

| 字段 | 类型 | 说明 |
|------|------|------|
| allServoAxes | Double | 所有伺服轴能耗[Wh] |
| coolantPump | Double | 冷却液泵能耗[Wh] |
| ctsPump | Double | CTS 泵[Wh] |
| chipFlusherPump | Double | 切层冲洗器泵[Wh] |
| cyclonePump | Double | 离心式过滤器用泵[Wh] |
| system24V | Double | 24V 系统[Wh] |
| ncControl | Double | NC 控制[Wh] |
| lcdBacklight | Double | LCD 背光[Wh] |
| chipConveyor | Double | 排层器[Wh] |
| screwConveyor | Double | 螺旋排层器[Wh] |
| autoLubrication | Double | 自动注油设备（或自动注脂设备）[Wh] |
| spindleCoolingFan | Double | 主轴冷却风扇[Wh] |
| servoControl | Double | 伺服控制[Wh] |

> 目前此数据类仅支持部分新款 Brother 兄弟机型。

### 1.2.9 Feed：进给数据

**表格 13 进给数据 \<field\> 数据字段**

| 字段 | 类型 | 说明 |
|------|------|------|
| actFeed | Float | 实际进给速度 |
| overFeed | Float | 进给倍率[%] |
| overRapid | Float | 快速进给倍率[%] |

**表格 14 进给数据 \<tag\> 数据标签**

| 序号 | 标签 | 类型 | 缩写 | 说明 |
|------|------|------|------|------|
| 1 | channel | Int32 | C | 通道号，如不存在则代表默认通道 |

### 1.2.10 FeedAndSpindle：进给倍率数据

**表格 15 进给倍率数据 \<field\> 数据字段**

| 字段 | 类型 | 说明 |
|------|------|------|
| actFeed | Float | 实际进给速度 |
| actSpindle | Float | 第一主轴的实际转速 |
| overFeed | Float | 进给倍率[%] |
| overRapid | Float | 快速进给倍率[%] |
| overSpindle | Float | 第一主轴的转速倍率[%] |

**表格 16 进给倍率数据 \<tag\> 数据标签**

| 序号 | 标签 | 类型 | 缩写 | 说明 |
|------|------|------|------|------|
| 1 | channel | Int32 | C | 通道号，如不存在则代表默认通道 |

### 1.2.11 GroupCount：机组加工计数

**表格 17 机组加工计数 \<field\> 数据字段**（原文表格编号为 18）

| 字段 | 类型 | 说明 |
|------|------|------|
| cumulativeCount | UInt32 | 机组累计加工计数，即自从网关开始自动采集这组设备，累计的加工计数。详见《说明书》6.1.3. 机组加工计数 |

### 1.2.12 GroupCumulativeTime：机组累计状态时间

**表格 18 机组累计状态时间 \<field\> 数据字段**（原文表格编号为 19）

| 字段 | 类型 | 说明 |
|------|------|------|
| OffTime | UInt32 | 累计关机时间[秒] |
| WaitTime | UInt32 | 累计待机时间[秒] |
| EmergencyTime | UInt32 | 累计急停时间[秒] |
| AutoRunTime | UInt32 | 累计自动运行时间[秒] |
| ManualTime | UInt32 | 累计调机时间[秒] |

> 累计状态时间为自从网关开始自动采集这组设备，累计的机组内所有设备的各状态时间和。

### 1.2.13 GroupOEE：机组 OEE

**表格 19 机组 OEE \<field\> 数据字段**（原文表格编号为 20）

| 字段 | 类型 | 说明 |
|------|------|------|
| autoRunCount | Int32 | 当前机组中自动运行机台数量 |
| autoRunTime | Int64 | 机组自动运行时间[秒] |
| availability | Float | 机组开动率[%] |
| emergencyCount | Int32 | 当前机组中急停机台数量 |
| emergencyTime | Int64 | 机组急停时间[秒] |
| manualCount | Int32 | 当前机组中调机机床数量 |
| manualTime | Int64 | 机组调机时间[秒] |
| offCount | Int32 | 当前机组中关机机床数量 |
| offTime | Int64 | 机组关机时间[秒] |
| waitCount | Int32 | 当前机组中待机机床数量 |
| waitTime | Int64 | 机组待机时间[秒] |

> 此处机组各状态时间是机组中所有激活状态的机台在监控时间内的各状态时间之和。机组开动率是机组在监控时间内的开动率。详见《说明书》6.1.2. 机组 OEE 数据。

### 1.2.14 LaserPower：激光功率

**表格 20 激光功率 \<field\> 数据字段**

| 字段 | 类型 | 说明 |
|------|------|------|
| preset | Float | 预设功率[%] |
| actual | Float | 实际功率[%] |

### 1.2.15 Load：负载数据

**表格 21 负载数据 \<field\> 数据字段**

| 字段 | 类型 | 说明 |
|------|------|------|
| axialLoad | Float[] | 伺服轴负载[%]，依次对应 1.2.20 Position 坐标数据中的 axisName 中的伺服轴名 |
| spindleLoad | Float[] | 主轴负载[%]，依次对应第一主轴、第二主轴等 |

**表格 22 负载数据 \<tag\> 数据标签**

| 序号 | 标签 | 类型 | 缩写 | 说明 |
|------|------|------|------|------|
| 1 | channel | Int32 | C | 通道号，如不存在则代表默认通道 |

### 1.2.16 LogHistory：日志历史

**表格 23 日志历史 \<field\> 数据字段**

| 字段 | 类型 | 说明 |
|------|------|------|
| msg | String | 日志内容 |

### 1.2.17 OEE：机台 OEE 数据

**表格 24 机台 OEE \<field\> 数据字段**

| 字段 | 类型 | 说明 |
|------|------|------|
| autoRunTime | Int64 | 自动运行时间[秒] |
| availability | Float | 机台开动率[%] |
| emergencyTime | Int64 | 急停时间[秒] |
| manualTime | Int64 | 调机时间[秒] |
| offTime | Int64 | 关机时间[秒] |
| waitTime | Int64 | 待机时间[秒] |

> 注：此处机台各状态时间是机台在监控时间内的各状态时间。机台开动率是机台在监控时间内的开动率。详见《说明书》6.1.1. 机台 OEE 数据。

### 1.2.18 Offset：刀补数据

**表格 25 刀补数据 \<field\> 数据字段**

| 字段 | 类型 | 说明 |
|------|------|------|
| toolName | String | 刀具名称 |
| toolType | String | 刀具类型 |
| lengthUnit | String | 刀补长度单位 |
| toolNose | Int32 | （假想）刀尖位置/刀沿类型 |
| lengthWear | Double | 长度磨损 |
| radiuWear | Double | 半径磨损 |
| lengthGeom | Double | 长度形状 |
| radiusGeom | Double | 半径形状 |
| wearX | Double | 长度 X 磨损 |
| wearY | Double | 长度 Y 磨损 |
| wearZ | Double | 长度 Z 磨损 |
| wearR | Double | 半径磨损 |
| geomX | Double | 长度 X |
| geomY | Double | 长度 Y |
| geomZ | Double | 长度 Z |
| geomR | Double | 半径 |

> 注：表中为通用的刀补数据字段，一般情况下足以满足用户使用需求。有些机床支持一些不常用的数据字段，不在这里一一说明。**建议在第一次添加新类型机床时，测试可读取的字段。**如需要获取机床中有但当前未添加的字段，请咨询客服。

**表格 26 刀补数据 \<tag\> 数据标签**

| 序号 | 标签 | 类型 | 缩写 | 说明 |
|------|------|------|------|------|
| 1 | toolNum | Int32 | T | 刀号 |
| 2 | offsetNum | Int32 | O | 刀补号 |
| 3 | channel | Int32 | C | 通道号，如不存在则代表默认通道 |

数据标签的组合与机台系统有关，不同系统设备需要的标签组合如下：

**表格 27 刀补数据标签组合**

| 系统型号 | toolNum 刀具号 | offsetNum 刀补号 |
|---------|--------------|----------------|
| Bosunman 博尚 | X | O |
| Brother 兄弟 | X | O |
| Delta 台达 | X | O |
| Fagor 法格 | X | O |
| Fanuc 发那科 | X | O |
| GSK 广数 | X | O |
| Heidenhain 海德汉 | O（刀具表"T"列） | X |
| Haas 哈斯 | X | O |
| Kede 科德 | X | O |
| Knd 凯恩帝 | X | O |
| Lynuc 镁纳克 | X | O |
| Mazak 马扎克 [Smart, Smooth] | X | O |
| Mitsubishi 三菱 | X | O |
| Mock 模拟机台 | O | O |
| Okuma 大隈 [P200L, P300L] | X | O（"NO."列） |
| Okuma 大隈 [P300S(LP)] | O（刀具数据设定表中的"TNo"列） | O（由刀具数据设定表中的"ENo"列与"PNo"计算：offsetNum = (ENo-1)\*20+PNo，如没有"ENo"列，则 offsetNum = PNo） |
| Okuma 大隈 [P200M, P300M, P300S(MP)] | X | O（刀具长度补偿/刀具径补偿表"NO."列） |
| Siemens 西门子 | O（刀具表"位置"列） | O（刀具表"D"列） |
| Syntec 新代 | X | O |

> O：需要；X：不需要。
>
> 如果输出量与标签同名，输出结果也会出现在标签中，但此结果不作标识作用。

### 1.2.19 PLC：PLC 数据

PLC 数据包括外部 PLC 数据。

**表格 28 PLC 数据 \<field\> 数据字段**

| 字段 | 类型 | 说明 |
|------|------|------|
| data | Object[] | 除 String 类型以外的 PLC 数据 |
| msg | String | String 类型 PLC 数据 |
| pArray | Object[] | 后处理得到的数组数据 |
| pInt64 | Int64 | 后处理得到的 Int64 数据 |
| pDouble | Double | 后处理得到的 Double 数据 |
| pString | String | 后处理得到的 String 数据 |
| pBool | Bool | 后处理得到的 Bool 数据 |

**表格 29 PLC 数据 \<tag\> 数据标签**

| 序号 | 标签 | 类型 | 缩写 | 说明 |
|------|------|------|------|------|
| 1 | channel | Int32 | C | 通道号，如不存在则代表默认通道 |
| 2 | tag | String | T | 标签名或顺序号 |

tag 标签说明：

如果在 PLC 任务命令中定义了标签（详见《说明书》6.2.1. PLC 数据任务），则 tag 为命令中定义的标签，如 PLC 命令中标签为"温度数据 1"，则 tag 为"T 温度数据 1"。如未在 PLC 任务命令中定义标签，则 tag 为 T+顺序号，顺序号从 0 开始。如第一条 PLC 任务命令中未定义标签，其顺序号为 0，tag 为 T0。如有多条 PLC 采集命令时，顺序号根据每条命令指定的回复数据长度累加。

如前一条 PLC 命令的顺序号为 x，则后一条的顺序号为：
- x + 前一条任务获取的数据长度

这里数据长度指数据对应的 16 位型的数量。已知 PLC 任务命令的主要参数为：区域、起始地址、数据数量、数据类型。

- 若数据类型是 String：数据长度 = (数据数量 + 1) / 2，得到的结果向下取整
  - 例如：PLC 命令 DB1,1,11,String，数据长度 = (11 + 1) / 2，结果向下取整为 6
- 若数据类型不是 String：数据长度 = 单个数据长度 × 数据数量，其中：
  - 单个数据长度 = (单个数据类型 Bit 数量 + 15) / 16，得到的结果向下取整
  - 例如：PLC 命令 M,100,5,Bit0，单个数据长度 = (1 + 15) / 16，结果向下取整为 1，数据长度 = 1 × 5 = 5
  - 例如：PLC 命令 R,100,5,Byte，单个数据长度 = (8 + 15) / 16，结果向下取整为 1，数据长度 = 1 × 5 = 5
  - 例如：PLC 命令 R,100,5,Int16，单个数据长度 = (16 + 15) / 16，结果向下取整为 1，数据长度 = 1 × 5 = 5
  - 例如：PLC 命令 R,100,5,Int32，单个数据长度 = (32 + 15) / 16，结果向下取整为 2，数据长度 = 2 × 5 = 10
  - 例如：PLC 命令 R,100,5,Float，单个数据长度 = (32 + 15) / 16，结果向下取整为 2，数据长度 = 2 × 5 = 10
  - 例如：PLC 命令 R,100,5,Double，单个数据长度 = (64 + 15) / 16，结果向下取整为 4，数据长度 = 4 × 5 = 20

第一条外部 PLC 任务的顺序号在最后一条 PLC 任务的顺序号之后继续编号。

### 1.2.20 Position：坐标数据

**表格 30 坐标数据 \<field\> 数据字段**

| 字段 | 类型 | 说明 |
|------|------|------|
| axisName | String[] | 轴名称，如["x", "y", "z"] |
| abs | Float[] | 绝对坐标，依次对应 axisName 中的坐标名 |
| dist | Float[] | 剩余距离，依次对应 axisName 中的坐标名 |
| mach | Float[] | 机械坐标，依次对应 axisName 中的坐标名 |
| rel | Float[] | 相对坐标，依次对应 axisName 中的坐标名 |
| unit | String[] | 轴坐标单位 |

**表格 31 坐标数据 \<tag\> 数据标签**

| 序号 | 标签 | 类型 | 缩写 | 说明 |
|------|------|------|------|------|
| 1 | channel | Int32 | C | 通道号，如不存在则代表默认通道 |

### 1.2.21 ProgramBlock：程序段

**表格 32 程序段 \<field\> 数据字段**

| 字段 | 类型 | 说明 |
|------|------|------|
| currentBlock | String | 当前运行的程序段内容 |

**表格 33 程序段 \<tag\> 数据标签**

| 序号 | 标签 | 类型 | 缩写 | 说明 |
|------|------|------|------|------|
| 1 | channel | Int32 | C | 通道号，如不存在则代表默认通道 |

### 1.2.22 ProgramInfo：当前程序

**表格 34 当前程序 \<field\> 数据字段**

| 字段 | 类型 | 说明 |
|------|------|------|
| mainPrgmName | String | 当前主程序名 |
| programSeqNum | String | 当前执行子程序段顺序号 |
| runningPrgName | String | 当前执行子程序名 |
| programStack | String | 程序堆栈，仅支持 Siemens 西门子 [OPC UA] |

**表格 35 当前程序 \<tag\> 数据标签**

| 序号 | 标签 | 类型 | 缩写 | 说明 |
|------|------|------|------|------|
| 1 | channel | Int32 | C | 通道号，如不存在则代表默认通道 |

### 1.2.23 SpindleOverLoad：主轴过载数据

**表格 36 主轴过载数据 \<field\> 数据字段**

| 字段 | 类型 | 说明 |
|------|------|------|
| cumulativeTime | UInt32 | 累计主轴过载时间[毫秒] |

> 累计主轴过载时间为自从网关开始自动采集这台设备，累计的主轴过载时间。该值保存在网关中，与 machineID 机台标识绑定，不会被重置。

**表格 37 主轴过载数据 \<tag\> 数据标签**

| 序号 | 标签 | 类型 | 缩写 | 说明 |
|------|------|------|------|------|
| 1 | spindleNo | Int32 | S | 主轴号 |
| 2 | channel | Int32 | C | 通道号，如不存在则代表默认通道 |

### 1.2.24 TimeData：机台时间数据

**表格 38 机台时间数据 \<field\> 数据字段**

| 字段 | 类型 | 说明 |
|------|------|------|
| cumulativePowerOnTimeMin | Int32 | 累计通电时间 1[分钟] |
| cumulativePowerOnTimeMs | Int32 | 累计通电时间 2[毫秒] |
| powerOnTimeMin | Int32 | 当前通电时间 1[分钟] |
| powerOnTimeMs | Int32 | 当前通电时间 2[毫秒] |
| cumulativeOperatingTimeMin | Int32 | 累计运行时间 1[分钟] |
| cumulativeOperatingTimeMs | Int32 | 累计运行时间 2[毫秒] |
| operatingTimeMin | Int32 | 当前运行时间 1[分钟] |
| operatingTimeMs | Int32 | 当前运行时间 2[毫秒] |
| cumulativeCuttingTimeMin | Int32 | 累计加工（切削）时间 1[分钟] |
| cumulativeCuttingTimeMs | Int32 | 累计加工（切削）时间 2[毫秒] |
| cuttingTimeMin | Int32 | 当前加工（切削）时间 1[分钟] |
| cuttingTimeMs | Int32 | 当前加工（切削）时间 2[毫秒] |
| lastCycleTimeMin | Int32 | 上次循环时间 1[分钟] |
| lastCycleTimeMs | Int32 | 上次循环时间 2[毫秒] |
| currentCycleTimeMin | Int32 | 当前循环时间 1[分钟] |
| currentCycleTimeMs | Int32 | 当前循环时间 2[毫秒] |
| currentCuttingTimeMin | Int32 | 当前切削时间 1[分钟] |
| currentCuttingTimeMs | Int32 | 当前切削时间 2[毫秒] |

各系统型号支持的时间数据如下表所示，其中：

O：机床支持的时间数据。每个时间数据分成两个 Int32 保存，时间 1 为超过 1 分钟的部分，单位为分钟；时间 2 为不到 1 分钟的部分，单位为毫秒。实际时间数据为时间 1 的部分与时间 2 的部分换算单位后相加。

例如：
- `cumulativeOperatingTimeMin` = 6683，累计运行时间 1
- `cumulativeOperatingTimeMs` = 13328，累计运行时间 2
- 累计运行时间 = [累计运行时间 1] × 60 × 1000 + [累计运行时间 2] = 6683 × 60 × 1000 + 13328 = 400993328 毫秒

\*：部分西门子系统获取到的累计运行时间、累计加工（切削）时间，当前加工（切削）时间恒定为 0，是因为该系统中存在对应变量，但系统并未实际写入任何数值。部分时间数据可以在机床系统上手动清零。

**表格 39 各系统型号支持的时间数据**

| 系统型号 | 累计通电时间 | 当前通电时间 | 累计运行时间 | 当前运行时间 | 累计加工(切削)时间 | 当前加工(切削)时间 | 上次循环时间 | 当前循环时间 | 当前加工件切削时间 | 剩余循环时间 |
|---------|------------|------------|------------|------------|-----------------|-----------------|------------|------------|-----------------|------------|
| Bosunman 博尚 [DF 系列] | | | | O | | | | O | | |
| Bosunman 博尚 [BSK 系列] | O | O | O | O | | | | O | | |
| Brother 兄弟 [通用型] | O | | O | O | | | | O | | |
| Brother 兄弟 [S 系列] | O | | O | O | | | O | O | | |
| Delta 台达 | | | O | O | | | | | | |
| Dmg Mori 德马吉森精机 [730BM] | | | | | | | | | | |
| Dmg Mori 德马吉森精机 [OPC UA] | O | | O | | | | O | | | |
| Fagor 法格 [8035, 8040, 8055] | | | | | | | O | | | |
| Fagor 法格 [8060, 8065, 8070] | O | | | | | | O | | | |
| Fanuc 发那科 | O | | O | O | | | O（程序结尾必须复位以清零） | | | |
| Gsk 广州数控 | | | O | O | | | | | | |
| Haas 哈斯 [通用型，串口] | O | O | | | | | O | O | | |
| Haas 哈斯 [MT-CONNECT] | | | | | | | O | O | | O |
| Heidenhain 海德汉 | O | | O | | | | | | | |
| Hnc 华中数控 | | | | | | | | | | |
| Jingdiao 北京精雕 | | | O | O | O | | O | | | |
| Kede 科德 | | O | | | | | O | | | O |
| Knd 凯恩帝 | | | O | O | | | | | | |
| Lnc 宝元 | | | | O | | | | O | | |
| Lynuc 镁纳克 | | | O | O | O | | O | | | |
| Mazak 马扎克 [MT-CONNECT] | O | | O | O | | | | | | |
| Mazak 马扎克 [Smart, Smooth] | O | O | O | O | | | | | | |
| Mitsubishi 三菱 | O | | O | O | | | O | | | |
| Mock 模拟机台 | O | O | O | O | O | O | O | O | O | |
| Okuma 大隈 | O | | O | O | | | | | | |
| Rexroth 力士乐 [OPC UA] | | | O | | | | O | | | |
| Siemens 西门子 | O | O | O | O | | | O | | | |
| Syntec 新代 | O | O | | O（当前程序的自动运行时间） | O | | O | O | | |

### 1.2.25 ToolLife：刀具寿命数据

**表格 40 刀具寿命数据 \<field\> 数据字段**

**通用数据**

| 字段 | 类型 | 说明 |
|------|------|------|
|**通用数据**|
| timeLimit | Int32 | 寿命极限[秒]，最大可用时间 |
| currentTime | Int32 | 当前寿命[秒]，已经使用的时间 |
| prewarningTime | Int32 | 预警寿命[秒]，当前寿命达到此值时发出警报 |
| countLimit | Int32 | 寿命极限[次]，最大可用次数 |
| currentCount | Int32 | 当前寿命[次]，已经使用的次数 |
| prewarningCount | Int32 | 预警寿命[次]，当前寿命达到此值时发出警报 |
| wearLimit | Int32 | 寿命极限[机床默认长度单位]，最大可磨损量 |
| currentWear | Int32 | 当前寿命[机床默认长度单位]，当前磨损量 |
| prewarningWear | Int32 | 预警寿命[机床默认长度单位]，当前寿命达到此值时发出警报 |
|**原始数据**|
| rawToolLifeType | String | 刀具寿命类型 |
| rawToolLifeUnit | String | 时间单位，以下简称为[时间] |
| rawToolLifeStatus | String | 刀具寿命状态 |
| rawTimeLimit | Double | 寿命极限[时间] |
| rawTimeLimit1 | Double | 刀具最长寿命[时间]，仅 Heidenhain 海德汉 |
| rawTimeLimit1 | Double | 调用刀具的最长寿命[时间]，仅 Heidenhain 海德汉 |
| rawCurrentTime | Double | 当前寿命[时间] |
| rawOverTime | Double | 超出刀具寿命[时间]，仅 Heidenhain 海德汉 |
| rawRemainingTime | Double | 剩余寿命[时间] |
| rawPrewarningRemainingTime | Double | 预警剩余寿命[时间] |
| rawRemainingCount | Int32 | 剩余寿命[次] |
| rawPrewarningRemainingCount | Int32 | 预警剩余寿命[次] |
| rawRemainingWear | Double | 剩余寿命[机床默认长度单位] |
| rawPrewarningRemainingWear | Double | 预警剩余寿命[机床默认长度单位] |
| inventoryNum | String | 刀具识别码，仅 Heidenhain 海德汉 |

> 各字段意义详见 2.5.1.21. readToolLife 读取刀具寿命 与 2.5.1.23. readToolLifeDetails 读取刀具寿命详情 中的例子。
>
> 原始数据在以下情况返回：
> 1. 使用接口 2.5.1.22. readToolLifeDetails 读取刀具寿命详情、2.5.1.24. batchReadToolLifeDetails 批量读取刀具寿命详情、2.5.2.1. readTaskData 读取机台任务数据，或 2.5.2.2. batchReadTaskData 批量读取机台任务数据。
> 2. 启用刀具寿命任务，且在任务配置-刀具寿命监控设置，启用刀具寿命详情，刀具寿命任务返回这些字段。

**表格 41 刀具寿命数据 \<tag\> 数据标签**

| 序号 | 标签 | 类型 | 缩写 | 说明 |
|------|------|------|------|------|
| 1 | toolGroupNum | Int32 | G | 刀组号 |
| 2 | toolNum | Int32 | T | 刀号 |
| 3 | toolOffsetNum | Int32 | O | 刀补号 |
| 4 | toolIndex | Int32 | I | 序号 |

数据标签的组合与机台系统有关，不同系统设备需要的标签组合如下：

**表格 42 刀具寿命数据标签组合**

| 系统型号 | toolGroupNum 刀组号 | toolIndex 组内序号 | toolNum 刀号 | toolOffsetNum 刀补号 |
|---------|-------------------|------------------|------------|-------------------|
| Brother 兄弟 | X | X | O | X |
| Fanuc 发那科 | O | O | X | X |
| Gsk 广数 | O | O | X | X |
| Heidenhain 海德汉 | X | X | O | X |
| Kede 科德 | X | X | O | X |
| Lynuc 镁纳克 | X | X | O | X |
| Mazak 马扎克 [Smart, Smooth] | X | X | O（"TNo"列） | X |
| Mock 模拟机台 | X | X | O | O |
| Okuma 大隈 [P200L, P300L] | X | X | O（"TOOL"列） | X |
| Okuma 大隈 [P300S(LP)] | X | X | O（"TNo"列） | O（"ENo"列，如没有"ENo"，则 offsetNum = 1） |
| Okuma 大隈 [P200M, P300M, P300S(MP)] | X | X | O（"TOOL NO."列） | X |
| Siemens 西门子 | X | X | O（刀具表"位置"列） | O（刀具表"D"列） |
| Syntec 新代 | X | X | O | X |

> O：需要；X：不需要。
>
> 如果输出量与标签同名，输出结果也会出现在标签中，但此结果不作标识作用。如 Fanuc 发那科的刀具寿命时，标签 toolGroupNum 与 toolIndex 用于标识刀具，而标签 toolNum 是一个输出量，此时 toolNum 的结果会出现在标签中。

各系统型号支持的寿命类型：

**表格 43 刀具寿命类型**

| 系统型号 | Count 计数 | Time 计时 | Wear 计磨损量 |
|---------|-----------|----------|-------------|
| Brother 兄弟 | O | O | X |
| Fanuc 发那科 | O | O | X |
| Gsk 广数 | O | O | X |
| Heidenhain 海德汉 | X | O | X |
| Kede 科德 | O | O | O |
| Lynuc 镁纳克 | O | O | X |
| Mock 模拟机台 | O（ToolNum 1~10） | O（ToolNum 11~20） | O（ToolNum 21~30） |
| Okuma 大隈 | O | O | O |
| Siemens 西门子 | O | O | O |
| Syntec 新代 | O | O | X |

> O：支持；X：不支持。

---

## 1.3 变量说明

### 1.3.1 机台状态

#### 1.3.1.1 CNCStatus：运行状态

> 注：变量名为 CNCStatus，实际不仅限于 CNC，也适用于机器人、激光切割机等设备的状态。

**表格 44 运行状态**

| 状态码 | 返回 String | 运行状态 |
|--------|------------|---------|
| 0 | OFF | 关机或离线状态 |
| 1 | EMERGENCY | 紧急报警状态 |
| 2 | WAIT | 待机状态 |
| 10 | AUTO_RUN | 自动运行状态 |
| 11 | AUTO_RUN_REMOTE | 远程自动运行状态 |
| 20 | MANUAL | 调机状态：一般调机 |
| 21 | MANUAL_EDIT | 调机状态：程序编辑 |
| 22 | MANUAL_MDI | 调机状态：手动数据输入 |
| 23 | MANUAL_HANDLE | 调机状态：手动手轮进给 |
| 24 | MANUAL_HANDLE_TCH | 调机状态：手动手轮进给示教 |
| 25 | MANUAL_JOG | 调机状态：手动连续进给 |
| 26 | MANUAL_JOG_TCH | 调机状态：手动连续进给示教 |
| 27 | MANUAL_INC | 调机状态：增量进给/步进 |
| 28 | MANUAL_REF | 调机状态：回参考点 |
| 29 | MANUAL_REMOTE | 调机状态：远程 |
| 30 | MANUAL_MSTR | 调机状态：刀具回退/重新定位 |
| 31 | MANUAL_DRY_RUN | 调机状态：试运行 |
| 32 | MANUAL_RAPID | 调机状态：快速定位 |
| 33 | MANUAL_SINGLE_BLOCK | 调机状态：单段运行 |

> 注：状态码仅用于 MODBUS 通讯。

#### 1.3.1.2 AlarmStatus：警报状态

**表格 45 警报状态**

| 返回 String | 警报状态 |
|------------|---------|
| ALARM | 有警报 |
| NO_ALARM | 无警报 |

#### 1.3.1.3 EmergencyStatus：急停状态

**表格 46 急停状态**

| 返回 String | 急停状态 |
|------------|---------|
| EMG | 急停 |
| NOT_EMG | 非急停 |

#### 1.3.1.4 DryRunStatus：试运行状态

**表格 47 试运行状态**

| 返回 String | 试运行状态 |
|------------|----------|
| DRY_RUN | 试运行 |
| NOT_DRY_RUN | 非试运行 |

### 1.3.2 警报信息

#### 1.3.2.1 AlarmLevel：警报级别

按优先级由高到低分为错误（ERR）、警告（WRN）、消息（INF）三个级别。用户可参照《说明书》5.5.7. 警报监控设置，以关键字设置警报级别，过滤低于最低报警级别的警报。未设置级别的警报默认认为 WRN 警告级别。

**表格 48 警报级别**

| 返回 String | 警报级别 |
|------------|---------|
| ERR | 错误 |
| WRN | 警告 |
| INF | 消息 |

### 1.3.3 服务信息

#### 1.3.3.1 ServiceRunningStatus：服务运行状态

网关各项服务的运行状态。

**表格 49 网关服务运行状态**

| 返回 Int32 | 运行状态 |
|-----------|---------|
| 0 | Disabled 关闭 |
| 1 | Initiated 已启动 |
| 2 | Ready 等待连接 |
| 3 | Running 运行中 |
| 4 | Delayed 延误 |
| 5 | Error 错误 |

---

# 二、HTTP 通讯

## 2.1 基本说明

服务运行于 HTTP 标准端口（80 端口），如无特殊说明，请求的基地址均为 `/api/cnc`。

一个标准的请求地址格式如下：

```
http://{网关IP}/api/cnc/{接口名}?MachineID={目标机台machineID}
```

例如网关的 IP 地址为 192.168.100.1，要获取该网关连接的 IP 为 192.168.1.10、MachineID 为 1010（machineID 解释见 1.1.1 machineID 机台标识）的机台主通道的运行状态，应使用 `/readCNCStatus` 接口，对应请求地址为：

```
http://192.168.100.1/api/cnc/readCNCStatus?MachineID=1010
```

- 所有接口只接收 Content-Type 为 `application/json` 类型的 HTTP 数据。
- 除部分文件相关的接口外，大部分接口返回 `application/json` 类型的 HTTP 数据。
- 所有数据的编码必须是 UTF-8。
- 以下说明中，部分接口需要在请求地址中额外补充其它输入量。

---

## 2.2 错误处理

任何请求发生错误时，将返回错误对象如下：

```json
{
  "errorCode": -1,
  "errorMsg": "未知错误"
}
```

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| errorCode | Int32 | （必需）错误代码，0 代表成功 |
| errorMsg | String | （必需）错误内容 |

当操作成功时，返回相应数据，此时 HTTP 状态码为 200。

出现错误时，返回错误代码，此时 HTTP 状态码一般是 400、409、500 等，常见返回错误代码如下：

**表格 51 常见错误代码**

| 错误代码 | 内容 | 说明 |
|---------|------|------|
| 0 | 成功 | 操作执行成功 |
| 3 | 机台关闭或离线 | 无法与机床进行通讯，机床关机或网络硬件（机床网口、交换机、网线等）故障 |
| 7 | 没有权限 | 接口受保护或不在授权范围内，或鉴权信息无效 |
| 102 | 机台网络故障，无法获取数据 | 能与机床进行通讯，但无法获取数据，机床网络设置有问题 |
| 125 | 文件路径无效 | 输入的文件路径无效 |
| 142 | 文件已存在 | 目标目录中已存在同名文件 |
| 143 | 文件正在使用中 | 要操作的文件正在被使用 |
| 144 | 文件写保护 | 要操作的文件处于写保护状态 |
| 158 | 文件不存在 | 目标目录中无目标文件 |
| 10003 | machineID 不存在 | machineID 有误，对应机台未激活，编辑机台 IP、激活状态后是否未重启网关服务 |
| 10006 | 接口未授权 | 需使用未授权接口请联系彼络 |

---

## 2.3 鉴权方式

在网关设置中，启用安全控制后，用户必须提供鉴权信息才能使用授权 API。如关闭安全控制，则可跳过鉴权，直接使用所有接口。

网关支持以下两种鉴权方式：JWT 方式与密钥方式。

### 2.3.1 JWT 方式

用户使用鉴权接口 `/api/auth/login`，以用户名密码登录后，获取对应用户的 JWT token。Token 的有效时间为 24 小时，过期后需再次登录获取新 token。请求时在 Header 里带 `Authorization: Bearer <token>`，可使用该用户权限下的授权 API。如登录用户有管理员权限，可使用除受保护 API 以外的所有接口。

### 2.3.2 密钥方式

在网关的设置-管理用户-用户安全设置界面，生成密钥，密钥永久有效。请求时在 Header 里带 `Authorization: Bearer <密钥>`，可使用该用户权限下的授权 API。如登录用户有管理员权限，可使用除受保护 API 以外的所有接口。

---

## 2.4 鉴权接口

鉴权接口基地址 `/api/auth/`。

### 2.4.1 login 登录

```
POST  /api/auth/login
```

请求体示例 application/json：

```json
{
  "username": "username",
  "password": "password"
}
```

**请求参数**

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| username | String | （必需）用户名 |
| password | String | （必需）密码 |

**返回示例**

```json
{
  "token": "a2JhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9eyJ1bmlxdWV.bmFtZSI6ImFkbWluIiwibmJmIjoxNjIwMTYzOTUwLCJleHAiOjE2MjAxNzExNTAsImlhdCI6MTYyMDE2Mzk1MH0..."
}
```

**返回参数**

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| token | String | （必需）用户令牌。有效时间为 24 小时，过期后需再次登录获取新令牌 |

### 2.4.2 change-password 修改密码

此接口仅限 JWT 鉴权方式下使用。

```
POST  /api/auth/change-password
```

请求体示例 application/json：

```json
{
  "currentPassword": "currentPassword",
  "newPassword": "newPassword"
}
```

**请求参数**

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| currentPassword | String | （必需）当前密码 |
| newPassword | String | （必需）新密码 |

**返回示例**

```json
{
  "errorCode": 0,
  "errorMsg": "Success"
}
```

**返回参数**

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| errorCode | Int32 | （必需）错误代码，0 代表成功 |
| errorMsg | String | （必需）错误内容 |

---

# 二、HTTP 通讯（续）

## 2.5 数据读写接口

通过数据读写接口可以通过网关读取、写入机台数据，或读取机组数据。数据读写接口分为两类：**直接读写**与**缓存读取**。

---

### 2.5.1 直接读写

使用直接读写类接口，网关会立刻与目标机台通讯，获取或写入数据。

---

### 2.5.1.1 readAlarm 读取警报信息

```
GET  /api/cnc/readAlarm?machineID=MACHINEID
```

**请求参数**

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| machineID | String | （必需）目标机台标识，详见 1.1.1 machineID 机台标识 |

**返回示例**

```json
{
  "alarmMsg": [
    "警报 1",
    "警报 2"
  ],
  "alarmLevel": [
    "WRN",
    "WRN"
  ]
}
```

**返回参数**

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| alarmMsg | String[] | （必需）机台当前警报内容。如无警报，返回空 Array |
| alarmLevel | String[] | （必需）警报级别，与警报内容按顺序对应。如无警报，返回空 Array。详见表格 48 警报级别 |

> 注：从 1.8.1 版本开始，警报时间被移除。如需获取机台警报的起始时间，可使用接口 2.7.1.2 alarm 机台警报数据分析。

---

### 2.5.1.2 readCNCStatus 读取机台状态

```
GET  /api/cnc/readCNCStatus?machineID=MACHINEID&channel=CHANNEL
```

**请求参数**

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| machineID | String | （必需）目标机台标识，详见 1.1.1 machineID 机台标识 |
| channel | Int32 | 机台通道号，如不补充则默认为 0，即主通道 |

**返回示例**

```json
{
  "cncStatus": "MANUAL_EDIT",
  "alarmStatus": "ALARM",
  "alarmLevel": "WRN",
  "channel": 2
}
```

**返回参数**

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| cncStatus | String | （必需）运行状态，详见表格 44 运行状态 |
| alarmStatus | String | （必需）警报状态，详见表格 45 警报状态 |
| alarmLevel | String | 警报级别，如有多个警报，取这些警报中的最高级别。如无警报，则不返回。详见表格 48 警报级别 |
| channel | Int32 | 机台通道号，仅当请求中补充 channel 且不为 0 时出现 |

> 注：由网关后处理得到的修正运行状态 adjustedStatus，累计关机时间 offTime，累计待机时间 waitTime，累计急停时间 emergencyTime，累计自动运行时间 autoRunTime，累计调机时间 ManualTime 等，暂不支持 HTTP 协议。需要在开启自动采集任务后，通过接口 2.5.2.1 readTaskData 或 2.5.2.2 batchReadTaskData，或通过 MODBUS、MQTT、数据库等方式获取。

---

### 2.5.1.3 readCNCStatusDetails 读取机台状态详情

此接口除了读取到与 2.5.1.2 readCNCStatus 读取机台状态相同的通用机台状态数据，还能获取到不通用的原始数据。

```
GET  /api/cnc/readCNCStatusDetails?machineID=MACHINEID&channel=CHANNEL
```

**请求参数**

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| machineID | String | （必需）目标机台标识，详见 1.1.1 machineID 机台标识 |
| channel | Int32 | 机台通道号，如不补充则默认为 0，即主通道 |

**返回示例**

```json
{
  "mode": "AUTO_RUN",
  "programStatus": "RUNNING",
  "emergencyStatus": "NOT_EMG",
  "dryRunStatus": "DRY_RUN",
  "cncStatus": "AUTO_RUN",
  "alarmStatus": "ALARM",
  "alarmLevel": "WRN",
  "channel": 2
}
```

**返回参数**

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| mode | String | 运行模式 |
| programStatus | String | 程序状态 |
| emergencyStatus | String | 急停状态，见表格 46 急停状态 |
| dryRunStatus | String | 试运行状态 |
| cncStatus | String | （必需）运行状态，详见表格 44 运行状态 |
| alarmStatus | String | （必需）警报状态，详见表格 45 警报状态 |
| alarmLevel | String | 警报级别，如有多个警报取最高级别。如无警报则不返回。详见表格 48 警报级别 |
| channel | Int32 | 机台通道号，仅当请求中补充 channel 且不为 0 时出现 |

---

### 2.5.1.4 readCount 读取加工计数

```
GET  /api/cnc/readCount?machineID=MACHINEID
```

**请求参数**

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| machineID | String | （必需）目标机台标识，详见 1.1.1 machineID 机台标识 |

**返回示例**

```json
{
  "count": 1052
}
```

**返回参数**

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| count | Int32 | （必需）从机台系统获取的加工计数 |

> 注：由网关统计生成的机台累计加工计数 cumulativeCount，与当前监控时间内的加工计数 currentCount 暂不支持 HTTP 协议。需要在开启自动采集任务后，通过接口 2.5.2.1 readTaskData 或 2.5.2.2 batchReadTaskData，或通过 MODBUS、MQTT、数据库等方式获取。

---

### 2.5.1.5 readCurrentToolNumber 读取当前刀号

```
GET  /api/cnc/readCurrentToolNumber?machineID=MACHINEID&channel=CHANNEL
```

**请求参数**

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| machineID | String | （必需）目标机台标识，详见 1.1.1 machineID 机台标识 |
| channel | Int32 | （机台通道号，如不补充则默认为 0，即主通道 |

**返回示例**

```json
{
  "toolNumber": "6",
  "toolOffsetNum": "6",
  "channel": 2
}
```

**返回参数**

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| toolNumber | String | （必需）当前刀号 |
| toolOffsetNum | String | 当前刀补号 |
| channel | Int32 | 机台通道号，仅当请求中补充 channel 且不为 0 时出现 |

---

### 2.5.1.6 readEnergyConsum 读取能耗数据

目前支持部分款 Brother 兄弟机型和模拟机台。

```
GET  /api/cnc/readEnergyConsum?machineID=MACHINEID
```

**请求参数**

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| machineID | String | （必需）目标机台标识，详见 1.1.1 machineID 机台标识 |

**返回示例**

```json
{
  "allServoAxes": 127144.0,
  "coolantPump": 41577.0,
  "ctsPump": 6507.0,
  "chipFlusherPump": 0.0,
  "cyclonePump": 0.0,
  "system24V": 46270.0,
  "ncControl": 10099.0,
  "lcdBacklight": 2884.0,
  "chipConveyor": 0.0,
  "screwConveyor": 0.0,
  "autoLubrication": 239.0,
  "spindleCoolingFan": 7212.0,
  "servoControl": 23806.0
}
```

**返回参数**

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| allServoAxes | Double | 所有伺服轴能耗[Wh] |
| coolantPump | Double | 冷却液泵能耗[Wh] |
| ctsPump | Double | CTS 泵能耗[Wh] |
| chipFlusherPump | Double | 切屑冲洗器泵能耗[Wh] |
| cyclonePump | Double | 离心式过滤器用泵能耗[Wh] |
| system24V | Double | 24V 系统能耗[Wh] |
| ncControl | Double | NC 控制能耗[Wh] |
| lcdBacklight | Double | LCD 背光能耗[Wh] |
| chipConveyor | Double | 排屑器能耗[Wh] |
| screwConveyor | Double | 螺旋排屑器能耗[Wh] |
| autoLubrication | Double | 自动注油设备（或自动注脂设备）能耗[Wh] |
| spindleCoolingFan | Double | 主轴冷却风扇能耗[Wh] |
| servoControl | Double | 伺服控制能耗[Wh] |

---

### 2.5.1.7 readFeed 读取进给数据

仅限激光切割机/焊接机。

```
GET  /api/cnc/readFeed?machineID=MACHINEID&channel=CHANNEL
```

**请求参数**

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| machineID | String | （必需）目标机台标识，详见 1.1.1 machineID 机台标识 |
| channel | Int32 | 机台通道号，如不补充则默认为 0，即主通道 |

**返回示例**

```json
{
  "overFeed": 100.0,
  "actFeed": 80.0,
  "overRapid": 100.0,
  "channel": 2
}
```

**返回参数**

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| overFeed | Float | 进给倍率[%] |
| actFeed | Float | 实际进给速率 |
| overRapid | Float | 快速倍率[%] |
| channel | Int32 | 机台通道号，仅当请求中补充 channel 且不为 0 时出现 |

---

### 2.5.1.8 readFeedAndSpindle 读取进给转速数据

仅限 CNC。

```
GET  /api/cnc/readFeedAndSpindle?machineID=MACHINEID&channel=CHANNEL
```

**请求参数**

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| machineID | String | （必需）目标机台标识，详见 1.1.1 machineID 机台标识 |
| channel | Int32 | 机台通道号，如不补充则默认为 0，即主通道 |

**返回示例**

```json
{
  "overSpindle": 150.0,
  "actSpindle": 3000.0,
  "overFeed": 100.0,
  "actFeed": 80.0,
  "overRapid": 100.0,
  "channel": 2
}
```

**返回参数**

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| overSpindle | Float | 主轴转速倍率[%] |
| actSpindle | Float | 实际主轴转速 |
| overFeed | Float | 进给倍率[%] |
| actFeed | Float | 实际进给速率 |
| overRapid | Float | 快速倍率[%] |
| channel | Int32 | 机台通道号，仅当请求中补充 channel 且不为 0 时出现 |

> 注：当有多个主轴时，仅返回第一主轴转速数据。

---

### 2.5.1.9 readLaserPower 读取激光功率

仅限激光切割机/焊接机。

```
GET  /api/cnc/readLaserPower?machineID=MACHINEID
```

**请求参数**

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| machineID | String | （必需）目标机台标识，详见 1.1.1 machineID 机台标识 |

**返回示例**

```json
{
  "preset": 100.0,
  "actual": 100.0
}
```

**返回参数**

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| preset | Float | 预设功率[%] |
| actual | Float | 实际功率[%] |

---

### 2.5.1.10 readLoad 读取负载数据

仅限 CNC。

```
GET  /api/cnc/readLoad?machineID=MACHINEID&channel=CHANNEL
```

**请求参数**

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| machineID | String | （必需）目标机台标识，详见 1.1.1 machineID 机台标识 |
| channel | Int32 | 机台通道号，如不补充则默认为 0，即主通道 |

**返回示例**

```json
{
  "spindleLoad": [
    100.0,
    0.0
  ],
  "axialLoad": [
    50.1,
    12.4,
    0.0
  ],
  "channel": 2
}
```

**返回参数**

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| spindleLoad | Float[] | 主轴负载[%] |
| axialLoad | Float[] | 伺服轴负载[%] |
| channel | Int32 | 机台通道号，仅当请求中补充 channel 且不为 0 时出现 |

> 注：当有多个主轴时，主轴负载中数据对应依次为第一主轴、第二主轴。伺服轴负载与 2.5.1.15 readPosition 读取坐标数据返回的 axisName 按顺序一一对应。

---

### 2.5.1.11 readLog 读取日志信息

目前支持 Fanuc 机器人、ABB 机器人、模拟机台。

```
GET  /api/cnc/readLog?machineID=MACHINEID
```

**请求参数**

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| machineID | String | （必需）目标机台标识，详见 1.1.1 machineID 机台标识 |
| type | String | 类型，范围：Alarm（警报日志）、Operation（操作日志）、Default（默认），默认为 Default。ABB 机器人支持 Operation；Fanuc 机器人支持 Alarm；模拟机台支持所有类型，Default 等同 Operation |
| count | Int32 | 日志数量，获取最新的指定数量的日志内容，默认为 0，即获取所有日志 |

**返回示例**（ABB 机器人 Operation）

```json
{
  "msgs": [
    "{\"SeqNo\":\"79\",\"Type\":\"1 \",\"Code\":\"10011\",\"Title\":\"电机上电(ON) 状态\",\"Date\":\"2025-04-02 T 10:54:40\",\"Description\":\"系统处于电机上电 (ON) 状态。\",\"Args\":[]}",
    "{\"SeqNo\":\"78\",\"Type\":\"1 \",\"Code\":\"10010\",\"Title\":\"电机下电 (OFF) 状态\",\"Date\":\"2025-04-02 T 10:54:39\",\"Description\":\"系统处于电机下电 (OFF) 状态。\",\"Args\":[]}"
  ]
}
```

**返回参数**

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| msgs | String[] | （必需）日志内容。注：不同机台的日志内容格式不同 |

---

### 2.5.1.12 readOffsetData 读取刀补数据

```
GET  /api/cnc/readOffsetData?machineID=MACHINEID&channel=CHANNEL&toolNum=TOOLNUM&offsetNum=OFFSETNUM
```

**请求参数**

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| machineID | String | （必需）目标机台标识，详见 1.1.1 machineID 机台标识 |
| channel | Int32 | 机台通道号，如不补充则默认为 0，即主通道 |
| toolNum | Int32 | 补充 toolNum 刀具号或 offsetNum 刀补号，以确定目标刀具。请求参数对应表格 26 刀补数据 `<tag>` 数据标签中的标签，参考表格 27 刀补数据标签组合中各系统的标签组合表，补充请求参数组合 |
| offsetNum | Int32 | 同上 |

**返回示例**（Heidenhain 海德汉）

```json
{
  "toolNum": 1,
  "toolName": "MILL_D2_ROUGH",
  "toolType": "9",
  "lengthWear": 0.6,
  "radiusWear": 0.5,
  "lengthGeom": 30.0,
  "radiusGeom": 1.0,
  "radius2Wear": 0.2,
  "radius2Geom": 2.0
}
```

**返回示例**（Siemens 西门子）

```json
{
  "toolNum": 2,
  "offsetNum": 1,
  "toolName": "ROUGHING_T80 A",
  "toolType": 500,
  "toolNose": 3,
  "wearX": 0.88,
  "wearZ": 0.78,
  "wearR": 0.05,
  "geomX": 55.0,
  "geomZ": 39.0,
  "geomR": 0.8
}
```

**返回参数**

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| channel | Int32 | 机台通道号，仅当请求中补充 channel 且不为 0 时出现 |
| toolNum | Int32 | 刀具号 |
| offsetNum | Int32 | 刀补号 |
| toolName | String | 刀具名称 |
| toolType | String | 刀具类型 |
| lengthUnit | String | 刀补长度单位 |
| toolNose | Int32 | （假想）刀尖位置/刀沿类型 |
| lengthWear | Double | 长度磨损 |
| radiuWear | Double | 半径磨损 |
| lengthGeom | Double | 长度形状 |
| radiusGeom | Double | 半径形状 |
| wearX | Double | 长度 X 磨损 |
| wearY | Double | 长度 Y 磨损 |
| wearZ | Double | 长度 Z 磨损 |
| wearR | Double | 半径磨损 |
| geomX | Double | 长度 X |
| geomY | Double | 长度 Y |
| geomZ | Double | 长度 Z |
| geomR | Double | 半径 |

> 注：表中为通用的刀补参数，但不是全部刀补参数。建议在第一次添加新类型机床时测试可读取的刀补参数。如需要获取机床中有但当前接口未添加的刀补设置参数，请咨询客服。

---

### 2.5.1.13 batchReadOffsetData 批量读取刀具补偿

此接口为 2.5.1.12 readOffsetData 读取刀补数据的批量化版本，通过在请求体中补充目标刀具列表，可以一次读取多组数据。

```
POST  /api/cnc/batchReadOffsetData?machineID=MACHINEID
```

**请求体示例** application/json：

```json
[
  {
    "toolNum": 1,
    "offsetNum": 1,
    "channel": 2
  },
  {
    "toolNum": 1,
    "offsetNum": 2,
    "channel": 2
  }
]
```

**请求参数**（与 2.5.1.12 readOffsetData 一致）

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| machineID | String | （必需）目标机台标识，详见 1.1.1 machineID 机台标识 |
| channel | Int32 | 机台通道号，如不补充则默认为 0，即主通道 |
| toolNum | Int32 | 补充 toolNum 刀具号或 offsetNum 刀补号，以确定目标刀具 |
| offsetNum | Int32 | 同上 |

**返回示例**

```json
[
  {
    "toolNum": 1,
    "offsetNum": 1,
    "lengthUnit": "MM",
    "toolNose": 3,
    "lengthWear": 0.0001,
    "radiusWear": 0.03,
    "lengthGeom": 5.0,
    "radiusGeom": 0.2,
    "channel": 2
  },
  {
    "toolNum": 1,
    "offsetNum": 2,
    "lengthUnit": "MM",
    "toolNose": 4,
    "lengthWear": 0.01,
    "radiusWear": 0.02,
    "lengthGeom": 6.0,
    "radiusGeom": 0.3,
    "channel": 2
  }
]
```

返回参数与 2.5.1.12 readOffsetData 读取刀补数据一致。如果某条请求失败，则返回数组中对应位置为该请求的错误信息。

---

### 2.5.1.14 writeOffsetData 写入刀补数据

```
POST  /api/cnc/writeOffsetData?machineID=MACHINEID&channel=CHANNEL&toolNum=TOOLNUM&offsetNum=OFFSETNUM
```

**请求体示例** application/json：

```json
{
  "toolNose": 3,
  "lengthWear": 0.0001,
  "radiusWear": 0.03,
  "lengthGeom": 5.0,
  "radiusGeom": 0.2
}
```

> 注：请求体中仅补充需要写入的参数。不改动的参数不用补充。

**请求参数**

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| machineID | String | （必需）目标机台标识，详见 1.1.1 machineID 机台标识 |
| channel | Int32 | 机台通道号，如不补充则默认为 0，即主通道 |
| toolNum | Int32 | 补充 toolNum 刀具号或 offsetNum 刀补号，以确定目标刀具 |
| offsetNum | Int32 | 同上 |
| toolName | String | 刀具名称（Siemens 西门子系统中为只读参数，不可写入） |
| toolType | String | 刀具类型（Okuma 大隈系统中为只读参数，不可写入） |
| lengthUnit | String | 刀补长度单位 |
| toolNose | Int32 | （假想）刀尖位置/刀沿类型 |
| lengthWear | Double | 长度磨损 |
| radiuWear | Double | 半径磨损 |
| lengthGeom | Double | 长度形状 |
| radiusGeom | Double | 半径形状 |
| wearX | Double | 长度 X 磨损 |
| wearY | Double | 长度 Y 磨损 |
| wearZ | Double | 长度 Z 磨损 |
| wearR | Double | 半径磨损 |
| geomX | Double | 长度 X |
| geomY | Double | 长度 Y |
| geomZ | Double | 长度 Z |
| geomR | Double | 半径 |

**返回示例**

```json
{
  "errorCode": 0,
  "errorMsg": "Success"
}
```

**返回参数**

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| errorCode | Int32 | （必需）错误码，0 代表成功 |
| errorMsg | String | （必需）错误内容 |

---

### 2.5.1.15 readPosition 读取坐标数据

```
GET  /api/cnc/readPosition?machineID=MACHINEID&channel=CHANNEL
```

**请求参数**

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| machineID | String | （必需）目标机台标识，详见 1.1.1 machineID 机台标识 |
| channel | Int32 | 机台通道号，如不补充则默认为 0，即主通道 |

**返回示例**

```json
{
  "axisName": ["X", "Y", "Z"],
  "unit": ["mm", "mm", "mm"],
  "mach": [150.12, 0, -31.35],
  "abs": [150.12, 0, -31.35],
  "rel": [150.12, 0, -31.35],
  "dist": [9.88, 0, 31.35],
  "channel": 2
}
```

**返回参数**

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| axisName | String[] | （必需）轴名称 |
| unit | String[] | 单位 |
| mach | Float[] | 机械坐标 |
| abs | Float[] | 绝对坐标 |
| rel | Float[] | 相对坐标 |
| dist | Float[] | 剩余距离 |
| channel | Int32 | 机台通道号，仅当请求中补充 channel 且不为 0 时出现 |

> 注：各坐标数据与 axisName 中的坐标名按顺序对应。

---

### 2.5.1.16 readProgramBlock 读取程序段

此接口读取机台正在运行的程序段。

```
GET  /api/cnc/readProgramBlock?machineID=MACHINEID&channel=CHANNEL
```

**请求参数**

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| machineID | String | （必需）目标机台标识，详见 1.1.1 machineID 机台标识 |
| channel | Int32 | 机台通道号，如不补充则默认为 0，即主通道 |

**返回示例**

```json
{
  "currentBlock": "Y70.800",
  "channel": 2
}
```

**返回参数**

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| currentBlock | String | （必需）当前运行的程序段内容 |
| channel | Int32 | 机台通道号，仅当请求中补充 channel 且不为 0 时出现 |

---

### 2.5.1.17 readProgramInfo 读取加工程序信息

```
GET  /api/cnc/readProgramInfo?machineID=MACHINEID&channel=CHANNEL
```

**请求参数**

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| machineID | String | （必需）目标机台标识，详见 1.1.1 machineID 机台标识 |
| channel | Int32 | 机台通道号，如不补充则默认为 0，即主通道 |

**返回示例**

```json
{
  "mainPrgmName": "1234",
  "runningPrgName": "abcd",
  "programSeqNum": "N30",
  "programStack": "A/B/1234/abcd",
  "channel": 2
}
```

**返回参数**

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| mainPrgmName | String | （必需）主程序名 |
| runningPrgName | String | （必需）当前执行子程序名 |
| programSeqNum | String | 当前执行子程序段顺序号 |
| programStack | String | 程序堆栈，当前仅支持西门子和模拟机台 |
| channel | Int32 | 机台通道号，仅当请求中补充 channel 且不为 0 时出现 |

> 注：对于 Fanuc 发那科，标准程序名（字母 O+数字）中数字开头的零会自动去除，如在机床中显示程序名为 O0010，则返回程序名为 010。

---

### 2.5.1.18 readPlcData 读取 PLC 数据

使用此接口前，需要已知目标数据的 PLC 区域地址以及目标数据的类型。用户可以查找设备手册或联系设备厂家以获取相应信息。

```
GET  /api/cnc/readPlcData?machineID=MACHINEID&area=AREA&start=START&count=COUNT&type=TYPE
```

**请求参数**

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| machineID | String | （必需）目标机台标识，详见 1.1.1 machineID 机台标识 |
| area | String | （必需）区域。格式为 `{areaName}|{parameter1}|{paramter2}…`，其中 areaName 为区域名，parameter 是补充参数。areaName 为 PLC 的区域，比如 R、X、Y 等，可以从机床手册或厂家获取；如使用标准协议-MODBUS 通信，areaName 为 0x、1x、3x、4x 等分区名；网关支持一些特殊区域名，包括 $MACRO$宏变量，$PARAMS$系统参数，$TAG$标签等，参照表格 52 PLC 数据特殊区域与参数 |
| start | String | 起始地址。如非 10 进制，请参照表格 53 PLC 地址位进制前缀添加前缀 |
| count | Int32 | （必需）数据数量。对于非 String 类型，是目标数据的数量；对于 String 类型，是目标 String 的长度（以 Byte 计） |
| type | String | （必需）数据类型。目前支持的数据类型详见表格 54 PLC 数据类型 |
| channel | Int32 | 机台通道号，如不补充则默认为 0，即主通道 |

**表格 51 PLC 数据通用区域与参数**

| 设备系统 | 区域 | area 示例 | 备注 |
|---------|------|-----------|------|
| 全部设备系统 | 普通区域 | X | PLC 设备的 X 区域 |
| 全部设备系统 | 普通区域 | X\|s=S | 如与当前连接的 PLC 所连接的其它 PLC 通信，可补充 station 或 slot 或 salveID(MODBUS)；不补充 s 则默认为与当前连接的 PLC 通信。此参数目前仅部分 PLC 设备支持 |

**表格 52 PLC 数据特殊区域与参数（部分）**

| 系统型号 | 区域 | area 示例 | 备注 |
|---------|------|-----------|------|
| Bosunman 博尚 | MODBUS 地址 | 0x 或 1x 或 4x | |
| Brother 兄弟 | 宏变量 | $MACRO$ | |
| Delta 台达 | 宏变量 | $MACRO$ | |
| Fanuc 发那科 | 诊断数据 | $DIAG$ | |
| Fanuc 发那科 | 宏变量 | $MACRO$ | |
| Fanuc 发那科 | 系统参数 | $PARAMS$ | 支持 Byte、Int16、Int32 与 Double 等类型；部分参数需要补充轴号，如 axis=1 |
| Gsk 广州数控 [980, 988] | 宏变量 | $MACRO$ | |
| Haas 哈斯 [通用型] | 宏变量 | $MACRO$ | |
| Siemens 西门子 | 宏变量（R 参数） | $MACRO$\|type=R | |
| Siemens 西门子 | 宏变量（RG 参数） | $MACRO$\|type=RG | |
| Siemens 西门子 [通用型] | 标签（变量名） | $TAG$\|area=AREA\|block=BLOCK\|name=NAME\|areaNo=AREANO\|row=ROW\|column=COLUMN | S7 变量，补充参数 Area、Block(Component)、VariableName、AreaNo.(默认为1)、Row(默认为1)、Column(默认为1) |

**表格 53 PLC 地址位进制前缀**

| 进制 | 前缀（数字 0+字母） | 示例 |
|------|-------------------|------|
| 2 进制 | 0b | 0b1001 |
| 8 进制 | 0 | 03671 |
| 10 进制 | 无 | 123 |
| 16 进制 | 0x | 0x5A7 |

**表格 54 PLC 数据类型（部分系统支持情况）**

| 数据类型 | Bit | Byte | SByte | Int16 | UInt16 | Float | Int32 | UInt32 | Double | String |
|---------|-----|------|-------|-------|--------|-------|-------|--------|--------|--------|
| 博尚 | O | O | O | O | O | O | O | O | O | |
| 兄弟 | O | | | O | | | | | | |
| 台达 | O | O | O | O | O | O | O | O | O | O |
| 发那科 | | O | O | O | O | O | O | | * | |
| 西门子 | O | O | | O | O | O | O | O | O | O |
| 模拟机台 | O | O | O | O | O | O | O | O | O | O |

O: 支持；*: 仅支持宏变量（本地变量、公共变量等）使用该数据类型

**返回示例**（普通区域，Int32 数组）

```json
{
  "data": [2147483647, -616240881, 1351548766, 1408080714, -1677592641, 681965706, 1002992212, -1588442413]
}
```

**返回示例**（String 类型）

```json
{
  "msg": "Test string"
}
```

**返回参数**

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| data | Array[Object] | 请求参数中的 type 类型为除 String 以外的类型时，返回体中输出 data，类型为请求参数中指定的 type 类型数组，长度为请求参数中输入的数据数量 count |
| msg | String | 请求参数中的 type 类型为 String 时，返回体中输出 msg。msg 末尾的空位会自动截去 |
| channel | Int32 | 机台通道号，仅当请求中补充 channel 且不为 0 时出现 |

---

### 2.5.1.19 writePlcData 写入 PLC 数据

> **警告**：写入 PLC 数据有一定危险性，务必理解其风险，仅在安全情况下写入。默认设置下，网关屏蔽了该接口，使用前需要在网关管理页面**设置**页面打开对应选项。

使用此接口前，需要已知目标数据的 PLC 区域地址以及目标数据的类型。

```
POST  /api/cnc/writePlcData?machineID=MACHINEID&area=AREA&start=START&type=TYPE
```

**请求体示例**（写入非 String 类型）application/json：

```json
{
  "data": [2147483647, -616240881, 1351548766, 1408080714]
}
```

**请求体示例**（写入 String 类型）：

```json
{
  "msg": "Test string"
}
```

**请求参数**

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| machineID | String | （必需）目标机台标识，详见 1.1.1 machineID 机台标识 |
| area | String | （必需）区域，格式同 readPlcData 的 area 参数 |
| start | String | 起始地址。如非 10 进制，请参照表格 53 PLC 地址位进制前缀添加前缀 |
| type | String | （必需）数据类型，详见表格 54 PLC 数据类型 |
| data | Array[Object] | type 类型为非 String 时，请求体中输入 data，类型为请求参数中指定的 type 类型数组 |
| msg | String | type 类型为 String 时，请求体中输入 msg |
| channel | Int32 | 机台通道号，如不补充则默认为 0，即主通道 |

**返回示例**

```json
{
  "errorCode": 0,
  "errorMsg": "Success"
}
```

**返回参数**

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| errorCode | Int32 | （必需）错误码，0 代表成功 |
| errorMsg | String | （必需）错误内容 |

---

### 2.5.1.20 readTimeData 读取机台时间数据

```
GET  /api/cnc/readTimeData?machineID=MACHINEID
```

**请求参数**

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| machineID | String | （必需）目标机台标识，详见 1.1.1 machineID 机台标识 |

**返回示例**

```json
{
  "cumulativePowerOnTimeMin": 34194,
  "cumulativePowerOnTimeMs": 0,
  "powerOnTimeMin": 2944,
  "powerOnTimeMs": 0,
  "cumulativeOperatingTimeMin": 6683,
  "cumulativeOperatingTimeMs": 13328,
  "operatingTimeMin": 0,
  "operatingTimeMs": 0,
  "cumulativeCuttingTimeMin": 0,
  "cumulativeCuttingTimeMs": 0,
  "cuttingTimeMin": 0,
  "cuttingTimeMs": 0,
  "lastCycleTimeMin": 4,
  "lastCycleTimeMs": 43000,
  "currentCycleTimeMin": 0,
  "currentCycleTimeMs": 0,
  "currentCuttingTimeMin": 0,
  "currentCuttingTimeMs": 0,
  "remainingCycleTimeMin": 0,
  "remainingCycleTimeMs": 0
}
```

**返回参数**

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| cumulativePowerOnTimeMin | Int32 | 累计通电时间 1[分钟] |
| cumulativePowerOnTimeMs | Int32 | 累计通电时间 2[毫秒] |
| powerOnTimeMin | Int32 | 当前通电时间 1[分钟] |
| powerOnTimeMs | Int32 | 当前通电时间 2[毫秒] |
| cumulativeOperatingTimeMin | Int32 | 累计运行时间 1[分钟] |
| cumulativeOperatingTimeMs | Int32 | 累计运行时间 2[毫秒] |
| operatingTimeMin | Int32 | 当前运行时间 1[分钟] |
| operatingTimeMs | Int32 | 当前运行时间 2[毫秒] |
| cumulativeCuttingTimeMin | Int32 | 累计加工（切削）时间 1[分钟] |
| cumulativeCuttingTimeMs | Int32 | 累计加工（切削）时间 2[毫秒] |
| cuttingTimeMin | Int32 | 当前加工（切削）时间 1[分钟] |
| cuttingTimeMs | Int32 | 当前加工（切削）时间 2[毫秒] |
| lastCycleTimeMin | Int32 | 上次循环时间 1[分钟] |
| lastCycleTimeMs | Int32 | 上次循环时间 2[毫秒] |
| currentCycleTimeMin | Int32 | 当前循环时间 1[分钟] |
| currentCycleTimeMs | Int32 | 当前循环时间 2[毫秒] |
| currentCuttingTimeMin | Int32 | 当前切削时间 1[分钟] |
| currentCuttingTimeMs | Int32 | 当前切削时间 2[毫秒] |
| remainingCycleTimeMin | Int32 | 剩余循环时间 1[分钟] |
| remainingCycleTimeMs | Int32 | 剩余循环时间 2[毫秒] |

> 注：接口仅返回机台系统支持的时间数据，各时间数据由对应的时间 1 和时间 2 换算相加得到，计算方法详见 1.2.24 TimeData：机台时间数据。

---

### 2.5.1.21 readToolLife 读取刀具寿命

```
GET  /api/cnc/readToolLife?machineID=MACHINEID&groupNum=GROUPNUM&toolIndex=TOOLINDEX&toolNum=TOOLNUM&offsetNum=OFFSETNUM
```

**请求参数**

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| machineID | String | （必需）目标机台标识，详见 1.1.1 machineID 机台标识 |
| groupNum | Int32 | 补充 groupNum 刀组号，或 toolIndex 组内序号，或 toolNum 刀具号，或 offsetNum 刀补号，以确定目标刀具 |
| toolIndex | Int32 | 同上 |
| toolNum | Int32 | 请求参数对应 1.2.25 ToolLife：刀具寿命数据中的标签，其中参数 groupNum 对应标签中的 toolGroupNum，参数 offsetNum 对应标签中的 toolOffsetNum，其他的参数与标签名称一致。参考 1.2.25 ToolLife：刀具寿命数据中各系统的标签组合表，补充请求参数组合 |
| offsetNum | Int32 | 同上 |

**返回示例**（Fanuc 发那科，计次）

```json
{
  "toolNum": 32,
  "toolIndex": 4,
  "toolGroupNum": 1,
  "countLimit": 100,
  "currentCount": 21
}
```

**返回示例**（Fanuc 发那科，计时）

```json
{
  "toolNum": 8,
  "toolIndex": 2,
  "toolGroupNum": 1,
  "timeLimit": 60000,
  "currentTime": 1380
}
```

**返回参数**

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| toolGroupNum | Int32 | 刀组号 |
| toolIndex | Int32 | 组内序号 |
| toolNum | Int32 | 刀具号 |
| toolOffsetNum | Int32 | 刀补号 |
| timeLimit | Int32 | 寿命极限[秒]，最大可用时间 |
| currentTime | Int32 | 当前寿命[秒]，已经使用的时间 |
| prewarningTime | Int32 | 预警寿命[秒]，当前寿命达到此值时发出警报 |
| countLimit | Int32 | 寿命极限[次]，最大可用次数 |
| currentCount | Int32 | 当前寿命[次]，已经使用的次数 |
| prewarningCount | Int32 | 预警寿命[次]，当前寿命达到此值时发出警报 |
| wearLimit | Int32 | 寿命极限[机床默认长度单位]，最大可磨损量 |
| currentWear | Int32 | 当前寿命[机床默认长度单位]，当前磨损量 |
| prewarningWear | Int32 | 预警寿命[机床默认长度单位]，当前寿命达到此值时发出警报 |

> 注：表中为通用的刀具寿命数据，为了所有机床系统标准统一，有些参数由原始数据换算得到。如需获取原始数据，可以使用 2.5.1.23 readToolLifeDetails 读取刀具寿命详情。各系统型号支持的寿命类型详见 1.2.25 ToolLife：刀具寿命数据。

---

### 2.5.1.22 batchReadToolLife 批量读取刀具寿命

此接口为 2.5.1.21 readToolLife 读取刀具寿命的批量化版本，通过在请求体中补充目标刀具列表，可以一次读取多组数据。

```
POST  /api/cnc/batchReadToolLife?machineID=MACHINEID
```

**请求体示例** application/json：

```json
[
  {
    "groupNum": 1,
    "toolIndex": 4
  },
  {
    "groupNum": 2,
    "toolIndex": 3
  }
]
```

**请求参数**（与 2.5.1.21 readToolLife 一致）

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| machineID | String | （必需）目标机台标识，详见 1.1.1 machineID 机台标识 |
| groupNum | Int32 | 补充 groupNum 刀组号，或 toolIndex 组内序号，或 toolNum 刀具号，或 offsetNum 刀补号，以确定目标刀具 |
| toolIndex | Int32 | 同上 |
| toolNum | Int32 | 同上 |
| offsetNum | Int32 | 同上 |

**返回示例**

```json
[
  {
    "toolNum": 32,
    "toolIndex": 4,
    "toolGroupNum": 1,
    "countLimit": 100,
    "currentCount": 21
  },
  {
    "toolNum": 23,
    "toolIndex": 3,
    "toolGroupNum": 2,
    "countLimit": 200,
    "currentCount": 58
  }
]
```

返回参数与 2.5.1.21 readToolLife 读取刀具寿命一致。如果某条请求失败，则返回数组中对应位置为该请求的错误信息。

---

### 2.5.1.23 readToolLifeDetails 读取刀具寿命详情

此接口除了读取到与 2.5.1.21 readToolLife 读取刀具寿命相同的通用刀具寿命数据，还能获取到未经处理的原始数据。一些不通用的刀具寿命数据会被添加到这个接口的返回参数中。

```
GET  /api/cnc/readToolLifeDetails?machineID=MACHINEID&groupNum=GROUPNUM&toolIndex=TOOLINDEX&toolNum=TOOLNUM&offsetNum=OFFSETNUM
```

**请求参数**（与 2.5.1.21 readToolLife 一致）

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| machineID | String | （必需）目标机台标识，详见 1.1.1 machineID 机台标识 |
| groupNum | Int32 | 补充 groupNum 刀组号，或 toolIndex 组内序号，或 toolNum 刀具号，或 offsetNum 刀补号，以确定目标刀具 |
| toolIndex | Int32 | 同上 |
| toolNum | Int32 | 同上 |
| offsetNum | Int32 | 同上 |

**返回示例**（Fanuc 发那科，计次）

```json
{
  "toolNum": 32,
  "toolIndex": 4,
  "toolGroupNum": 1,
  "countLimit": 100,
  "currentCount": 21,
  "rawToolLifeType": "Count",
  "rawToolLifeStatus": "Enabled"
}
```

**返回示例**（Fanuc 发那科，计时）

```json
{
  "toolNum": 8,
  "toolIndex": 2,
  "toolGroupNum": 1,
  "timeLimit": 60000,
  "currentTime": 1380,
  "rawToolLifeType": "Time",
  "rawToolLifeUnit": "Minute",
  "rawToolLifeStatus": "Enabled",
  "rawTimeLimit": 1000.0,
  "rawCurrentTime": 23.0
}
```

**返回示例**（Siemens 西门子，计时）

```json
{
  "toolNum": 1,
  "toolOffsetNum": 1,
  "timeLimit": 1800,
  "currentTime": 0,
  "prewarningTime": 1428,
  "rawToolLifeType": "Time",
  "rawToolLifeUnit": "Minute",
  "rawTimeLimit": 30.0,
  "rawRemainingTime": 30.0,
  "rawPrewarningRemainingTime": 6.2
}
```

**返回示例**（Siemens 西门子，计磨损）

```json
{
  "toolNum": 3,
  "toolOffsetNum": 1,
  "wearLimit": 2.0,
  "currentWear": 0.0,
  "prewarningWear": 1.0,
  "rawToolLifeType": "Wear",
  "rawRemainingWear": 2.0,
  "rawPrewarningRemainingWear": 1.0
}
```

**返回参数**

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| **通用数据** | | |
| groupNum | Int32 | 刀组号 |
| toolIndex | Int32 | 组内序号 |
| toolNum | Int32 | 刀具号 |
| toolOffsetNum | Int32 | 刀补号 |
| timeLimit | Int32 | 寿命极限[秒]，最大可用时间 |
| currentTime | Int32 | 当前寿命[秒]，已经使用的时间 |
| prewarningTime | Int32 | 预警寿命[秒]，当前寿命达到此值时发出警报 |
| countLimit | Int32 | 寿命极限[次]，最大可用次数 |
| currentCount | Int32 | 当前寿命[次]，已经使用的次数 |
| prewarningCount | Int32 | 预警寿命[次]，当前寿命达到此值时发出警报 |
| wearLimit | Int32 | 寿命极限[机床默认长度单位]，最大可磨损量 |
| currentWear | Int32 | 当前寿命[机床默认长度单位]，当前磨损量 |
| prewarningWear | Int32 | 预警寿命[机床默认长度单位]，当前寿命达到此值时发出警报 |
| **原始数据** | | |
| rawToolLifeType | String | 刀具寿命类型 |
| rawToolLifeUnit | String | 时间单位，以下简称为[时间] |
| rawToolLifeStatus | String | 刀具寿命状态 |
| rawTimeLimit | Double | 寿命极限[时间] |
| rawTimeLimit1 | Double | 刀具最长寿命[时间]，仅 Heidenhain 海德汉 |
| rawTimeLimit2 | Double | 调用刀具的最长寿命[时间]，仅 Heidenhain 海德汉 |
| rawCurrentTime | Double | 当前寿命[时间] |
| rawOverTime | Double | 超出刀具寿命[时间]，仅 Heidenhain 海德汉 |
| rawRemainingTime | Double | 剩余寿命[时间]，仅 Siemens 西门子 |
| rawPrewarningRemainingTime | Double | 预警剩余寿命[时间]，仅 Siemens 西门子 |
| rawRemainingCount | Int32 | 剩余寿命[次]，仅 Siemens 西门子 |
| rawPrewarningRemainingCount | Int32 | 预警剩余寿命[次]，仅 Siemens 西门子 |
| rawRemainingWear | Double | 剩余寿命[机床默认长度单位]，仅 Siemens 西门子 |
| rawPrewarningRemainingWear | Double | 预警剩余寿命[机床默认长度单位]，仅 Siemens 西门子 |
| inventoryNum | String | 刀具识别码，仅 Heidenhain 海德汉 |

> 注：表中通用数据部分即 2.5.1.21 readToolLife 读取刀具寿命中的返回参数。各系统型号支持的寿命类型详见 1.2.25 ToolLife：刀具寿命数据。

---

### 2.5.1.24 batchReadToolLifeDetails 批量读取刀具寿命详情

此接口为 2.5.1.23 readToolLifeDetails 读取刀具寿命详情的批量化版本，通过在请求体中补充目标刀具列表，可以一次读取多组数据。

```
POST  /api/cnc/batchReadToolLifeDetails?machineID=MACHINEID
```

**请求体示例** application/json：

```json
[
  {
    "groupNum": 1,
    "toolIndex": 4
  },
  {
    "groupNum": 2,
    "toolIndex": 3
  }
]
```

**请求参数**（与 2.5.1.23 readToolLifeDetails 一致）

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| machineID | String | （必需）目标机台标识，详见 1.1.1 machineID 机台标识 |
| groupNum | Int32 | 补充 groupNum 刀组号，或 toolIndex 组内序号，或 toolNum 刀具号，或 offsetNum 刀补号，以确定目标刀具 |
| toolIndex | Int32 | 同上 |
| toolNum | Int32 | 同上 |
| offsetNum | Int32 | 同上 |

**返回示例**

```json
[
  {
    "toolNum": 32,
    "toolIndex": 4,
    "toolGroupNum": 1,
    "countLimit": 100,
    "currentCount": 21
  },
  {
    "toolNum": 23,
    "toolIndex": 3,
    "toolGroupNum": 2,
    "countLimit": 200,
    "currentCount": 58
  }
]
```

返回参数与 2.5.1.23 readToolLifeDetails 读取刀具寿命详情一致。如果某条请求失败，则返回数组中对应位置为该请求的错误信息。

---

### 2.5.2 缓存读取

使用缓存读写类接口，网关会返回缓存中对应的自动采集任务数据。使用此类接口，必须启用网关的本地缓存功能（出厂设置默认开启），并且开启对应的自动采集任务。

---

### 2.5.2.1 readTaskData 读取机台任务数据

此接口从网关缓存中读取来自目标机台的任务数据，而不是向机台发出通讯请求读取数据，因此，通过此接口除了可以读取来自机台的原始数据（如机台状态、警报信息等），还能读取到经过网关统计处理的数据（过载时间、OEE 数据等），且运行效率更高，但前提是必须已开启目标数据对应的任务。

```
GET  /api/cnc/readTaskData?machineID=MACHINEID&type=TYPE&tag=TAG
```

**请求参数**

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| machineID | String | （必需）目标机台标识，详见 1.1.1 machineID 机台标识 |
| type | String | （必需）数据类型，详见 1.2 数据说明 |
| tag | String | 标签的字段形式，详见 1.2 数据说明 |

**示例**

获取 machineID 为 1010 的机台的 1 号主轴的过载数据，type=SpindleOverload，tag=S1，请求如下：

```
/api/cnc/readTaskData?machineID=1010&type=SpindleOverload&tag=S1
```

如果请求对应的机台任务未启用，或任务启用但是尚未执行时，返回结果为：

```json
{
  "errorCode": 1303,
  "errorMsg": "Task not ready."
}
```

工作正常时，以 JSON 格式返回指定数据类型的数据：

```json
{
  "cumulativeTime": 14367,
  "spindleNo": 1,
  "time": "2024-03-01T02:26:42.2781587Z"
}
```

> 注：返回参数中，time 是数据的获取时间。其它返回参数详见 1.2 数据说明中对应 type 包含的 field 与 tag 内容说明。

---

### 2.5.2.2 batchReadTaskData 批量读取机台任务数据

此接口为 2.5.2.1 readTaskData 读取机台任务数据的批量化版本，通过在请求体中补充目标数据列表，可以一次读取多组数据，前提是必须已开启目标数据对应的任务。

```
POST  /api/cnc/batchReadTaskData
```

**请求体示例** application/json：

```json
[
  {
    "machineID": "1",
    "type": "CNCStatus"
  },
  {
    "machineID": "2110",
    "type": "Count"
  },
  {
    "machineID": "3",
    "type": "PLC",
    "tag": "TR0"
  }
]
```

**请求参数**（与 2.5.2.1 readTaskData 一致）

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| machineID | String | （必需）目标机台标识，详见 1.1.1 machineID 机台标识 |
| Type | String | （必需）数据类型，详见 1.2 数据说明 |
| Tag | String | 标签的字段形式，详见 1.2 数据说明 |

**返回示例**

```json
[
  {
    "cncStatus": "AUTO_RUN",
    "alarmStatus": "ALARM",
    "alarmLevel": "WRN",
    "mode": "AUTO_RUN",
    "programStatus": "RUNNING",
    "emergencyStatus": "NOT_EMG",
    "dryRunStatus": "NOT_DRY_RUN",
    "adjustedStatus": "AUTO_RUN",
    "offTime": 2509,
    "waitTime": 2123,
    "emergencyTime": 25,
    "autoRunTime": 1526,
    "manualTime": 2905,
    "time": "2024-03-01T02:26:48.7383566Z"
  },
  {
    "count": 22406,
    "cumulativeCount": 0,
    "currentCount": 0,
    "time": "2024-03-01T02:26:49.8853233Z"
  },
  {
    "data": [32767],
    "tag": "R0",
    "time": "2024-03-01T02:26:49.3324829Z"
  }
]
```

返回结果顺序与请求顺序一致。如果某条请求失败，则返回数组中对应位置为该请求的错误信息。

> 注：返回参数中，time 是数据的获取时间。其它返回参数详见 1.2 数据说明中对应 type 包含的 field 与 tag 内容说明。

---

### 2.5.2.3 readGroupTaskData 读取机组任务数据

此接口从网关缓存中读取目标机组正在运行的目标任务的最新数据，前提是必须已开启目标机组的目标数据对应的任务。

```
GET  /api/cnc/readGroupTaskData?groupID=GROUPID&type=TYPE&tag=TAG
```

**请求参数**

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| groupID | String | （必需）目标机组标识，详见 1.1.2 groupID 机组标识 |
| type | String | （必需）数据类型，目前仅支持 1.2.11 GroupCount：机组加工计数数据、1.2.12 GroupCumulativeTime：机组累计状态时间，和 1.2.13 GroupOEE：机组 OEE |
| tag | String | 标签的字段形式，详见 1.2 数据说明 |

**示例**

获取 groupID 为 g2 的机组加工计数数据，type=GroupCount，请求如下：

```
/api/cnc/readGroupTaskData?groupID=g2&type=GroupCount
```

如果请求对应的机组任务未启用，或任务启用但尚未执行时，返回结果为：

```json
{
  "errorCode": 1303,
  "errorMsg": "Task not ready."
}
```

工作正常时，返回指定数据类型的数据：

```json
{
  "cumulativeCount": 127,
  "time": "2024-03-01T02:26:50.1127663Z"
}
```

---

### 2.5.2.4 batchReadGroupTaskData 批量读取机组任务数据

此接口为 2.5.2.3 readGroupTaskData 读取机组任务数据的批量化版本，通过在请求体中补充目标数据列表，可以一次读取多组数据，前提是必须已开启目标数据对应的任务。

```
POST  /api/cnc/batchReadTaskData
```

**请求体示例** application/json：

```json
[
  {
    "groupID": "1",
    "type": "GroupOEE"
  },
  {
    "groupID": "2",
    "type": "GroupCount"
  }
]
```

**请求参数**（与 2.5.2.1 readTaskData 一致）

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| groupID | String | 目标机组标识，详见 1.1.2 groupID 机组标识 |
| type | String | 数据类型，目前仅支持 1.2.11 GroupCount、1.2.12 GroupCumulativeTime 和 1.2.13 GroupOEE |
| tag | String | 标签的字段形式，详见 1.2 数据说明 |

**返回示例**

```json
[
  {
    "autoRunCount": 1,
    "waitCount": 0,
    "emergencyCount": 0,
    "manualCount": 0,
    "offCount": 0,
    "availability": 90.0,
    "offTime": 360,
    "waitTime": 0,
    "emergencyTime": 0,
    "autoRunTime": 3240,
    "manualTime": 0,
    "time": "2024-03-01T02:27:30.5534659Z"
  },
  {
    "cumulativeCount": 127,
    "time": "2024-03-01T02:27:30.6533778Z"
  }
]
```

返回结果顺序与请求顺序一致。如果某条请求失败，则返回数组中对应位置为该请求的错误信息。

---

### 2.5.2.5 batchReadErrors 批量读取机台连接状态

此接口用于批量获取指定机台当前连接状态，通过在请求体中补充目标机台标识，可以一次读取多台机台的连接状态。

```
POST  /api/cnc/batchReadErrors
```

**请求体示例** application/json：

```json
[
  {
    "machineID": "1"
  },
  {
    "machineID": "2"
  }
]
```

**请求参数**

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| machineID | String | （必需）目标机台标识，详见 1.1.1 machineID 机台标识 |

**返回示例**

```json
[
  {
    "errorCode": 0,
    "errorMsg": "Success"
  },
  {
    "errorCode": 3,
    "errorMsg": "Machine offline."
  }
]
```

返回结果顺序与请求顺序一致。

**返回参数**

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| errorCode | Int32 | （必需）错误码，0 代表连接成功 |
| errorMsg | String | （必需）错误内容 |

---

### 2.5.2.6 readErrorSummary 读取状态简报

此接口用于获取当前机台连接状态简报，无需请求参数。

```
GET  /api/cnc/readErrorSummary
```

**返回示例**

```json
{
  "success": 8,
  "offline": 1,
  "error": 0
}
```

**返回参数**

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| success | Int32 | （必需）连接成功机台数 |
| offline | Int32 | （必需）离线机台数 |
| error | Int32 | （必需）连接错误机台数 |

---

## 2.6 文件管理接口

通过文件管理接口可以连接目标文件服务器，实现读取文件列表、接收、发送、删除、锁定、解锁文件，创建、删除目录等功能。

目前支持文件传输的文件服务器类型有"机台存储器"、"FTP 服务器"、"共享文件夹"等（详见《说明书》5.3.1. 添加机台下的各类型机台的程序传输设置），默认为"机台存储器"。部分机床系统可以开启本地 FTP 服务器或共享文件夹的选项以传输文件。而对于部分机台自身存储空间小，或者机台不支持直接访问其存储空间，可以通过外接文件服务器的方式，实现文件传输功能。

大部分文件管理接口都可以补充请求参数 `dirAtCNC` 或 `subDir` 以指定机台或文件服务器的目录路径，如不补充 `dirAtCNC` 或 `subDir`，则默认在根目录下执行对应文件操作。用户可以指定根目录路径（详见《说明书》5.3.1. 添加机台下的各类型机台的程序传输设置）。如用户未指定根目录路径，则使用如下默认根目录路径。

**表格 55 各系统型号默认根目录路径**

| 文件服务器类型 | 系统（型号） | 指定目标目录路径 | 默认根目录路径 |
|--------------|------------|----------------|--------------|
| 机台存储器 | Brother 兄弟 [TC 系列] | X | / |
| 机台存储器 | Brother 兄弟 [S 系列] | O | / |
| 机台存储器 | Delta 台达 [通用型] | O | B:\ |
| 机台存储器 | Fagor 法格 [所有型号] | O | MEMORY |
| 机台存储器 | Fanuc 发那科 [0i-D, 0i-F, 30i, 31i, 32i, 35i, Power Motion i-A]★ | O | //CNC_MEM/ |
| 机台存储器 | Fanuc 发那科 [除 0i-D, 0i-F, 30i, 31i, 32i, 35i, Power Motion i-A 以外型号] | X | 当前机台设定的前台目录，不固定，如 //CNC_MEM/ |
| 机台存储器 | Gsk 广数 [980, 988] | O | /user/NCPROG |
| 机台存储器 | Haas 哈斯 [通用型, MT-CONNECT] | O | 无 |
| 机台存储器 | Heidenhain 海德汉 [TNC640, TNC640 DNC] | O | TNC:\nc_prog |
| 机台存储器 | Heidenhain 海德汉 [iTNC530] | O | TNC:\ |
| 机台存储器 | Lynuc 锑纳克 [所有型号] | O | /home/Lynuc/Users/NCFiles |
| 机台存储器 | Mitsubishi 三菱 [所有型号]★★ | O | PRG\USER\ |
| 机台存储器 | Mock 模拟机台 | O | / |
| 机台存储器 | Okuma 大隈 [所有型号] | O | MD1 |
| 机台存储器 | Rexroth 力士乐 [OPC UA] | O | Filesystem/prog |
| 机台存储器 | Siemens 西门子 [通用型] | O | /nckfs |
| 机台存储器 | Siemens 西门子 [OPC UA] | O | Sinumerik/FileSystem/PartProgram |
| 机台存储器 | Siemens 西门子 [810D/840D] | O | mpf.dir |
| 机台存储器 | 其它支持程序传输功能的系统型号 | X | 机台默认存储目录 |
| FTP 服务器 | | O | FTP 服务器根目录 |
| 共享文件夹 | | O | 无 |
| 共享文件夹 (Win XP) | | O | 无 |
| 无线传输盒 | | O | / |
| 网关文件服务器 | | O | / |

O: 支持；X: 不支持

★: FANUC 发那科 [0i-F, 30i, 31i, 32i, 35i, Power Motion i-A] 可以修改目标目录路径为外接 CF 卡，如 //MEMCARD/。

★★: Mitsubishi 三菱 [M700 系列, M800 系列] 可以修改目标目录路径为外接 CF 卡（M700 系列）或 SD 卡（M800 系列），如 IC1。

---

## 2.6.1 readProgramList 读取机台文件列表

```
GET  /api/cnc/readProgramList?machineID=MACHINEID&dirAtCNC=DIRATCNC&subDir=SUBDIR
```

**请求参数**

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| machineID | String | （必需）目标机台标识，详见 1.1.1 machineID 机台标识 |
| dirAtCNC | String | 指定目标目录路径。如未补充该参数，则默认为默认根目录路径。各机台系统型号默认根目录路径见表格 55。 |
| subDir | String | 指定目标子目录路径。如未输入 dirAtCNC，自动将根目录路径与子目录路径拼接为 dirAtCNC。如 dirAtCNC 与 subDir 同时输入，subDir 被忽略。 |

**返回示例**

```json
{
  "dirAtCNC": "Dir/Prog",
  "programs": [
    "1111",
    "2322",
    "3222"
  ],
  "subDirs": [
    "dir1",
    "dir2"
  ]
}
```

**返回参数**

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| dirAtCNC | String | （必需）指定目录路径。一般与请求参数中的 dirAtCNC 一致，除非：1. 该设备只有一个未给出具体路径的默认目录存放文件与文件夹，这种情况下返回参数 dirAtCNC 为空；2. 未补充请求参数 dirAtCNC 或请求参数 dirAtCNC 为空，则返回参数 dirAtCNC 为默认根目录路径；3. 请求参数 dirAtCNC 指定的路径存在，但不符合系统路径格式，此时返回参数 dirAtCNC 为自动修正后的路径。 |
| programs | String[] | （必需）指定目录下的程序（文件）列表 |
| subDirs | String[] | （必需）指定目录下的子文件夹列表。部分系统型号无法获取文件夹列表，返回的 subDirs 为空。 |

**表格 56 各系统型号读取机台文件列表接口对获取子文件夹列表支持**

| 文件服务器类型 | 系统（型号） | 获取文件列表 | 获取子文件夹列表 |
|--------------|------------|------------|--------------|
| 机台存储器 | Brother 兄弟 [所有型号] | O | O |
| 机台存储器 | Fagor 法格 [所有型号] | O | X |
| 机台存储器 | Fanuc 发那科 [0i-D, 0i-F, 30i, 31i, 32i, 35i, Power Motion i-A] | * | O |
| 机台存储器 | Fanuc 发那科 [除 0i-D, 0i-F, 30i, 31i, 32i, 35i, Power Motion i-A 以外型号] | O | X |
| 机台存储器 | Heidenhain 海德汉 [所有型号] | O | O |
| 机台存储器 | Lynuc 锑纳克 [所有型号] | O | O |
| 机台存储器 | Mitsubishi 三菱 [所有型号] | O | X |
| 机台存储器 | Mock 模拟机台 | O | O |
| 机台存储器 | Okuma 大隈 [所有型号] | O | O |
| 机台存储器 | Rexroth 力士乐 [OPC UA] | O | O |
| 机台存储器 | Siemens 西门子 [所有型号] | O | O |
| 机台存储器 | 其它支持程序传输功能的系统型号 | O | X |
| FTP 服务器 | | O | O |
| 共享文件夹 | | O | O |
| 共享文件夹 (Win XP) | | O | O |
| 无线传输盒 | | O | O |
| 网关文件服务器 | | O | O |

O: 支持；X: 不支持

\*: FANUC 发那科 [0i-D, 0i-F, 30i, 31i, 32i, 35i, Power Motion i-A] 返回标准 FANUC 程序名（字母 O+数字），自动去除数字左侧的零，如在机床中程序名为 O0010，返回 010。非标准命名程序则与机床上一致，如在机床中程序名为 SAMPLE，返回 SAMPLE。

---

## 2.6.2 receiveFileStream 接收机台文件（Stream 方式）

此接口可接收文本文件和二进制文件，相比 2.6.3 receiveFile 接收机台文件，增加了对 10MB 以上大文件支持。建议用户尽量使用 `/receiveFileStream` 接口。

```
GET  /api/cnc/receiveFileStream?machineID=MACHINEID&fileName=FILENAME&dirAtCNC=DIRATCNC&subDir=SUBDIR
```

**请求参数**

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| machineID | String | （必需）目标机台标识，详见 1.1.1 machineID 机台标识 |
| fileName | String | （必需）目标文件的文件名，参考 2.6.1 readProgramList 或 2.6.15 readAllPrograms 接口返回的文件名。部分系统型号，如 Gsk 广数，Siemens 西门子等，文件名必须包括文件扩展名。 |
| dirAtCNC | String | 指定目标目录路径。如未补充该参数，则默认为默认根目录路径。各机台系统型号默认根目录路径见表格 55。 |
| subDir | String | 指定目标子目录路径。如未输入 dirAtCNC，自动将根目录路径与子目录路径拼接为 dirAtCNC。如 dirAtCNC 与 subDir 同时输入，subDir 被忽略。 |

**返回示例**

目标文件为文本文件，返回体示例 `application/octet-stream`：

```gcode
%
O0001
G21 G90 G40
T01 M06
G90 G0 G54 X12.64 Y88.0 s2546
G43 H01 Z15.0 M8
G81 G98 Z-20. R1.F200.
x70.
X85.
x100.
x170.
X185.
x200.
G80
G00 x100. Y200
G28 G91 z0 M9
M30
%
```

目标文件为二进制文件，以 binary 格式出现在返回体。

---

## 2.6.3 receiveFile 接收机台文件

此接口可接收文本文件和二进制文件，相比 2.6.2 receiveFileStream 接收机台文件（Stream 方式），此接口不支持 10MB 以上大文件。建议用户尽量使用 `/receiveFileStream` 接口。

```
GET  /api/cnc/receiveFile?machineID=MACHINEID&fileName=FILENAME&dirAtCNC=DIRATCNC&subDir=SUBDIR
```

**请求参数**

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| machineID | String | （必需）目标机台标识，详见 1.1.1 machineID 机台标识 |
| fileName | String | （必需）目标文件的文件名，参考 2.6.1 readProgramList 或 2.6.15 readAllPrograms 接口返回的文件名。部分系统型号，如 Gsk 广数，Siemens 西门子等，文件名必须包括文件扩展名。 |
| dirAtCNC | String | 指定目标目录路径。如未补充该参数，则默认为默认根目录路径。各机台系统型号默认根目录路径见表格 55。 |
| subDir | String | 指定目标子目录路径。如未输入 dirAtCNC，自动将根目录路径与子目录路径拼接为 dirAtCNC。如 dirAtCNC 与 subDir 同时输入，subDir 被忽略。 |

**返回示例**

当文件为文本格式时：

```json
{
  "content": "string",
  "encoding": "us-ascii"
}
```

当文件为二进制格式时：

```json
{
  "base64": "string"
}
```

**返回参数**

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| content | String | 文件内容 |
| encoding | String | 原文件的编码 |
| base64 | String | 当文件为二进制格式时，网关将使用 Base64 编码将二进制内容转换成字符串。用户可自行解码获取二进制文件。 |

---

## 2.6.4 readCurrentProgram 接收机台当前运行的文件

```
GET  /api/cnc/readCurrentProgram?machineID=MACHINEID&dirAtCNC=DIRATCNC&subDir=SUBDIR
```

**请求参数**

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| machineID | String | （必需）目标机台标识，machineID 解释见 1.1 基本说明 |
| dirAtCNC | String | 指定目标目录路径。如未补充该参数，则默认为默认根目录路径。各机台系统型号默认根目录路径见表格 55。 |
| subDir | String | 指定目标子目录路径。如未输入 dirAtCNC，自动将根目录路径与子目录路径拼接为 dirAtCNC。如 dirAtCNC 与 subDir 同时输入，subDir 被忽略。 |

**返回示例**

当文件为文本格式时：

```json
{
  "dirAtCNC": "Dir/Prog",
  "fileName": "09001",
  "content": "string",
  "encoding": "us-ascii"
}
```

当文件为二进制格式时：

```json
{
  "dirAtCNC": "Dir/Prog",
  "fileName": "Program",
  "base64": "string"
}
```

当前没有运行文件时：

```json
{
  "errorCode": 158,
  "errorMsg": "Path is not found.",
  "statusMsg": "No content."
}
```

**返回参数**

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| dirAtCNC | String | 机台当前正在运行的文件的目录路径 |
| fileName | String | 机台当前正在运行的文件的文件名 |
| content | String | 文件内容 |
| encoding | String | 原文件的编码 |
| base64 | String | 当文件为二进制格式时，网关将使用 Base64 编码将二进制内容转换成字符串。用户可自行解码获取二进制文件。 |
| errorCode | Int32 | 错误码，0 代表成功。 |
| errorMsg | String | 错误内容 |
| statusMsg | String | 错误详情 |

---

## 2.6.5 sendFileStream 发送文件至机台（Stream 方式）

此接口可发送文本文件和二进制文件，相比 2.6.6 sendFile 发送文件至机台，增加了对 10MB 以上大文件支持。建议用户尽量使用 `/sendFileStream` 接口。

不支持覆盖同名文件。请先删除同名文件，再发送。

```
POST  /api/cnc/sendFileStream?machineID=MACHINEID&fileName=FILENAME&dirAtCNC=DIRATCNC&subDir=SUBDIR
```

**请求示例**

目标文件为文本文件，请求体示例 `application/octet-stream`：

```gcode
%
O0001
G21 G90 G40
T01 M06
G90 G0 G54 X12.64 Y88.0 s2546
G43 H01 Z15.0 M8
G81 G98 Z-20. R1.F200.
x70.
X85.
x100.
x170.
X185.
x200.
G80
G00 x100. Y200
G28 G91 z0 M9
M30
%
```

目标文件为二进制文件，以 binary 格式上传到请求体。

**请求参数**

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| machineID | String | （必需）目标机台标识，详见 1.1.1 machineID 机台标识 |
| fileName | String | 目标文件在机台上的文件名，部分系统型号，如 Gsk 广数，Siemens 西门子等，文件名必须包括文件扩展名，可以参考 2.6.1 readProgramList 或 2.6.15 readAllPrograms 接口返回的文件名。对于 FANUC 系统，fileName 无效，程序名为 Content 中第一个 \n 与第二个 \n 之间的内容。 |
| dirAtCNC | String | 指定目标目录路径。如未补充该参数，则默认为默认根目录路径。各机台系统型号默认根目录路径见表格 55。 |
| subDir | String | 指定目标子目录路径。如未输入 dirAtCNC，自动将根目录路径与子目录路径拼接为 dirAtCNC。如 dirAtCNC 与 subDir 同时输入，subDir 被忽略。 |

**返回示例**

```json
{
  "errorCode": 0,
  "errorMsg": "Success"
}
```

**返回参数**

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| errorCode | Int32 | （必需）错误码，0 代表成功。 |
| errorMsg | String | （必需）错误内容 |

---

## 2.6.6 sendFile 发送文件至机台

此接口可发送文本文件和二进制文件，相比 2.6.5 sendFileStream 发送文件至机台（Stream 方式），此接口不支持 10MB 以上大文件。建议用户尽量使用 `/sendFileStream` 接口。

不支持覆盖同名文件。请先删除同名文件，再发送。

```
POST  /api/cnc/sendFile?machineID=MACHINEID&fileName=FILENAME&dirAtCNC=DIRATCNC&subDir=SUBDIR
```

**请求体示例 application/json**

当文件为文本格式时：

```json
{
  "content": "string",
  "encoding": "us-ascii"
}
```

当文件为二进制格式时：

```json
{
  "base64": "string"
}
```

**请求参数**

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| machineID | String | （必需）目标机台标识，详见 1.1.1 machineID 机台标识 |
| fileName | String | 目标文件在机台上的文件名，部分系统型号，如 Gsk 广数，Siemens 西门子等，文件名必须包括文件扩展名，可以参考 2.6.1 readProgramList 或 2.6.15 readAllPrograms 接口返回的文件名。对于 FANUC 系统，fileName 无效，程序名为 Content 中第一个 \n 与第二个 \n 之间的内容。 |
| dirAtCNC | String | 指定目标目录路径。如未补充该参数，则默认为默认根目录路径。各机台系统型号默认根目录路径见表格 55。 |
| subDir | String | 指定目标子目录路径。如未输入 dirAtCNC，自动将根目录路径与子目录路径拼接为 dirAtCNC。如 dirAtCNC 与 subDir 同时输入，subDir 被忽略。 |
| content | String | 文件内容。当文件为文本格式时，应使用此参数。当 content 被定义时，base64 参数将被忽略。 |
| encoding | String | 原文件的编码。如果不注明，默认使用机台配置中设定编码。 |
| base64 | String | 当文件为二进制格式时，应使用此参数。请使用 Base64 编码将二进制内容转换成字符串后写入此参数。 |

**返回示例**

```json
{
  "errorCode": 0,
  "errorMsg": "Success"
}
```

**返回参数**

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| errorCode | Int32 | （必需）错误码，0 代表成功。 |
| errorMsg | String | （必需）错误内容 |

---

## 2.6.7 batchSendFile 批量发送文件至机台

此接口为 2.6.6 sendFile 发送文件至机台的批量版本，通过在请求体中补充目标位置，可以将同一文件以不同的文件名，同时发送至不同机台的不同位置。

不支持覆盖同名文件。请先删除同名文件，再发送。

```
POST  /api/cnc/batchSendFile
```

**请求体示例 application/json**

当文件为文本格式时：

```json
{
  "content": "string",
  "encoding": "us-ascii",
  "targets": [
    { "machineID": "1010", "fileName": "08000" },
    { "machineID": "1011", "fileName": "sample.NC", "DirAtCNC": "dir1" },
    { "machineID": "1012", "fileName": "sample.NC", "SubDir": "Dir/Prog" }
  ]
}
```

当文件为二进制格式时：

```json
{
  "base64": "string",
  "targets": [
    { "machineID": "1011", "fileName": "sample.NC", "SubDir": "Dir/Prog" }
  ]
}
```

请求参数与 2.6.6 sendFile 发送文件至机台中的一致。

**请求参数**

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| targets | Array | （必需）发送文件至机台的目标路径 |
| machineID | String | （必需）目标机台标识，详见 1.1.1 machineID 机台标识 |
| fileName | String | 目标文件在机台上的文件名，部分系统型号，如 Gsk 广数，Siemens 西门子等，文件名必须包括文件扩展名。对于 FANUC 系统，fileName 无效，程序名为 Content 中第一个 \n 与第二个 \n 之间的内容。 |
| dirAtCNC | String | 指定目标目录路径。如未补充该参数，则默认为默认根目录路径。各机台系统型号默认根目录路径见表格 55。 |
| subDir | String | 指定目标子目录路径。如未输入 dirAtCNC，自动将根目录路径与子目录路径拼接为 dirAtCNC。如 dirAtCNC 与 subDir 同时输入，subDir 被忽略。 |
| content | String | 文件内容。当文件为文本格式时，应使用此参数。当 content 被定义时，base64 参数将被忽略。 |
| encoding | String | 原文件的编码。如果不注明，默认使用机台配置中设定编码。 |
| base64 | String | 当文件为二进制格式时，应使用此参数。请使用 Base64 编码将二进制内容转换成字符串后写入此参数。 |

**返回示例**

```json
[
  {
    "errorCode": 0,
    "errorMsg": "Success"
  },
  {
    "errorCode": 10003,
    "errorMsg": "Machine ID does not exist."
  },
  {
    "errorCode": 142,
    "errorMsg": "Path exists."
  }
]
```

返回体中依次为请求体中的请求的执行结果。

**返回参数**

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| errorCode | Int32 | （必需）错误码，0 代表成功。 |
| errorMsg | String | （必需）错误内容 |

---

## 2.6.8 deleteFile 删除机台文件

此接口用于删除机台上的指定文件。

```
GET  /api/cnc/deleteFile?machineID=MACHINEID&fileName=FILENAME&dirAtCNC=DIRATCNC&subDir=SUBDIR
```

**请求参数**

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| machineID | String | （必需）目标机台标识，详见 1.1.1 machineID 机台标识 |
| fileName | String | （必需）目标文件的文件名，参考 2.6.1 readProgramList 或 2.6.15 readAllPrograms 接口返回的文件名。部分系统型号，如 Gsk 广数，Siemens 西门子等，文件名必须包括文件扩展名。 |
| dirAtCNC | String | 指定目标目录路径。如未补充该参数，则默认为默认根目录路径。各机台系统型号默认根目录路径见表格 55。 |
| subDir | String | 指定目标子目录路径。如未输入 dirAtCNC，自动将根目录路径与子目录路径拼接为 dirAtCNC。如 dirAtCNC 与 subDir 同时输入，subDir 被忽略。 |

**返回示例**

```json
{
  "errorCode": 0,
  "errorMsg": "Success"
}
```

**返回参数**

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| errorCode | Int32 | （必需）错误码，0 代表成功。 |
| errorMsg | String | （必需）错误内容 |

---

## 2.6.9 batchDeleteFile 批量删除机台文件

此接口为 2.6.8 deleteFile 删除机台文件的批量版本，通过在请求体中补充目标位置，可以一次删除不同机台的不同文件。

```
POST  /api/cnc/batchDeleteFile
```

**请求体示例 application/json**

```json
[
  { "machineID": "1010", "fileName": "08000" },
  { "machineID": "1011", "fileName": "sample.NC", "DirAtCNC": "dir1" },
  { "machineID": "1012", "fileName": "sample.NC", "SubDir": "Dir/Prog" }
]
```

请求参数与 2.6.8 deleteFile 删除机台文件中的一致。

**请求参数**

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| machineID | String | （必需）目标机台标识，详见 1.1.1 machineID 机台标识 |
| fileName | String | （必需）目标文件的文件名，参考 2.6.1 readProgramList 或 2.6.15 readAllPrograms 接口返回的文件名。部分系统型号，如 Gsk 广数，Siemens 西门子等，文件名必须包括文件扩展名。 |
| dirAtCNC | String | 指定目标目录路径。如未补充该参数，则默认为默认根目录路径。各机台系统型号默认根目录路径见表格 55。 |
| subDir | String | 指定目标子目录路径。如未输入 dirAtCNC，自动将根目录路径与子目录路径拼接为 dirAtCNC。如 dirAtCNC 与 subDir 同时输入，subDir 被忽略。 |

**返回示例**

```json
[
  {
    "errorCode": 0,
    "errorMsg": "Success"
  },
  {
    "errorCode": 10003,
    "errorMsg": "Machine ID does not exist."
  },
  {
    "errorCode": 158,
    "errorMsg": "Path is not found."
  }
]
```

返回体中依次为请求体中的请求的执行结果。

**返回参数**

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| errorCode | Int32 | （必需）错误码，0 代表成功。 |
| errorMsg | String | （必需）错误内容 |

---

## 2.6.10 lockFileByRange 锁定/解锁机台程序编辑

当前仅支持 Mitsubishi 三菱、Fanuc 发那科系统程序号在 8000\~8999、9000\~9999，以及 8000\~9999 三个区间内的编辑锁定/解锁。部分系统在锁定编辑后不可修改，但仍可从机床端删除。

```
GET  /api/cnc/lockFileByRange?machineID=MACHINEID&isLock=ISLOCK&lockStart=LOCKSTART&lockEnd=LOCKEND
```

**请求参数**

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| machineID | String | （必需）目标机台标识，详见 1.1.1 machineID 机台标识 |
| isLock | Bool | （必需）目标锁定状态 isLock：true 为锁定，false 为解锁。 |
| lockStart | Int32 | （必需）锁定/解锁区间开始程序号 |
| lockEnd | Int32 | （必需）锁定/解锁区间结束程序号 |

**返回示例**

```json
{
  "errorCode": 0,
  "errorMsg": "Success"
}
```

**返回参数**

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| errorCode | Int32 | （必需）错误码，0 代表成功。 |
| errorMsg | String | （必需）错误内容 |

---

## 2.6.11 createDir 创建机台目录

```
GET  /api/cnc/createDir?machineID=MACHINEID&dirName=DIRNAME&dirAtCNC=DIRATCNC&subDir=SUBDIR
```

**请求参数**

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| machineID | String | （必需）目标机台标识，详见 1.1.1 machineID 机台标识 |
| dirName | String | （必需）要创建的目录名 |
| dirAtCNC | String | 指定目标目录路径。如未补充该参数，则默认为默认根目录路径。各机台系统型号默认根目录路径见表格 55。 |
| subDir | String | 指定目标子目录路径。如未输入 dirAtCNC，自动将根目录路径与子目录路径拼接为 dirAtCNC。如 dirAtCNC 与 subDir 同时输入，subDir 被忽略。 |

**返回示例**

```json
{
  "errorCode": 0,
  "errorMsg": "Success"
}
```

**返回参数**

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| errorCode | Int32 | （必需）错误码，0 代表成功。 |
| errorMsg | String | （必需）错误内容 |

当前支持创建机台目录的系统型号参考下表。

**表格 57 系统型号对创建/删除机台目录接口的支持**

| 文件服务器类型 | 系统（型号） | 创建/删除机台目录 |
|--------------|------------|----------------|
| 机台存储器 | Brother 兄弟 [S 系列] | O |
| 机台存储器 | Delta 台达 [通用型] | O |
| 机台存储器 | Fanuc 发那科 [0i-D, 0i-F, 30i, 31i, 32i, 35i, Power Motion i-A] | O |
| 机台存储器 | GSK [所有型号] | X |
| 机台存储器 | Haas 哈斯 [通用型, MT-CONNECT] | O |
| 机台存储器 | Heidenhain 海德汉 [所有型号] | O |
| 机台存储器 | Mitsubishi 三菱 [M70/M700 L, M70/M700 M, M80/M800 L, M80/M800 M] | ★仅限 CF 卡、SD 卡（路径：IC1） |
| 机台存储器 | Mock 模拟机台 | O |
| 机台存储器 | Okuma 大隈 [所有型号] | O |
| 机台存储器 | Rexroth 力士乐 [OPC UA] | O |
| 机台存储器 | Siemens 西门子 [所有型号] | O |
| 机台存储器 | 其它支持程序传输功能的系统型号 | X |
| FTP 服务器 | | O |
| 共享文件夹 | | O |
| 共享文件夹 (Win XP) | | O |
| 无线传输盒 | | O |
| 网关文件服务器 | | O |

O: 支持；X: 不支持

---

## 2.6.12 deleteDir 删除机台目录

目前只能删除空的目录。用户需要先删除目录下所有文件与子目录。

```
GET  /api/cnc/deleteDir?machineID=MACHINEID&dirName=DIRNAME&dirAtCNC=DIRATCNC&subDir=SUBDIR
```

**请求参数**

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| machineID | String | （必需）目标机台标识，详见 1.1.1 machineID 机台标识 |
| dirName | String | （必需）要删除的目录名 |
| dirAtCNC | String | 指定目标目录路径。如未补充该参数，则默认为默认根目录路径。各机台系统型号默认根目录路径见表格 55。 |
| subDir | String | 指定目标子目录路径。如未输入 dirAtCNC，自动将根目录路径与子目录路径拼接为 dirAtCNC。如 dirAtCNC 与 subDir 同时输入，subDir 被忽略。 |

**返回示例**

```json
{
  "errorCode": 0,
  "errorMsg": "Success"
}
```

**返回参数**

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| errorCode | Int32 | （必需）错误码，0 代表成功。 |
| errorMsg | String | （必需）错误内容 |

当前支持删除机台目录的系统型号参考表格 57 系统型号对创建/删除机台目录接口的支持。

---

## 2.6.13 backupFiles 备份机台文件

此接口将请求体中指定的文件，或者目录下的所有文件（包括子文件夹与子文件夹下的文件），打包成一个 ZIP 文件，以 Stream 方式返回。ZIP 文件的第一层目录名格式为 "BackupFiles\_备份日期时间"，第二层目录为各机台根目录，目录名格式为 "machineID\_machineName"，机台根目录下是各机台对应的指定文件与目录，保留原本的文件夹结构。

```
POST  /api/cnc/backupFiles
```

**请求体示例 application/json**

```json
[
  { "machineID": "1010", "fileName": "08000" },
  { "machineID": "1011", "DirAtCNC": "dir1", "includeSubDir": false },
  { "machineID": "1012", "fileName": "sample.NC", "SubDir": "Dir/Prog" }
]
```

**请求参数**

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| machineID | String | （必需）目标机台标识，详见 1.1.1 machineID 机台标识 |
| fileName | String | （必需）目标文件的文件名，参考 2.6.1 readProgramList 或 2.6.15 readAllPrograms 接口返回的文件名。部分系统型号，如 Gsk 广数，Siemens 西门子等，文件名必须包括文件扩展名。如果未输入 fileName，将备份 dirAtCNC 或 subDir 指定的目录下所有的文件。 |
| dirAtCNC | String | 指定目标目录路径。如未补充该参数，则默认为默认根目录路径。各机台系统型号默认根目录路径见表格 55。 |
| subDir | String | 指定目标子目录路径。如未输入 dirAtCNC，自动将根目录路径与子目录路径拼接为 dirAtCNC。如 dirAtCNC 与 subDir 同时输入，subDir 被忽略。 |
| includeSubDir | Bool | 未输入 fileName，即下载指定目录下所有文件时，如果此输入量为 true，则下载目录中所有子文件夹下的所有文件。默认为 true。 |

**返回示例** `application/octet-stream`

```
PK gx BackupFiles_2024.03.07.12.04.46…
```

返回体中为 Stream 方式传回的 ZIP 文件。

如果请求体中任意请求执行时报错，则会终止任务，并返回该条请求的报错信息，如：

```json
{
  "errorCode": 10003,
  "errorMsg": "Machine ID does not exist.",
  "statusMsg": "Invalid MachineID (1011)"
}
```

---

## 2.6.14 selectProgram 选择程序

此接口在机床上选择指定的程序为主程序。

```
GET  /api/cnc/selectProgram?machineID=MACHINEID&fileName=FILENAME&dirAtCNC=DIRATCNC&subDir=SUBDIR
```

**请求参数**

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| machineID | String | （必需）目标机台标识，详见 1.1.1 machineID 机台标识 |
| fileName | String | （必需）目标文件的文件名，参考 2.6.1 readProgramList 或 2.6.15 readAllPrograms 接口返回的文件名。部分系统型号，如 Gsk 广数，Siemens 西门子等，文件名必须包括文件扩展名。 |
| dirAtCNC | String | 指定目标目录路径。如未补充该参数，则默认为默认根目录路径。各机台系统型号默认根目录路径见表格 55。 |
| subDir | String | 指定目标子目录路径。如未输入 dirAtCNC，自动将根目录路径与子目录路径拼接为 dirAtCNC。如 dirAtCNC 与 subDir 同时输入，subDir 被忽略。 |

**返回示例**

```json
{
  "errorCode": 0,
  "errorMsg": "Success"
}
```

**返回参数**

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| errorCode | Int32 | （必需）错误码，0 代表成功。 |
| errorMsg | String | （必需）错误内容 |

目前接口支持的设备：

| 系统（型号） | 备注 |
|------------|------|
| Brother 兄弟 [所有型号] | 必须在自动运行模式或运行中编辑模式下；必须未运行程序。 |
| Fanuc 发那科 [0i-D, 0i-F, 30i, 31i, 32i, 35i, Power Motion i-A] | 必须在 Auto 或 Edit 模式下。 |
| Mock 模拟机台 | 总是返回 SUCCESS，但不会改变当前程序。 |

---

## 2.6.15 readAllPrograms 浏览所有文件

此接口搜索机床指定目录下所有程序文件，返回文件名称和其所在目录路径。

```
GET  /api/cnc/readAllPrograms?machineID=MACHINEID&dirAtCNC=DIRATCNC&subDir=SUBDIR
```

**请求参数**

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| machineID | String | （必需）目标机台标识，详见 1.1.1 machineID 机台标识 |
| dirAtCNC | String | 指定目标目录路径。如未补充该参数，则默认为默认根目录路径。各机台系统型号默认根目录路径见表格 55。 |
| subDir | String | 指定目标子目录路径。如未输入 dirAtCNC，自动将根目录路径与子目录路径拼接为 dirAtCNC。如 dirAtCNC 与 subDir 同时输入，subDir 被忽略。 |

**返回示例**

```json
{
  "programs": [
    {
      "dirAtCNC": "/",
      "fileName": "SAMPLE"
    },
    {
      "dirAtCNC": "1",
      "fileName": "sample1.nc"
    },
    {
      "dirAtCNC": "1/1",
      "fileName": "sample2.nc"
    }
  ]
}
```

**返回参数**

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| programs | Object[] | （必需）程序文件对象数组。 |
| fileName | String | 程序文件名。部分系统型号，如 Gsk 广数，Siemens 西门子等，文件名包括文件扩展名。 |
| dirAtCNC | String | 程序文件所在目录路径。 |

---

## 2.6.16 searchFile 搜索机台文件

此接口在指定机台目录下（包括子目录）搜索指定文件名，返回文件所在目录的路径、目录下所有文件（包括搜索目标文件）与子目录。

```
GET  /api/cnc/searchFile?machineID=MACHINEID&fileName=FILENAME&dirAtCNC=DIRATCNC&subDir=SUBDIR
```

**请求参数**

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| machineID | String | （必需）目标机台标识，详见 1.1.1 machineID 机台标识 |
| fileName | String | （必需）目标文件名，参考 2.6.1 readProgramList 或 2.6.15 readAllPrograms 接口返回的文件名。部分系统型号，如 Gsk 广数，Siemens 西门子等，文件名必须包括文件扩展名。 |
| dirAtCNC | String | 指定目标目录路径。如未补充该参数，则默认为默认根目录路径。各机台系统型号默认根目录路径见表格 55。 |
| subDir | String | 指定目标子目录路径。如未输入 dirAtCNC，自动将根目录路径与子目录路径拼接为 dirAtCNC。如 dirAtCNC 与 subDir 同时输入，subDir 被忽略。 |

**返回示例**

```json
{
  "dirAtCNC": "Dir/Prog",
  "programs": [
    "1111",
    "2322",
    "3222"
  ],
  "subDirs": [
    "dir1",
    "dir2"
  ]
}
```

**返回参数**

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| dirAtCNC | String | 目标文件所在目录路径。 |
| programs | String[] | 目标文件所在目录的程序（文件）列表 |
| subDirs | String[] | 目标文件所在目录的子文件夹列表 |

---

## 2.7 数据分析接口

数据分析接口用于获取目标机台或机组在指定时间范围内的数据分析。

使用数据分析接口前，必须开启网关本地缓存开关（详见《说明书》5.2.1. 设置-高级选项），以允许在网关本地保存机台状态历史数据。

使用数据分析接口需要补充开始时间戳、结束时间戳。两者间最大长度为 31 天。本地保存最大时限为 365 天。因此开始时间不可早于当前时间的 365 天前。

如当前时间戳小于输入的结束时间戳，则自动以当前时间戳为结束时间戳。

如网关有一段时间没有接收到机台或机组数据（数据缺失），会导致数据分析接口返回的数据与实际有出入。造成数据缺失的常见原因有：网关未开启本地缓存，未开启对应的自动采集任务，网关断电，网关网络中断，以及机台离线等。

---

## 2.7.1 机台数据分析

机台数据分析用于获取目标机台在指定时间范围内的数据分析，基地址 `/api/analysis`。

### 2.7.1.1 oee 机台 OEE 数据分析

获取指定时间范围内，每个分组间隔的机台 OEE 统计数据。

```
GET  /api/analysis/oee?machineID=MACHINEID&startUnix=STARTUNIX&endUnix=ENDUNIX&interval=INTERVAL
```

**请求参数**

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| machineID | String | （必需）目标机台标识，详见 1.1.1 machineID 机台标识 |
| startUnix | Int64 | （必需）开始时间戳[秒] |
| endUnix | Int64 | （必需）结束时间戳[秒] |
| interval | Int32 | 分组间隔[秒]，如未定义，则只有一个分组间隔。 |

**返回示例**

```json
[
  {
    "machineName": "模拟机台 1",
    "startTime": "2022-04-28T14:30:00Z",
    "endTime": "2022-04-28T15:30:00Z",
    "availability": 83.33333,
    "offTime": 100,
    "waitTime": 200,
    "emergencyTime": 300,
    "autoRunTime": 3000,
    "manualTime": 0.0
  },
  {
    "machineName": "模拟机台 1",
    "startTime": "2022-04-28T15:30:00Z",
    "endTime": "2022-04-28T16:30:00Z",
    "availability": 0.0,
    "offTime": 0,
    "waitTime": 3600,
    "emergencyTime": 0,
    "autoRunTime": 0,
    "manualTime": 0
  }
]
```

**返回参数**

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| machineName | String | （必需）机台名，在"机台配置"页"添加/编辑设备"窗口设置。 |
| startTime | String | （必需）分组间隔开始时间（UTC） |
| endTime | String | （必需）分组间隔结束时间（UTC） |
| availability | Float | （必需）开动率[%] |
| offTime | Int64 | （必需）关机或离线时间[秒] |
| waitTime | Int64 | （必需）待机时间[秒] |
| emergencyTime | Int64 | （必需）紧急停止时间[秒] |
| autoRunTime | Int64 | （必需）自动运行时间[秒] |
| manualTime | Int64 | （必需）调机时间[秒] |

> 注：机台 OEE 数据说明详见《说明书》6.1.1. 机台 OEE 数据。如开始时间和结束时间之间有一段时间缺失状态数据，则该段数据缺失时间的状态默认为关机或离线。

---

### 2.7.1.2 alarm 机台警报数据分析

获取指定时间范围内的机台警报历史。

```
GET  /api/analysis/alarm?machineID=MACHINEID&startUnix=STARTUNIX&endUnix=ENDUNIX
```

**请求参数**

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| machineID | String | （必需）目标机台标识，详见 1.1.1 machineID 机台标识 |
| startUnix | Int64 | （必需）开始时间戳[秒] |
| endUnix | Int64 | （必需）结束时间戳[秒] |

**返回示例**

```json
[
  {
    "machineName": "模拟机台 1",
    "startTime": "2023-06-16T16:00:00Z",
    "endTime": "2023-06-16T16:00:10Z",
    "alarmMsg": "00:00 ALARM 1",
    "alarmLevel": "WRN"
  },
  {
    "machineName": "模拟机台 1",
    "startTime": "2023-06-16T16:00:00Z",
    "endTime": "2023-06-16T16:00:10.001Z",
    "alarmMsg": "00:00 ALARM 2",
    "alarmLevel": "WRN"
  },
  {
    "machineName": "模拟机台 1",
    "startTime": "2023-06-16T16:01:00.008Z",
    "endTime": "2023-06-16T16:01:50.019Z",
    "alarmMsg": "00:01 ALARM 1",
    "alarmLevel": "WRN"
  }
]
```

**返回参数**

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| machineName | String | （必需）机台名，在"机台配置"页"添加/编辑设备"窗口设置。 |
| startTime | String | （必需）警报开始时间（UTC） |
| endTime | String | （必需）警报结束时间（UTC） |
| alarmMsg | String | （必需）警报内容 |
| alarmLevel | String | （必需）警报级别。按优先级由高到低分为错误（ERR），警告（WRN），消息（INF）三个级别。用户可以参照《说明书》5.5.7. 警报监控设置，以关键字设置警报级别，及过滤低于最低报警级别的警报；未设置级别的警报均默认为警告级别。 |

> 注：从警报出现到警报解除作为一次警报，记录其开始时间、结束时间、警报内容和警报级别。如在开始时间戳之前，警报已经出现，且未解除，则此次警报的开始时间为开始时间戳对应的时间。如果在结束时间戳对应的时间，警报尚未解除，则此次警报的结束时间为结束时间戳对应的时间。如开始时间和结束时间之间缺警报数据，则默认认该段缺失数据时间内没有出现警报。

---

### 2.7.1.3 count 机台计数数据分析

获取指定时间范围内，每个分组间隔的机台累计加工计数。

```
GET  /api/analysis/count?machineID=MACHINEID&startUnix=STARTUNIX&endUnix=ENDUNIX&interval=INTERVAL
```

**请求参数**

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| machineID | String | （必需）目标机台标识，详见 1.1.1 machineID 机台标识 |
| startUnix | Int64 | （必需）开始时间戳[秒] |
| endUnix | Int64 | （必需）结束时间戳[秒] |
| interval | Int32 | 分组间隔[秒]，如未定义，则只有一个分组间隔。 |

**返回示例**

```json
[
  {
    "machineName": "模拟机台 1",
    "startTime": "2022-04-28T14:30:00Z",
    "endTime": "2022-04-28T15:30:00Z",
    "count": 96
  },
  {
    "machineName": "模拟机台 1",
    "startTime": "2022-04-28T15:30:00Z",
    "endTime": "2022-04-28T16:30:00Z",
    "count": 0
  }
]
```

**返回参数**

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| machineName | String | （必需）机台名，在"机台配置"页"添加/编辑设备"窗口设置。 |
| startTime | String | （必需）分组间隔开始时间（UTC） |
| endTime | String | （必需）分组间隔结束时间（UTC） |
| count | Int32 | （必需）累计加工计数，分组间隔首末机台累计加工计数 cumulativeCount 之差 |

---

### 2.7.1.4 overall 机台综合数据分析

获取指定时间范围内，每个分组间隔的综合数据，包括 2.7.1.1 oee 机台 OEE 数据分析、2.7.1.3 count 机台计数数据分析的数据。

```
GET  /api/analysis/overall?machineID=MACHINEID&startUnix=STARTUNIX&endUnix=ENDUNIX&interval=INTERVAL
```

**请求参数**

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| machineID | String | （必需）目标机台标识，详见 1.1.1 machineID 机台标识 |
| startUnix | Int64 | （必需）开始时间戳[秒] |
| endUnix | Int64 | （必需）结束时间戳[秒] |
| interval | Int32 | 分组间隔[秒]，如未定义，则只有一个分组间隔。 |

**返回示例**

```json
[
  {
    "machineName": "模拟机台 1",
    "startTime": "2022-04-28T14:30:00Z",
    "endTime": "2022-04-28T15:30:00Z",
    "count": 96,
    "availability": 83.33333,
    "offTime": 100,
    "waitTime": 200,
    "emergencyTime": 300,
    "autoRunTime": 3000,
    "manualTime": 0.0
  },
  {
    "machineName": "模拟机台 1",
    "startTime": "2022-04-28T15:30:00Z",
    "endTime": "2022-04-28T16:30:00Z",
    "count": 0,
    "availability": 0.0,
    "offTime": 0,
    "waitTime": 3600,
    "emergencyTime": 0,
    "autoRunTime": 0,
    "manualTime": 0
  }
]
```

**返回参数**

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| machineName | String | （必需）机台名 |
| startTime | String | （必需）分组间隔开始时间（UTC） |
| endTime | String | （必需）分组间隔结束时间（UTC） |
| count | Int32 | （必需）累计加工计数 |
| availability | Float | （必需）开动率[%] |
| offTime | Int64 | （必需）关机或离线时间[秒] |
| waitTime | Int64 | （必需）待机时间[秒] |
| emergencyTime | Int64 | （必需）紧急停止时间[秒] |
| autoRunTime | Int64 | （必需）自动运行时间[秒] |
| manualTime | Int64 | （必需）调机时间[秒] |

---

### 2.7.1.5 cycle 机台节拍数据分析

获取指定时间范围内，机台的节拍数据。

```
GET  /api/analysis/cycle?machineID=MACHINEID&startUnix=STARTUNIX&endUnix=ENDUNIX
```

**请求参数**

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| machineID | String | （必需）目标机台标识，详见 1.1.1 machineID 机台标识 |
| startUnix | Int64 | （必需）开始时间戳[秒] |
| endUnix | Int64 | （必需）结束时间戳[秒] |

**返回示例**

```json
[
  {
    "machineName": "模拟机台 1",
    "startTime": "2025-05-23T06:35:44.046Z",
    "endTime": "2025-05-23T06:36:25.046Z",
    "lastCycleTime": 41,
    "mainPrgmName": "06495",
    "machineID": "1"
  },
  {
    "machineName": "模拟机台 1",
    "startTime": "2025-05-23T06:36:25.072Z",
    "endTime": "2025-05-23T06:36:56.072Z",
    "lastCycleTime": 31,
    "mainPrgmName": "06495",
    "machineID": "1"
  }
]
```

**返回参数**

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| machineName | String | （必需）机台名，在"机台配置"页"添加/编辑设备"窗口设置。 |
| startTime | String | （必需）节拍开始时间（UTC） |
| endTime | String | （必需）节拍结束时间（UTC） |
| lastCycleTime | Int32 | （必需）节拍时长[秒]，仅计算自动运行时间。 |
| mainPrgmName | String | （必需）节拍执行的主程序名 |
| machineID | String | 机台 machineID |

---

## 2.7.2 机组数据分析

机组数据分析用于获取目标机台或机组在指定时间范围内的数据分析，基地址 `/api/group-analysis`，需要补充变量机组标识 `groupID`，代替机台标识 `machineID`。

### 2.7.2.1 oee 机组 OEE 数据分析

获取指定时间范围内，每个分组间隔的，机组内所有机台的机台 OEE 数据。

```
GET  /api/group-analysis/oee?groupID=GROUPID&startUnix=STARTUNIX&endUnix=ENDUNIX&interval=INTERVAL
```

**请求参数**

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| groupID | String | （必需）目标机组标识，详见 1.1.2 groupID 机组标识 |
| startUnix | Int64 | （必需）开始时间戳[秒] |
| endUnix | Int64 | （必需）结束时间戳[秒] |
| interval | Int32 | 分组间隔[秒]，如未定义，则只有一个分组间隔。 |

**返回示例**

```json
[
  {
    "machineID": "1010",
    "machineName": "模拟机台 1",
    "startTime": "2022-04-28T14:30:00Z",
    "endTime": "2022-04-28T15:30:00Z",
    "availability": 83.33333,
    "offTime": 100,
    "waitTime": 200,
    "emergencyTime": 300,
    "autoRunTime": 3000,
    "manualTime": 0.0
  },
  {
    "machineID": "1010",
    "machineName": "模拟机台 1",
    "startTime": "2022-04-28T15:30:00Z",
    "endTime": "2022-04-28T16:30:00Z",
    "availability": 0.0,
    "offTime": 0,
    "waitTime": 3600,
    "emergencyTime": 0,
    "autoRunTime": 0,
    "manualTime": 0
  },
  {
    "machineID": "1011",
    "machineName": "模拟机台 2",
    "startTime": "2022-04-28T14:30:00Z",
    "endTime": "2022-04-28T15:30:00Z",
    "availability": 80.55556,
    "offTime": 150,
    "waitTime": 250,
    "emergencyTime": 300,
    "autoRunTime": 2900,
    "manualTime": 0.0
  }
]
```

**返回参数**

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| machineID | String | （必需）机台 machineID，详见 1.1.1 machineID 机台标识 |
| machineName | String | （必需）机台名，在"机台配置"页"添加/编辑设备"窗口设置。 |
| startTime | String | （必需）分组间隔开始时间 |
| endTime | String | （必需）分组间隔结束时间 |
| availability | Float | （必需）开动率[%] |
| offTime | Int64 | （必需）关机或离线时间[秒] |
| waitTime | Int64 | （必需）待机时间[秒] |
| emergencyTime | Int64 | （必需）紧急停止时间[秒] |
| autoRunTime | Int64 | （必需）自动运行时间[秒] |
| manualTime | Int64 | （必需）调机时间[秒] |

---

### 2.7.2.2 alarm 机组警报数据分析

获取指定时间范围内的机组内所有机台的警报历史。

```
GET  /api/group-analysis/alarm?groupID=GROUPID&startUnix=STARTUNIX&endUnix=ENDUNIX
```

**请求参数**

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| groupID | String | （必需）目标机组标识，详见 1.1.2 groupID 机组标识 |
| startUnix | Int64 | （必需）开始时间戳[秒] |
| endUnix | Int64 | （必需）结束时间戳[秒] |

**返回示例**

```json
[
  {
    "machineID": "1010",
    "machineName": "模拟机台 1",
    "startTime": "2023-06-16T16:00:00Z",
    "endTime": "2023-06-16T16:00:10Z",
    "alarmMsg": "00:00 ALARM 1",
    "alarmLevel": "WRN"
  },
  {
    "machineID": "1010",
    "machineName": "模拟机台 1",
    "startTime": "2023-06-17T15:59:48.105Z",
    "endTime": "2023-06-17T16:00:00Z",
    "alarmMsg": "23:59 ALARM 2",
    "alarmLevel": "WRN"
  },
  {
    "machineID": "1011",
    "machineName": "模拟机台 2",
    "startTime": "2023-06-16T16:00:00.399Z",
    "endTime": "2023-06-16T16:00:30.395Z",
    "alarmMsg": "00:00 ALARM 1",
    "alarmLevel": "WRN"
  }
]
```

**返回参数**

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| machineID | String | （必需）目标机台标识，详见 1.1.1 machineID 机台标识 |
| machineName | String | 机台名，在"机台配置"页"添加/编辑设备"窗口设置。 |
| startTime | String | （必需）警报开始时间（UTC） |
| endTime | String | （必需）警报结束时间（UTC） |
| alarmMsg | String | （必需）警报内容 |
| alarmLevel | String | （必需）警报级别。如无警报，返回空 Array。按优先级由高到低分为错误（ERR），警告（WRN），消息（INF）三个级别。未设置级别的警报均默认为警告级别。 |

---

### 2.7.2.3 count 机组计数数据分析

获取指定时间范围内，每个分组间隔的，机组内所有机台的机台计数数据。

```
GET  /api/group-analysis/count?groupID=GROUPID&startUnix=STARTUNIX&endUnix=ENDUNIX&interval=INTERVAL
```

**请求参数**

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| groupID | String | （必需）目标机组标识，详见 1.1.2 groupID 机组标识 |
| startUnix | Int64 | （必需）开始时间戳[秒] |
| endUnix | Int64 | （必需）结束时间戳[秒] |
| interval | Int32 | 分组间隔[秒]，如未定义，则只有一个分组间隔。 |

**返回示例**

```json
[
  {
    "machineID": "1010",
    "machineName": "模拟机台 1",
    "startTime": "2022-04-28T14:30:00Z",
    "endTime": "2022-04-28T15:30:00Z",
    "count": 96
  },
  {
    "machineID": "1010",
    "machineName": "模拟机台 1",
    "startTime": "2022-04-28T15:30:00Z",
    "endTime": "2022-04-28T16:30:00Z",
    "count": 0
  },
  {
    "machineID": "1011",
    "machineName": "模拟机台 2",
    "startTime": "2022-04-28T14:30:00Z",
    "endTime": "2022-04-28T15:30:00Z",
    "count": 52
  }
]
```

**返回参数**

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| machineID | String | （必需）机台 machineID，详见 1.1.1 machineID 机台标识 |
| machineName | String | （必需）机台名，在"机台配置"页"添加/编辑设备"窗口设置。 |
| startTime | String | （必需）分组间隔开始时间 |
| endTime | String | （必需）分组间隔结束时间 |
| count | Int32 | （必需）累计加工计数，为指定时间范围首末的机台累计加工计数 cumulativeCount 之差 |

---

### 2.7.2.4 overall 机组综合数据分析

获取指定时间范围内，每个分组间隔的，机组内所有机台的机台综合数据。

```
GET  /api/group-analysis/overall?groupID=GROUPID&startUnix=STARTUNIX&endUnix=ENDUNIX&interval=INTERVAL
```

**请求参数**

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| groupID | String | （必需）目标机组标识，详见 1.1.2 groupID 机组标识 |
| startUnix | Int64 | （必需）开始时间戳[秒] |
| endUnix | Int64 | （必需）结束时间戳[秒] |
| interval | Int32 | 分组间隔[秒]，如未定义，则只有一个分组间隔。 |

**返回示例**

```json
[
  {
    "machineID": "1010",
    "machineName": "模拟机台 1",
    "startTime": "2022-04-28T14:30:00Z",
    "endTime": "2022-04-28T15:30:00Z",
    "count": 96,
    "availability": 83.33333,
    "offTime": 100,
    "waitTime": 200,
    "emergencyTime": 300,
    "autoRunTime": 3000,
    "manualTime": 0.0
  },
  {
    "machineID": "1011",
    "machineName": "模拟机台 2",
    "startTime": "2022-04-28T14:30:00Z",
    "endTime": "2022-04-28T15:30:00Z",
    "count": 52,
    "availability": 80.55556,
    "offTime": 150,
    "waitTime": 250,
    "emergencyTime": 300,
    "autoRunTime": 2900,
    "manualTime": 0.0
  }
]
```

**返回参数**

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| machineID | String | （必需）机台 machineID，详见 1.1.1 machineID 机台标识 |
| machineName | String | （必需）机台名，在"机台配置"页"添加/编辑设备"窗口设置。 |
| startTime | String | （必需）分组间隔开始时间 |
| endTime | String | （必需）分组间隔结束时间 |
| count | Int32 | （必需）累计加工计数，为指定时间范围首末的机台累计加工计数 cumulativeCount 之差 |
| availability | Float | （必需）开动率[%] |
| offTime | Int64 | （必需）关机或离线时间[秒] |
| waitTime | Int64 | （必需）待机时间[秒] |
| emergencyTime | Int64 | （必需）紧急停止时间[秒] |
| autoRunTime | Int64 | （必需）自动运行时间[秒] |
| manualTime | Int64 | （必需）调机时间[秒] |

---

### 2.7.2.5 cycle 机组节拍数据分析

获取指定时间范围内，每个分组间隔的，机组内所有机台的机台综合数据。

```
GET  /api/group-analysis/cycle?groupID=GROUPID&startUnix=STARTUNIX&endUnix=ENDUNIX
```

**请求参数**

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| groupID | String | （必需）目标机组标识，详见 1.1.2 groupID 机组标识 |
| startUnix | Int64 | （必需）开始时间戳[秒] |
| endUnix | Int64 | （必需）结束时间戳[秒] |

**返回示例**

```json
[
  {
    "machineName": "模拟机台 1",
    "startTime": "2025-05-23T06:35:44.046Z",
    "endTime": "2025-05-23T06:36:25.046Z",
    "lastCycleTime": 41,
    "mainPrgmName": "06495",
    "machineID": "1"
  },
  {
    "machineName": "模拟机台 1",
    "startTime": "2025-05-23T06:36:25.072Z",
    "endTime": "2025-05-23T06:36:56.072Z",
    "lastCycleTime": 31,
    "mainPrgmName": "06495",
    "machineID": "1"
  },
  {
    "machineName": "模拟机台 2",
    "startTime": "2025-05-23T07:51:50.777Z",
    "endTime": "2025-05-23T07:52:10.777Z",
    "lastCycleTime": 20,
    "mainPrgmName": "02228",
    "machineID": "2"
  }
]
```

**返回参数**

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| machineID | String | （必需）机台 machineID，详见 1.1.1 machineID 机台标识 |
| machineName | String | （必需）机台名，在"机台配置"页"添加/编辑设备"窗口设置。 |
| startTime | String | （必需）节拍开始时间（UTC） |
| endTime | String | （必需）节拍结束时间（UTC） |
| lastCycleTime | Int32 | （必需）节拍时长[秒]，仅计算自动运行时间。 |
| mainPrgmName | String | （必需）节拍执行的主程序名 |

---

## 2.8 历史数据接口

历史数据接口用于获取目标机台或机组在指定时间范围内的历史数据，基地址 `/api/db`。

使用历史数据分析接口前，必须开启网关本地缓存开关（详见《说明书》5.2.1. 设置-高级选项），以允许在网关本地保存历史数据。

使用历史数据分析接口需要补充开始时间戳、结束时间戳。两者间最大长度为 31 天。本地保存最大时限为 365 天。因此开始时间不可早于当前时间的 365 天前。

如当前时间戳小于输入的结束时间戳，则自动以当前时间戳为结束时间戳。

如网关有一段时间没有接收到机台或机组数据（数据缺失），会导致历史数据接口返回的数据与实际不符。造成数据缺失的常见原因有：网关未开启本地缓存，未开启对应的自动采集任务，网关断电，网关网络中断，以及机台离线等。

---

## 2.8.1 machine 机台历史数据

机台历史数据用于获取目标机台在指定时间范围内的历史数据。

```
GET  /api/db/machine?machineID=MACHINEID&type=TYPE&startUnix=STARTUNIX&endUnix=ENDUNIX
```

**请求参数**

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| machineID | String | （必需）目标机台标识，详见 1.1.1 machineID 机台标识 |
| type | String | （必需）数据类型，详见 1.2 数据说明 |
| startUnix | Int64 | （必需）开始时间戳[秒] |
| endUnix | Int64 | （必需）结束时间戳[秒] |

**示例**

获取 machineID 为 1010 的机台在 2024 年 3 月 1 日上午 10:00 – 11:00 的机台状态历史数据，type=CNCStatus，请求如下：

```
/api/db/machine?machineID=1010&type=CNCStatus&startUnix=1709258400&endUnix=1709262000
```

如果请求的目标机台在指定时间范围内不存在历史数据，返回为空：

```json
[]
```

如存在历史数据，以 JSON 格式返回指定数据类型的数据：

```json
[
  {
    "cncStatus": "MANUAL_INC",
    "adjustedStatus": "MANUAL_INC",
    "alarmStatus": "ALARM",
    "alarmLevel": "WRN",
    "offTime": 2329,
    "waitTime": 3212,
    "emergencyTime": 232,
    "autoRunTime": 1336,
    "manualTime": 1232,
    "machineID": "2112",
    "time": "2024-03-01T02:22:11.442Z"
  },
  {
    "cncStatus": "MANUAL_INC",
    "adjustedStatus": "MANUAL_INC",
    "alarmStatus": "ALARM",
    "alarmLevel": "WRN",
    "offTime": 2329,
    "waitTime": 3212,
    "emergencyTime": 232,
    "autoRunTime": 1336,
    "manualTime": 1237,
    "machineID": "2112",
    "time": "2024-03-01T02:22:16.44Z"
  },
  ...
]
```

返回参数中，`machineID` 是机台的 machineID（见 1.1 基本说明），`time` 是数据的获取时间。其它返回参数详见 1.2 数据说明中对应 type 包含的 field 与 tag 内容说明。

---

## 2.8.2 group-machine 机组内所有机台历史数据

用于获取目标机组内所有机台在指定时间范围内的历史数据。

```
GET  /api/db/group-machine?groupID=GROUPID&type=TYPE&startUnix=STARTUNIX&endUnix=ENDUNIX
```

**请求参数**

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| groupID | String | （必需）目标机组标识，详见 1.1.2 groupID 机组标识 |
| type | String | （必需）数据类型，详见 1.2 数据说明 |
| startUnix | Int64 | （必需）开始时间戳[秒] |
| endUnix | Int64 | （必需）结束时间戳[秒] |

**示例**

获取 groupID 为 g1 的机组内所有机台在 2024 年 3 月 1 日上午 10:00 – 11:00 的机台状态历史数据，type=CNCStatus，请求如下：

```
/api/db/group-machine?groupID=g1&type=CNCStatus&startUnix=1709258400&endUnix=1709262000
```

如果请求的目标机台在指定时间范围内不存在历史数据，返回为空 Array：

```json
[]
```

如存在历史数据，以 JSON 格式返回指定数据类型的数据：

```json
[
  {
    "cncStatus": "MANUAL_INC",
    "adjustedStatus": "MANUAL_INC",
    "alarmStatus": "ALARM",
    "alarmLevel": "WRN",
    "offTime": 2329,
    "waitTime": 3212,
    "emergencyTime": 232,
    "autoRunTime": 1336,
    "manualTime": 1232,
    "machineID": "2112",
    "time": "2024-03-01T02:22:11.442Z"
  },
  {
    "cncStatus": "MANUAL_INC",
    "adjustedStatus": "MANUAL_INC",
    "alarmStatus": "ALARM",
    "alarmLevel": "WRN",
    "offTime": 2329,
    "waitTime": 3212,
    "emergencyTime": 232,
    "autoRunTime": 1336,
    "manualTime": 1237,
    "machineID": "2112",
    "time": "2024-03-01T02:22:16.44Z"
  },
  ...
  {
    "cncStatus": "AUTO_RUN",
    "adjustedStatus": "AUTO_RUN",
    "alarmStatus": "NO_ALARM",
    "offTime": 12229,
    "waitTime": 12312,
    "emergencyTime": 2332,
    "autoRunTime": 52332,
    "manualTime": 6132,
    "machineID": "3",
    "time": "2024-03-01T02:19:29.308Z"
  },
  ...
]
```

返回参数中，`machineID` 是机台的 machineID（见 1.1 基本说明），`time` 是数据的获取时间。其它返回参数详见 1.2 数据说明中对应 type 包含的 field 与 tag 内容说明。

---

## 2.8.3 query 查询历史数据

查询符合条件的历史数据。类似数据库的查询命令。

```
POST  /api/db/query?groupID=GROUPID&type=TYPE&startUnix=STARTUNIX&endUnix=ENDUNIX
```

**请求体示例 application/json**

查询"PLC"类，时间戳在 1704892831–1708893358 之间，machineID 为模拟机台 1，且 tag 为 Ttag1 或 Ttag2 的数据，时间最早的 2 条（按 time 升序取前 2 条）：

```json
{
  "type": "PLC",
  "startUnix": 1704892831,
  "endUnix": 1708893358,
  "filters": [
    {
      "key": "machineID",
      "operator": "equal",
      "value": "模拟机台 1"
    },
    {
      "key": "tag",
      "operator": "in",
      "value": [
        "Ttag1",
        "Ttag2"
      ]
    }
  ],
  "orderBy": {
    "field": "time",
    "isDesc": false
  },
  "limit": 2
}
```

**请求参数**

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| type | String | （必需）数据类型，详见 1.2 数据说明 |
| startUnix | Int64 | （必需）开始时间戳[秒] |
| endUnix | Int64 | （必需）结束时间戳[秒] |
| filters | Object[] | （必需）过滤条件 |
| key | String | （必需）键值 |
| operator | String | （必需）比较运算 |
| value | Object | （必需）比较值，类型为 String 或者 String[] |
| orderBy | Object | （必需）排序方式 |
| field | String | （必需）排序对象 |
| isDesc | Bool | （必需）true：降序，false：升序 |
| limit | Int32 | （必需）最大数量 |

**返回示例**

```json
[
  {
    "data": [
      255
    ],
    "tag": "Ttag1",
    "machineID": "模拟机台 1",
    "time": "2025-04-28T06:30:19.827Z"
  },
  {
    "data": [
      2147483647
    ],
    "tag": "Ttag2",
    "machineID": "模拟机台 1",
    "time": "2025-04-28T06:30:19.848Z"
  }
]
```

返回参数中，`machineID` 是机台的 machineID（见 1.1 基本说明），`time` 是数据的获取时间。其它返回参数详见 1.2 数据说明中对应 type 包含的 field 与 tag 内容说明。

---

## 2.9 网关配置接口

网关配置接口用于命令网关执行特定功能，基地址 `/api/config`。

---

## 2.9.1 全局配置接口

### 2.9.1.1 gateway-info 获取网关信息

此接口无请求参数。

```
GET  /api/config/gateway-info
```

**返回示例**

```json
{
  "hid": "XXXXXX-XXXXXX-XXXXXX-XXXXXX",
  "uid": "XXXXXX-XXXXXX-XXXXXX-XXXXXX",
  "alias": "iotgw"
}
```

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| hid | String | （必需）网关硬件 ID |
| uid | String | （必需）网关 UID |
| alias | String | （必需）网关名称 |

---

### 2.9.1.2 settings 获取网关全局设置

此接口无请求参数。

```
GET  /api/config/settings
```

**返回示例**

```json
{
  "version": "1.19.3.102",
  "enableLocalCaching": true,
  "enableRemoteService": true,
  "enableLan2Setup": false,
  "timeServerAddress": "ntp1.aliyun.com;ntp2.aliyun.com;ntp3.aliyun.com;ntp4.aliyun.com;"
}
```

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| version | String | （必需）设置版本 |
| enableLocalCaching | Bool | （必需）启用本地缓存 |
| enableRemoteService | Bool | （必需）启用远程协助 |
| enableLan2Setup | Bool | （必需）启用 LAN2 设置 |
| timeServerAddress | String | （必需）时间服务器地址 |

---

### 2.9.1.3 update-settings 修改网关全局设置

```
POST  /api/gateway/update-settings
```

**请求体示例 application/json**

```json
{
  "enableLocalCaching": true,
  "enableRemoteService": true,
  "enableLan2Setup": false,
  "timeServerAddress": "ntp1.aliyun.com;ntp2.aliyun.com;ntp3.aliyun.com;ntp4.aliyun.com;"
}
```

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| enableLocalCaching | Bool | 启用本地缓存 |
| enableRemoteService | Bool | 启用远程协助 |
| enableLan2Setup | Bool | 启用 LAN2 设置 |
| timeServerAddress | String | 时间服务器地址 |

**返回示例**

```json
{
  "version": "1.19.3.102",
  "enableLocalCaching": true,
  "enableRemoteService": true,
  "enableLan2Setup": false,
  "timeServerAddress": "ntp1.aliyun.com;ntp2.aliyun.com;ntp3.aliyun.com;ntp4.aliyun.com;"
}
```

返回参数同请求参数，另附 `version`（设置版本）。

---

### 2.9.1.4 security 获取网关全局安全设置

此接口无请求参数。

```
GET  /api/config/security
```

**返回示例**

```json
{
  "enable": true,
  "protectedApi": "exact,/cnc/writeOffsetData;exact,/cnc/writePlcData"
}
```

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| enable | Bool | （必需）启用全局安全控制 |
| protectedApi | String | 受保护 API，即禁止任何用户使用的 API。未返回代表未设置。API 命令格式见下表。 |

**表格 58 API 命令格式**

| API 命令类型 | exact | prefix |
|-------------|-------|--------|
| 说明 | 指定具体一个 API 地址 | 指定有相同前缀的所有 API 地址 |
| 示例 | `exact,/cnc/writePlcData` | `prefix,/db` |

- API 地址从 "/api" 后开始。`"prefix,/"` 代表所有的 API 地址。
- 多条 API 地址命令以 ";" 分隔。

---

### 2.9.1.5 update-security 修改全局安全设置

```
POST  /api/gateway/update-security
```

**请求体示例 application/json**

```json
{
  "enable": true,
  "protectedApi": "exact,/cnc/writeOffsetData;exact,/cnc/writePlcData"
}
```

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| enable | Bool | （必需）启用全局安全控制 |
| protectedApi | String | 受保护 API。API 命令格式参考表格 58。 |

**返回示例**

```json
{
  "enable": true,
  "protectedApi": "exact,/cnc/writeOffsetData;exact,/cnc/writePlcData"
}
```

返回参数同请求参数。

---

## 2.9.2 用户配置接口

### 2.9.2.1 user 获取用户设置

此接口无请求参数。

```
GET  /api/config/user
```

**返回示例**

```json
{
  "id": 0,
  "username": "admin",
  "isAdmin": true
}
```

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| id | Int32 | （必需）数据库标识，详见 1.1.4 ID 数据库标识 |
| username | String | （必需）用户名 |
| isAdmin | Bool | （必需）是否有管理员权限 |

---

### 2.9.2.2 users 获取所有用户设置

此接口无请求参数。

```
GET  /api/config/users
```

**返回示例**

```json
[
  {
    "id": 0,
    "username": "admin",
    "isAdmin": true
  },
  {
    "id": 1,
    "username": "user1",
    "isAdmin": false
  }
]
```

返回参数同 2.9.2.1。

---

### 2.9.2.3 create-user 创建新用户

新用户的初始密码与用户名相同。

```
POST  /api/config/create-user
```

**请求体示例 application/json**

```json
{
  "username": "user2",
  "isAdmin": false
}
```

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| username | String | （必需）用户名 |
| isAdmin | Bool | 是否有管理员权限，默认为 true |

**返回示例**

```json
{
  "id": 2,
  "username": "user2",
  "isAdmin": false
}
```

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| id | Int32 | （必需）数据库标识 |
| username | String | （必需）用户名 |
| isAdmin | Bool | （必需）是否有管理员权限 |

---

### 2.9.2.4 update-user 修改用户设置

修改用户名时，密码不会被修改。

```
POST  /api/config/update-user
```

**请求体示例 application/json**

```json
{
  "id": 2,
  "username": "user2",
  "isAdmin": false
}
```

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| id | Int32 | （必需）数据库标识 |
| username | String | 用户名，默认不修改 |
| isAdmin | Bool | 是否有管理员权限，默认不修改 |

**返回示例**

```json
{
  "id": 2,
  "username": "user2",
  "isAdmin": false
}
```

返回参数同 2.9.2.3。

---

### 2.9.2.5 delete-user 删除用户

```
GET  /api/config/delete-user?id=ID
```

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| id | Int32 | （必需）数据库标识 |

**返回示例**

```json
{
  "errorCode": 0,
  "errorMsg": "Success"
}
```

---

### 2.9.2.6 user-security 获取用户安全设置

```
GET  /api/config/user-security?id=ID
```

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| id | Int32 | （必需）数据库标识 |

**返回示例**

```json
{
  "id": 2,
  "secretKey": "sk-XXXXXXXXXX",
  "authorizedApis": "prefix,/cnc;prefix,/db;prefix,/analysis;prefix,/group-analysis;prefix,/config;prefix,/core;prefix,/gateway;prefix,/auth;"
}
```

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| id | Int32 | （必需）数据库标识 |
| secretKey | String | 密钥，以 "sk-" 前缀开头。未返回代表未设置。 |
| authorizedApis | String | 授权 API，即用户可以使用的 API。未返回代表未设置。API 命令格式参考表格 58。 |

---

### 2.9.2.7 update-user-security 修改用户安全设置

```
POST  /api/config/update-user-security
```

**请求体示例 application/json**

```json
{
  "id": 2,
  "secretKey": "Token",
  "authorizedApis": "prefix,/cnc;prefix,/db;prefix,/analysis;prefix,/group-analysis;prefix,/config;prefix,/core;prefix,/gateway;prefix,/auth;"
}
```

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| id | Int32 | （必需）数据库标识 |
| secretKey | String | 密钥，以 "sk-" 前缀开头 |
| authorizedApis | String | 授权 API。API 命令格式参考表格 58。 |

**返回示例**

```json
{
  "id": 2,
  "secretKey": "Token",
  "authorizedApis": "prefix,/cnc;prefix,/db;prefix,/analysis;prefix,/group-analysis;prefix,/config;prefix,/core;prefix,/gateway;prefix,/auth;"
}
```

返回参数同请求参数。

---

## 2.9.3 机台配置接口

机台配置接口用于获取、新增、修改，或删除机台配置。机台配置相关说明可以参考《说明书》5.3 机台配置。

**表格 59 机台配置参数**

| 参数 | 类型 | 说明 |
|------|------|------|
| id | Int32 | 数据库标识 |
| machineType | String | 机台类型，详见表格 60 machineType 对应机台类型 |
| system | String | 系统 |
| model | String | 型号 |
| name | String | 机台名 |
| machineID | String | 机台标识 |
| slaveID | Int32 | 从站标识 |
| ip | String | IP 地址 |
| port | Int32 | 端口号，0 代表各设备的默认端口号 |
| isActive | Bool | 激活状态，true=激活，false=未激活 |
| useDefaultMachineID | Bool | 使用默认机台标识 |
| useDefaultSlaveID | Bool | 使用默认从站标识 |
| customAttributes | String | 自定义属性，示例：`{"attribute": value,...}` |
| username | String | 用户名，部分设备需要 |
| permission | String | 权限，仅 Delta 台达 CNC 系统需要设置，范围：NORMAL, USER_1, USER_2, MACHIN, SYSTEM，默认为 NORMAL |
| password | String | 密码，部分设备需要 |
| version | String | 版本，部分设备需要 |
| connectionMode | String | 连接方式，部分设备需要 |
| encoding | String | 编码，如 ASCII, UTF-8, GBK 等。默认为 default 自动获取 |
| language | String | 警报语言。仅 Siemens 西门子系统需要设置，目前支持 English, Chinese，默认为 Chinese |
| numberOfTasks | Int32 | 启用的任务数。只读 |
| taskAlarm | Bool | 警报信息任务，true=开启，false=关闭 |
| taskAlarmPrecond | String | 警报信息任务前置条件，未返回代表未设置 |
| taskAlarmEnableCustomAlarm | Bool | 自定义警报，true=开启，false=关闭。开启后以自定义警报代替默认警报 |
| taskAlarmCustomAlarmStatusTag | String | 自定义警报 alarmStatus 标签，填入对应 PLC 数据任务结果标签 |
| taskAlarmCustomAlarmMsgTag | String | 自定义警报 alarmMsg 标签，填入对应 PLC 数据任务结果标签 |
| taskMachineStatus | Bool | 机台状态任务，true=开启，false=关闭 |
| taskChannelMachineStatus | String | 机台状态任务目标通道，如 "0;1-3" |
| taskMachineStatusPrecond | String | 机台状态任务前置条件，未返回代表未设置 |
| taskMachineStatusEnableAdjustedManual | Bool | 机台状态任务调机状态修正，true=开启，false=关闭 |
| taskMachineStatusMaxManualPauseTime | Int32 | 机台状态任务最长调机暂停时间（秒） |
| taskMachineStatusEnableStatusConversion | Bool | 机台状态任务状态转换，true=开启，false=关闭 |
| taskMachineStatusStatusConversionSettings | String | 机台状态任务满足条件时转换状态 |
| taskMachineStatusEnableCustomStatus | Bool | 自定义机台状态任务，true=开启，false=关闭。开启后以自定义状态代替默认状态 |
| taskMachineStatusCustomStatusCNCStatusTag | String | 自定义状态 cncStatus 标签，填入对应 PLC 数据任务结果标签 |
| taskMachineStatusCustomStatusAlarmStatusTag | String | 自定义状态 alarmStatus 标签，填入对应 PLC 数据任务结果标签 |
| taskCount | Bool | 加工计数任务，true=开启，false=关闭 |
| taskCountPrecond | String | 加工计数任务前置条件，未返回代表未设置 |
| taskCountEnableCustomCount | Bool | 自定义加工计数任务，true=开启，false=关闭 |
| taskCountCustomCountTag | String | 自定义加工计数标签，填入对应 PLC 数据任务结果标签 |
| taskCurrentToolNo | Bool | 当前刀号任务，true=开启，false=关闭 |
| taskChannelCurrentToolNo | String | 当前刀号任务目标通道，如 "0;1-3" |
| taskCurrentToolNoPrecond | String | 当前刀号任务前置条件，未返回代表未设置 |
| taskEnergyConsumption | Bool | 能耗任务，true=开启，false=关闭 |
| taskEnergyConsumptionPrecond | String | 能耗任务前置条件，未返回代表未设置 |
| taskFeed | Bool | 进给任务，true=开启，false=关闭 |
| taskChannelFeed | String | 进给任务目标通道，如 "0;1-3" |
| taskFeedPrecond | String | 进给任务前置条件，未返回代表未设置 |
| taskFeedAndSpindle | Bool | 进给转速任务，true=开启，false=关闭 |
| taskChannelFeedAndSpindle | String | 进给转速任务目标通道，如 "0;1-3" |
| taskFeedAndSpindlePrecond | String | 进给转速任务前置条件，未返回代表未设置 |
| taskLaserPower | Bool | 激光功率任务，true=开启，false=关闭 |
| taskLoad | Bool | 负载数据任务，true=开启，false=关闭 |
| taskChannelLoad | String | 负载数据任务目标通道，如 "0;1-3" |
| taskLoadPrecond | String | 负载数据任务前置条件，未返回代表未设置 |
| taskLogHistory | Bool | 日志历史任务，true=开启，false=关闭 |
| taskLogHistoryPrecond | String | 日志历史任务前置条件，未返回代表未设置 |
| taskOverLoad | Bool | 过载监控任务，true=开启，false=关闭 |
| taskChannelOverLoad | String | 过载监控任务目标通道，如 "0;1-3" |
| taskOverLoadPrecond | String | 过载监控任务前置条件，未返回代表未设置 |
| taskPlcData | Bool | PLC 数据任务，true=开启，false=关闭 |
| taskPlcDataSettings | String | PLC 数据任务设置 |
| taskPosition | Bool | 坐标数据任务，true=开启，false=关闭 |
| taskChannelPosition | String | 坐标数据任务目标通道，如 "0;1-3" |
| taskPositionPrecond | String | 坐标数据任务前置条件，未返回代表未设置 |
| taskCurrentProgramBlock | Bool | 当前程序段任务，true=开启，false=关闭 |
| taskCurrentProgramBlockPrecond | String | 当前程序段任务前置条件，未返回代表未设置 |
| taskProgramInfo | Bool | 加工程序任务，true=开启，false=关闭 |
| taskChannelProgramInfo | String | 加工程序任务目标通道，如 "0;1-3" |
| taskProgramInfoPrecond | String | 加工程序任务前置条件，未返回代表未设置 |
| taskMachineTimeData | Bool | 机台时间任务，true=开启，false=关闭 |
| taskMachineTimeDataPrecond | String | 机台时间任务前置条件，未返回代表未设置 |
| taskToolLife | Bool | 刀具寿命任务，true=开启，false=关闭 |
| taskToolLifePrecond | String | 刀具寿命任务前置条件，未返回代表未设置 |
| taskToolLifeGroupNumIndex | String | 刀具寿命任务目标刀具，{刀组号.组内序号} 格式 |
| taskToolLifeIndex | String | 刀具寿命任务目标刀具，{序号} 格式 |
| taskToolLifeToolNum | String | 刀具寿命任务目标刀具，{刀具号} 格式 |
| taskToolLifeToolNumOffsetNum | String | 刀具寿命任务目标刀具，{刀具号.刀补号} 格式 |
| taskToolOffset | Bool | 刀具补偿任务，true=开启，false=关闭 |
| taskChannelToolOffset | String | 刀具补偿任务目标通道，如 "0;1-3" |
| taskToolOffsetPrecond | String | 刀具补偿任务前置条件，未返回代表未设置 |
| taskToolOffsetToolNum | String | 刀具补偿任务目标刀具，{刀具号} 格式 |
| taskToolOffsetOffsetNum | String | 刀具补偿任务目标刀具，{刀补号} 格式 |
| taskToolOffsetToolNumOffsetNum | String | 刀具补偿任务目标刀具，{刀具号.刀补号} 格式 |
| taskAlarmHistory | Bool | 警报历史任务，true=开启，false=关闭 |
| taskAlarmHistoryPrecond | String | 警报历史任务前置条件，未返回代表未设置 |
| taskCycleData | Bool | 节拍数据任务，true=开启，false=关闭 |
| taskCycleDataPrecond | String | 节拍数据任务前置条件，未返回代表未设置 |
| taskOEE | Bool | OEE 监控任务，true=开启，false=关闭 |
| taskOEEPrecond | String | OEE 监控任务前置条件，未返回代表未设置 |
| taskExternalPlcDataSettings | String | 外部 PLC 任务设置 |
| parallelProcessing | Int | 并行任务处理数 |
| fileServerType | String | 文件服务器类型（程序传输），可能的值有 Machine Memory, Shared Folder, Shared Folder (Win XP), FTP Server, Wireless Disk, Gateway File Server |
| fileServerAddress | String | 服务器地址（程序传输） |
| fileServerPort | Int32 | 自定义端口（程序传输） |
| fileServerUsername | String | 用户名（程序传输） |
| fileServerPassword | String | 密码（程序传输） |
| fileServerUCode | String | U 码（程序传输） |
| fileServerRootDir | String | 根目录（程序传输） |
| modbusSlaveID | Int32 | 从站 ID（常规），MODBUS 通讯需要，默认为 1 |
| modbusByteOrder4 | String | 32 位型格式，MODBUS 通讯需要，范围：DCBA, BADC, ABCD, CDAB |
| modbusByteOrder8 | String | 64 位型格式，MODBUS 通讯需要，范围：HGFEDCBA, BADCFEHG, ABCDEFGH, GHEFCDAB |
| modbusPLCAddress | Bool | 使用 PLC 地址，MODBUS 通讯需要，true=开启，false=关闭。启用后目标地址位偏移 +1 |
| modbusReverseString | Bool | 反转字符串，MODBUS 通讯需要，true=开启，false=关闭 |

> **注意：** 接口仅返回已设置项。password 参数无论是否已设置都不会返回。机台的 machineType 参数不同，支持的任务不同，接口返回支持任务的相关参数。

**表格 60 machineType 对应机台类型**

| machineType | 机台类型 |
|-------------|---------|
| CNC | CNC |
| LASER | 激光切割机 |
| PLC | PLC |
| ROBOT | 机器人 |

---

### 2.9.3.1 machine 获取机台配置

```
GET  /api/config/machine?ID=ID&machineID=MACHINEID
```

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| id | Int32 | 数据库标识 |
| machineID | String | 目标机台标识。如 ID 与 machineID 同时输入，machineID 被忽略 |

**返回示例**

```json
{
  "id": 1,
  "machineType": "CNC",
  "system": "Mock",
  "model": "General",
  "name": "演示 1",
  "useDefaultMachineID": true,
  "machineID": "1",
  "useDefaultSlaveID": true,
  "slaveID": 1,
  "customAttributes": "",
  "encoding": "Default",
  "ip": "127.0.0.1",
  "port": 0,
  "isActive": true,
  "numberOfTasks": 20,
  "taskAlarm": true,
  "taskMachineStatus": true,
  "taskChannelMachineStatus": "0",
  "taskCount": true,
  "taskCurrentToolNo": true,
  "taskEnergyConsumption": true,
  "taskFeedAndSpindle": true,
  "taskChannelFeedAndSpindle": "0",
  "taskLoad": true,
  "taskChannelLoad": "0",
  "taskLogHistory": true,
  "taskOverLoad": true,
  "taskChannelOverLoad": "0",
  "taskPlcData": true,
  "taskPlcDataSettings": "R,0,10,Int16;Y,0,3,Bit0",
  "taskPosition": true,
  "taskChannelPosition": "0",
  "taskCurrentProgramBlock": true,
  "taskChannelCurrentProgramBlock": "0",
  "taskProgramInfo": true,
  "taskChannelProgramInfo": "0",
  "taskMachineTimeData": true,
  "taskToolLife": true,
  "taskToolOffset": true,
  "taskChannelToolOffset": "0",
  "taskToolOffsetToolNumOffsetNum": "1.2;3-5.1;7-9.1-3",
  "taskAlarmHistory": true,
  "taskCycleData": true,
  "taskOEE": true,
  "parallelProcessing": 1,
  "fileServerType": "Machine Memory",
  "fileServerRootDir": ""
}
```

返回参数见表格 59 机台配置参数。

---

### 2.9.3.2 machines 获取所有机台配置

此接口无请求参数。

```
GET  /api/config/machines
```

返回所有机台配置的数组。返回参数见表格 59 机台配置参数。

---

### 2.9.3.3 create-machine 添加机台配置

```
POST  /api/config/create-machine
```

**请求体示例**

```json
{
  "machineType": "PLC",
  "system": "Standard Protocols",
  "model": "Modbus TCP",
  "name": "150",
  "useDefaultMachineID": false,
  "machineID": "M150",
  "useDefaultSlaveID": true,
  "ip": "127.0.0.150",
  "isActive": true,
  "taskPlcData": true,
  "taskPlcDataSettings": "4x,100,2,Int32;0x,100,10,Bit0;"
}
```

请求参数见表格 59 机台配置参数。注意请求体中不用设置数据库标识 id，id 由网关自动分配，创建成功后出现在返回体中。

返回参数见表格 59 机台配置参数。

---

### 2.9.3.4 update-machine 修改机台配置

修改指定机台的配置信息并返回修改后的机台配置信息。

```
POST  /api/config/update-machine
```

**请求体示例**

```json
{
  "id": 21,
  "name": "newName",
  "useDefaultMachineID": false,
  "machineID": "newMachineID",
  "useDefaultSlaveID": false,
  "slaveID": 192,
  "ip": "127.0.0.192",
  "port": 6000,
  "isActive": false,
  "taskPlcData": false
}
```

请求参数见表格 59 机台配置参数。注意：此接口使用 id 作为唯一标识，请求体中必须设置数据库标识 id。机台标识 machineID 可以通过这个接口修改。

返回参数见表格 59 机台配置参数。

---

### 2.9.3.5 delete-machine 删除机台配置

```
GET  /api/config/delete-machine?ID=ID&machineID=MACHINEID
```

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| id | Int32 | 数据库标识 |
| machineID | String | 目标机台标识。如 ID 与 machineID 同时输入，machineID 被忽略 |

**返回示例**

```json
{
  "errorCode": 0,
  "errorMsg": "Success"
}
```

---

### 2.9.3.6 batch-delete-machines 批量删除机台配置

此接口为 2.9.3.5 delete-machine 删除机台配置的批量版本，通过在请求体中补充数据库 ID，可以一次删除多个机台。

```
POST  /api/config/batch-delete-machines
```

**请求体示例 application/json**

```json
{
  "ids": [2, 3, 4]
}
```

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| ids | Int32[] | （必需）数据库标识数组 |

**返回示例**

```json
{
  "deleted": 3
}
```

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| deleted | Int32 | （必需）删除机台数 |

---

## 2.9.4 机组配置接口

机组配置接口用于获取、新增、修改，或删除机组配置。机组配置相关说明可以参考《说明书》5.4 机组配置。

**表格 61 机组配置参数**

| 参数 | 类型 | 说明 |
|------|------|------|
| id | Int32 | 机组数据库标识 |
| number | Int32 | 机台，有效范围 1~8 |
| useDefaultGroupID | Bool | 使用默认机组标识 |
| groupID | String | 机组标识 |
| name | String | 机台名 |
| isActive | Bool | 激活状态，true=激活，false=未激活 |
| machines | Object[] | 机组包含的机台信息，详见表格 62 machines 机台列表信息 |
| enableExternalMachines | Bool | 启用外部机台 |
| externalMachines | String | 外部机台命令 |
| taskCount | Bool | 机组加工计数任务，true=开启，false=关闭 |
| taskOEE | Bool | 机组 OEE 监控任务，true=开启，false=关闭 |
| taskCumulativeStatusTime | Bool | 机组累计状态时间任务，true=开启，false=关闭 |

**表格 62 machines 机台列表信息**

| 参数 | 类型 | 说明 |
|------|------|------|
| id | Int32 | 机台数据库标识。在列表中添加或移除 id 以添加指定机台到机组或从机组移除 |
| machineType | String | 机台类型 |
| system | String | 系统 |
| model | String | 型号 |
| name | String | 机台名 |
| machineID | String | 机台标识。在列表中添加或移除 machineID 以添加指定机台到机组或从机组移除。如 ID 与 machineID 同时输入，machineID 被忽略 |
| slaveID | Int32 | 从站标识 |
| ip | String | IP 地址 |
| port | Int32 | 端口号，0 代表各设备的默认端口号 |
| isActive | Bool | 激活状态 |
| countMultiplier | Int32 | 产量系数 |

---

### 2.9.4.1 group 获取机组配置

```
GET  /api/config/group?ID=ID&groupID=GROUPID
```

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| id | Int32 | 数据库标识 |
| groupID | String | 目标机组标识。如 ID 与 groupID 同时输入，groupID 被忽略 |

**返回示例**

```json
{
  "id": 1,
  "number": 1,
  "useDefaultGroupID": true,
  "groupID": "g1",
  "name": "g1",
  "isActive": true,
  "machines": [
    {
      "id": 4,
      "machineType": "CNC",
      "system": "Mock",
      "model": "General",
      "name": "演示 1",
      "machineID": "1",
      "slaveID": 1,
      "ip": "127.0.0.1",
      "port": 0,
      "isActive": true,
      "countMultiplier": 1
    }
  ],
  "enableExternalMachines": false,
  "taskCount": true,
  "taskOEE": true,
  "taskCumulativeStatusTime": true
}
```

返回参数见表格 61 机组配置参数。

---

### 2.9.4.2 groups 获取所有机组配置

此接口无请求参数。

```
GET  /api/config/groups
```

返回所有机组配置的数组。返回参数见表格 61 机组配置参数。

---

### 2.9.4.3 create-group 添加机组配置

```
POST  /api/config/create-group
```

**请求体示例**

```json
{
  "number": 7,
  "name": "g7",
  "useDefaultGroupID": false,
  "groupID": "group7",
  "isActive": true,
  "machines": [
    {"id": 6, "countMultiplier": 23},
    {"id": 7, "machineID": "4", "countMultiplier": 4}
  ],
  "enableExternalMachines": false,
  "taskCount": true,
  "taskOEE": true,
  "taskCumulativeStatusTime": true
}
```

请求参数见表格 61 机组配置参数。注意请求体中不用设置数据库标识 id，id 由网关自动分配，创建成功后出现在返回体中。

返回参数见表格 61 机组配置参数。

---

### 2.9.4.4 update-group 修改机组配置

修改指定机组的配置信息并返回修改后的机组配置信息。

```
POST  /api/config/update-group
```

**请求体示例**

```json
{
  "id": 3,
  "number": 6,
  "name": "newName",
  "useDefaultGroupID": false,
  "groupID": "newGroupID",
  "isActive": true,
  "machines": [{"id": 6, "countMultiplier": 1}],
  "taskCount": false,
  "taskOEE": false,
  "taskCumulativeStatusTime": false
}
```

请求参数见表格 61 机组配置参数。注意：此接口使用 id 作为唯一标识，请求体中必须设置数据库标识 id。机组标识 groupID 可以通过这个接口修改。

返回参数见表格 61 机组配置参数。

---

### 2.9.4.5 delete-group 删除机组配置

```
GET  /api/config/delete-group?ID=ID&groupID=GROUPID
```

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| ID | Int32 | 数据库标识 |
| groupID | String | 目标机组标识。如 ID 与 groupID 同时输入，groupID 被忽略 |

**返回示例**

```json
{
  "errorCode": 0,
  "errorMsg": "Success"
}
```

---

### 2.9.4.6 batch-delete-groups 批量删除机组配置

此接口为 2.9.4.5 delete-group 删除机组配置的批量版本，通过在请求体中补充数据库 ID，可以一次删除多个机组。

```
POST  /api/config/batch-delete-groups
```

**请求体示例 application/json**

```json
{
  "ids": [2, 3, 4]
}
```

| 请求参数 | 类型 | 说明 |
|---------|------|------|
| ids | Int32[] | （必需）数据库标识数组 |

**返回示例**

```json
{
  "deleted": 3
}
```

| 返回参数 | 类型 | 说明 |
|---------|------|------|
| deleted | Int32 | （必需）删除机组数 |

---

## 2.9.5 任务配置接口

任务配置接口用于获取或修改任务配置。任务配置相关说明可以参考《说明书》5.5 任务配置。

### 2.9.5.1 machine-task-interval-settings 获取机台任务间隔设置

此接口无请求参数。

```
GET  /api/config/machine-task-interval-settings
```

**返回示例**

```json
{
  "alarm": 5000,
  "machineStatus": 5000,
  "count": 5000,
  "currentToolNo": 5000,
  "energyConsumption": 60000,
  "feedAndSpindle": 5000,
  "laserPower": 5000,
  "load": 5000,
  "logHistory": 5000,
  "overload": 100,
  "plcData": 5000,
  "position": 5000,
  "currentProgramBlock": 5000,
  "programInfo": 5000,
  "machineTimeData": 5000,
  "toolLife": 5000,
  "toolOffset": 5000,
  "alarmHistory": 5000,
  "cycleData": 5000,
  "oee": 5000
}
```

**表格 63 机台任务间隔设置参数**

| 参数 | 类型 | 说明 |
|------|------|------|
| alarm | Int32 | 警报信息间隔（毫秒） |
| machineStatus | Int32 | 机台状态间隔（毫秒） |
| count | Int32 | 加工计数间隔（毫秒） |
| currentToolNo | Int32 | 当前刀号间隔（毫秒） |
| energyConsumption | Int32 | 能耗间隔（毫秒） |
| feedAndSpindle | Int32 | 进给转速数据间隔（毫秒） |
| laserPower | Int32 | 激光功率间隔（毫秒） |
| load | Int32 | 负载数据间隔（毫秒） |
| logHistory | Int32 | 日志历史间隔（毫秒） |
| overload | Int32 | 过载监控间隔（毫秒） |
| plcData | Int32 | PLC 数据间隔（毫秒） |
| position | Int32 | 坐标数据间隔（毫秒） |
| currentProgramBlock | Int32 | 当前程序段间隔（毫秒） |
| programInfo | Int32 | 加工程序信息间隔（毫秒） |
| machineTimeData | Int32 | 机台时间数据间隔（毫秒） |
| toolLife | Int32 | 刀具寿命间隔（毫秒） |
| toolOffset | Int32 | 刀具补偿间隔（毫秒） |
| alarmHistory | Int32 | 警报历史间隔（毫秒） |
| cycleData | Int32 | 节拍数据间隔（毫秒） |
| oee | Int32 | OEE 监控间隔（毫秒） |

---

### 2.9.5.2 update-machine-task-interval-settings 修改机台任务间隔设置

修改机台任务间隔设置并返回修改后的设置。

```
POST  /api/config/update-machine-task-interval-settings
```

**请求体示例**

```json
{
  "alarm": 6000,
  "machineStatus": 8000
}
```

请求参数见表格 63 机台任务间隔设置参数。不在请求体中的参数保持原来数值。

返回参数见表格 63 机台任务间隔设置参数。

---

### 2.9.5.3 group-task-interval-settings 获取机组任务间隔设置

此接口无请求参数。

```
GET  /api/config/group-task-interval-settings
```

**返回示例**

```json
{
  "count": 5000,
  "oee": 5000,
  "cumulativeStatusTime": 5000
}
```

**表格 64 机组任务间隔设置参数**

| 参数 | 类型 | 说明 |
|------|------|------|
| count | Int32 | 加工计数间隔（毫秒） |
| oee | Int32 | OEE 监控间隔（毫秒） |
| cumulativeStatusTime | Int32 | 累计状态时间（毫秒） |

---

### 2.9.5.4 update-group-task-interval-settings 修改机组任务间隔设置

修改机组任务间隔设置并返回修改后的设置。

```
POST  /api/config/update-group-task-interval-settings
```

**请求体示例**

```json
{
  "count": 3000,
  "oee": 2000,
  "cumulativeStatusTime": 1000
}
```

请求参数见表格 64 机组任务间隔设置参数。

返回参数见表格 64 机组任务间隔设置参数。

---

### 2.9.5.5 oee-monitoring-settings 获取 OEE 监控设置

此接口无请求参数。

```
GET  /api/config/oee-monitoring-settings
```

**返回示例**

```json
{
  "monitorMode": "Scheduled Reset",
  "windowSize": 3600,
  "resetTime": "00:00",
  "availabilityMode": "Autorun Time / Total Time",
  "breakTimeInterval": ""
}
```

**表格 65 OEE 监控设置参数**

| 参数 | 类型 | 说明 |
|------|------|------|
| monitorMode | String | 监控模式，详见表格 66 monitorMode 监控模式 |
| windowSize | Int32 | 窗口时间（秒），实时窗口模式下生效 |
| resetTime | String | 重置时刻（小时:分钟），到点重置模式下生效 |
| availabilityMode | String | 开动率计算方式，详见表格 67 availabilityMode 开动率计算方式 |
| breakTimeInterval | String | 休息时间段（小时:分钟-小时:分钟） |

**表格 66 monitorMode 监控模式**

| 选项 | 说明 |
|------|------|
| Scheduled Reset | 到点重置 |
| Time Window | 实时窗口 |

**表格 67 availabilityMode 开动率计算方式**

| 选项 | 说明 |
|------|------|
| Autorun Time / Total Time | 运行时间/总时间 |
| Autorun Time / (Total Time - Off Time) | 运行时间/（总时间-关机时间） |
| Autorun Time / (Total Time - Off Time - Manual Time) | 运行时间/（总时间-关机时间-调机时间） |
| Autorun Time / (Total Time - Break Time) | 运行时间/（总时间-休息时间） |

---

### 2.9.5.6 update-oee-monitoring-settings 修改 OEE 监控设置

修改 OEE 监控设置并返回修改后的设置。

```
POST  /api/config/update-oee-monitoring-settings
```

**请求体示例**

```json
{
  "monitorMode": "Time Window",
  "windowSize": 6000,
  "resetTime": "00:00;22:00;01:00;2:00",
  "availabilityMode": "Autorun Time / (Total Time - Break Time)",
  "breakTimeInterval": "08:00-09:00;11:30-12:30"
}
```

请求/返回参数见表格 65 OEE 监控设置参数。

---

### 2.9.5.7 tool-life-monitoring-settings 获取刀具寿命监控设置

此接口无请求参数。

```
GET  /api/config/tool-life-monitoring-settings
```

**返回示例**

```json
{
  "enableToolLifeDetails": false
}
```

**表格 68 刀具寿命监控设置参数**

| 参数 | 类型 | 说明 |
|------|------|------|
| enableToolLifeDetails | Bool | 刀具寿命详情，true=开启，false=关闭 |

---

### 2.9.5.8 update-tool-life-monitoring-settings 修改刀具寿命监控设置

修改刀具寿命监控设置并返回修改后的设置。

```
POST  /api/config/update-tool-life-monitoring-settings
```

**请求/返回参数见表格 68 刀具寿命监控设置参数。**

---

### 2.9.5.9 count-monitoring-settings 获取加工计数监控设置

此接口无请求参数。

```
GET  /api/config/count-monitoring-settings
```

**返回示例**

```json
{
  "monitorMode": "Time Window",
  "windowSize": 3600,
  "resetTime": "00:00"
}
```

**表格 69 加工计数监控设置参数**

| 参数 | 类型 | 说明 |
|------|------|------|
| monitorMode | String | 监控模式，详见表格 66 monitorMode 监控模式 |
| windowSize | Int32 | 窗口时间（秒），实时窗口模式下生效 |
| resetTime | String[] | 重置时刻（小时:分钟），到点重置模式下生效 |

---

### 2.9.5.10 update-count-monitoring-settings 修改加工计数监控设置

修改加工计数监控设置并返回修改后的设置。

```
POST  /api/config/update-count-monitoring-settings
```

**请求体示例**

```json
{
  "monitorMode": "Scheduled Reset",
  "windowSize": 36000,
  "resetTime": "23:00;3:24;15:28;12:22"
}
```

请求/返回参数见表格 69 加工计数监控设置参数。

---

### 2.9.5.11 overload-monitoring-settings 获取过载监控设置

此接口无请求参数。

```
GET  /api/config/overload-monitoring-settings
```

**返回示例**

```json
{
  "spindleLoadUpperLimit": 100.0
}
```

**表格 70 过载监控设置参数**

| 参数 | 类型 | 说明 |
|------|------|------|
| spindleLoadUpperLimit | Float | 主轴负载上限（%） |

---

### 2.9.5.12 update-overload-monitoring-settings 修改过载监控设置

修改过载监控设置并返回修改后的设置。

```
POST  /api/config/update-overload-monitoring-settings
```

**请求体示例**

```json
{
  "spindleLoadUpperLimit": 80.0
}
```

请求/返回参数见表格 70 过载监控设置参数。

---

### 2.9.5.13 alarm-monitoring-settings 获取警报监控设置

此接口无请求参数。

```
GET  /api/config/alarm-monitoring-settings
```

**返回示例**

```json
{
  "mininumAlarmLevel": "Warning"
}
```

**表格 71 警报监控设置参数**

| 参数 | 类型 | 说明 |
|------|------|------|
| mininumAlarmLevel | String | 最低报警级别，详见表格 72 mininumAlarmLevel 最低报警级别 |
| infoLevel | String | 消息级别关键词，不返回代表未设置 |
| errorLevel | String | 错误级别关键词，不返回代表未设置 |

**表格 72 mininumAlarmLevel 最低报警级别**

| 选项 | 说明 |
|------|------|
| Information | 消息 |
| Warning | 警告 |
| Error | 错误 |

---

### 2.9.5.14 update-alarm-monitoring-settings 修改警报监控设置

修改警报监控设置并返回修改后的设置。

```
POST  /api/config/update-alarm-monitoring-settings
```

**请求体示例**

```json
{
  "mininumAlarmLevel": "Error",
  "infoLevel": "消息;提示;Inf",
  "errorLevel": "错误;错误;Err"
}
```

请求/返回参数见表格 71 警报监控设置参数。

---

### 2.9.5.15 machine-status-monitoring-settings 获取机台状态监控设置

此接口无请求参数。

```
GET  /api/config/machine-status-monitoring-settings
```

**返回示例**

```json
{
  "enableStatusDetails": false,
  "enableAdjustedManualStatus": false,
  "maxManualPauseTime": 600,
  "enableStatusConversion": false
}
```

**表格 73 机台状态监控设置参数**

| 参数 | 类型 | 说明 |
|------|------|------|
| enableStatusDetails | Bool | 状态详情，true=开启，false=关闭 |
| enableAdjustedManualStatus | Bool | 调机状态修正，true=开启，false=关闭 |
| maxManualPauseTime | Int32 | 最长调机暂停时间（秒） |
| enableStatusConversion | Bool | 转换状态，true=开启，false=关闭 |
| statusConversionSettings | String | 状态转换，不返回代表未设置 |

---

### 2.9.5.16 update-machine-status-monitoring-settings 修改机台状态监控设置

修改机台状态监控设置并返回修改后的设置。

```
POST  /api/config/update-machine-status-monitoring-settings
```

**请求体示例**

```json
{
  "enableStatusDetails": true,
  "enableAdjustedManualStatus": true,
  "maxManualPauseTime": 300,
  "enableStatusConversion": true,
  "statusConversionSettings": "CNCStatus_cncStatus = \"MANUAL_MDI_RUN\" | AUTO_RUN"
}
```

请求/返回参数见表格 73 机台状态监控设置参数。

---

## 2.9.6 通讯配置接口

通讯配置接口用于获取或修改任务配置。通讯配置相关说明可以参考《说明书》5.6 通讯配置。

### 2.9.6.1 cloud-settings 获取云平台设置

此接口无请求参数。

```
GET  /api/config/cloud-settings
```

**返回示例**

```json
{
  "enable": false,
  "serverAddress": "severAddress",
  "token": "tokenABCDEFG",
  "enableBroadcasting": false,
  "enableGatewayLinking": false,
  "gatewayLinks": "uid1,token1;uid2,token2;"
}
```

**表格 74 云平台设置参数**

| 参数 | 类型 | 说明 |
|------|------|------|
| enable | Bool | 启用云平台，true=开启，false=关闭 |
| serverAddress | String | 服务器地址。不返回代表未设置 |
| token | String | 网关令牌。不返回代表未设置 |
| enableBroadcasting | Bool | 启用广播，true=开启，false=关闭。启用后通过云平台广播数据 |
| enableGatewayLinking | Bool | 启用网关关联，true=开启，false=关闭。启用后接收云平台下指定关联网关广播的数据 |
| gatewayLinks | String | 关联的网关。不返回代表未设置 |

---

### 2.9.6.2 update-cloud-settings 修改云平台设置

修改云平台设置并返回修改后的设置。

```
POST  /api/config/update-cloud-settings
```

请求/返回参数见表格 74 云平台设置参数。

---

### 2.9.6.3 modbus-settings 获取 MODBUS 设置

此接口无请求参数。

```
GET  /api/config/modbus-settings
```

**返回示例**

```json
{
  "enable": false,
  "byte4Order": "DCBA",
  "byte8Order": "HGFEDCBA",
  "encoding": "GBK",
  "reverseString": false
}
```

**表格 75 MODBUS 设置参数**

| 参数 | 类型 | 说明 |
|------|------|------|
| enable | Bool | 启用 MODBUS，true=开启，false=关闭 |
| byte4Order | String | 32 位型格式，支持：ABCD, BADC, CDAB, DCBA 等格式 |
| byte8Order | String | 64 位型格式，支持：ABCDEFGH, BADCFEHG, GHEFCDAB, HGFEDCBA 等格式 |
| encoding | String | 编码，如 ASCII, UTF-8, GBK 等 |
| reverseString | Bool | 反转字符串，true=开启，false=关闭 |

---

### 2.9.6.4 update-modbus-settings 修改 MODBUS 设置

修改 MODBUS 设置并返回修改后的设置。

```
POST  /api/config/update-modbus-settings
```

请求/返回参数见表格 75 MODBUS 设置参数。

---

### 2.9.6.5 mqtt-settings 获取 MQTT 设置

此接口无请求参数。

```
GET  /api/config/mqtt-settings
```

**返回示例**

```json
{
  "enable": false,
  "mode": "Default",
  "brokerAddress": "brokerAddress",
  "port": 1111,
  "clientID": "client",
  "username": "username",
  "password": "password",
  "dataReportTopic": "topic1",
  "rpcRequestTopic": "rpcReq",
  "rpcResponseTopic": "rpcRes",
  "encoding": "GBK",
  "allowAnomynous": false,
  "arrayToString": false,
  "publishOnValueChange": false,
  "publishAllOnValueChange": false,
  "timeoutReportingInterval": 0
}
```

**表格 76 MQTT 设置参数**

| 参数 | 类型 | 说明 |
|------|------|------|
| enable | Bool | 启用 MQTT，true=开启，false=关闭 |
| mode | String | 模式，详见表格 77 MQTT mode 模式 |
| brokerAddress | String | 服务器地址 |
| port | Int32 | 服务器端口 |
| clientID | String | 客户端 ID |
| username | String | 用户名 |
| password | String | 密码 |
| dataReportTopic | String | 数据上报主题 |
| rpcRequestTopic | String | RPC 请求主题 |
| rpcResponseTopic | String | RPC 回复主题 |
| encoding | String | 编码，如 ASCII, UTF-8, GBK 等 |
| allowAnomynous | Bool | 匿名登录，true=开启，false=关闭 |
| arrayToString | Bool | 数组转字符串，true=开启，false=关闭 |
| publishOnValueChange | Bool | 变化值写入，true=开启，false=关闭。默认为 false |
| publishAllOnValueChange | Bool | 变化时上传全部内容，true=开启，false=关闭。启用变化值上传时有效，默认为 false，即变化时，仅上传变化的部分 |
| timeoutReportingInterval | Int32 | 超时上报间隔。启用变化值上传时有效。单位：秒。默认为 0，即关闭超时上报 |

**表格 77 MQTT mode 模式**

| 选项 |
|------|
| Default |
| TB2 |
| Brm |
| IoTDA |
| WisIoT |
| MKT |
| TB |

---

### 2.9.6.6 update-mqtt-settings 修改 MQTT 设置

修改 MQTT 设置并返回修改后的设置。

```
POST  /api/config/update-mqtt-settings
```

请求/返回参数见表格 76 MQTT 设置参数。

---

### 2.9.6.7 database-settings 获取数据库设置

此接口无请求参数。

```
GET  /api/config/database-settings
```

**InfluxDB v2.x 类型返回示例**

```json
{
  "enable": true,
  "type": "InfluxDB v2.x",
  "serverAddress": "192.168.100.101",
  "port": "12345",
  "username": "username",
  "password": "password",
  "bucket": "Bucket",
  "tablePrefix": "Prefix",
  "organization": "Organization",
  "writeOnValueChange": true,
  "timeoutReportingInterval": 0
}
```

**非 InfluxDB v2.x 类型返回示例**

```json
{
  "enable": true,
  "type": "MySQL",
  "serverAddress": "192.168.100.101",
  "port": "12345",
  "username": "username",
  "password": "password",
  "database": "Database",
  "tablePrefix": "Prefix",
  "storageMode": "User Defined",
  "useLocalTime": false,
  "enablePrimaryKey": false,
  "writeOnValueChange": false,
  "timeoutReportingInterval": 0,
  "loggingModeTypes": ["AlarmHistory", "AxialOverload", "CNCStatus", "Count", ...],
  "realTimeModeTypes": ["AlarmLog", "GroupOEE", "OEE"]
}
```

**表格 78 数据库设置参数**

| 参数 | 类型 | 说明 |
|------|------|------|
| enable | Bool | 启用数据库，true=开启，false=关闭 |
| type | String | 类型，详见表格 79 数据库类型 |
| serverAddress | String | 服务器地址 |
| port | String | 服务器端口 |
| username | String | 用户名 |
| password | String | 密码 |
| bucket | String | 数据库，限 InfluxDB v2.x 类型 |
| organization | String | 机构名，限 InfluxDB v2.x 类型 |
| database | String | 数据库，限非 InfluxDB v2.x 类型 |
| storageMode | String | 保存模式，限非 InfluxDB v2.x 类型，详见表格 80 数据库保存模式 |
| dataRetentionPeriod | Int32 | 数据保留期限（小时），限非 InfluxDB v2.x 数据库类型 |
| loggingModeTypes | String[] | 保存模式为 User Defined 时有效，详见 1.2 数据说明中的 type 数据类型 |
| noActionModeTypes | String[] | 保存模式为 User Defined 时有效，详见 1.2 数据说明中的 type 数据类型 |
| realTimeModeTypes | String[] | 保存模式为 User Defined 时有效，详见 1.2 数据说明中的 type 数据类型 |
| useLocalTime | Bool | 使用本地时间，限非 InfluxDB v2.x 类型 |
| enablePrimaryKey | Bool | 启用主键，限非 InfluxDB v2.x 类型 |
| tablePrefix | String | 表前缀 |
| writeOnValueChange | Bool | 变化值写入，true=开启，false=关闭 |
| timeoutReportingInterval | Int32 | 超时上报间隔。启用变化值写入时有效。单位：秒。默认为 0，即关闭超时写入 |

**表格 79 数据库类型**

| 选项 |
|------|
| InfluxDB v2.x |
| MySQL |
| SQL Server |
| Postgre SQL |

**表格 80 数据库保存模式**

| 选项 | 说明 |
|------|------|
| Logging | 日志 |
| Real Time | 实时 |
| User Defined | 自定义 |

---

### 2.9.6.8 update-database-settings 修改数据库设置

修改数据库设置并返回修改后的设置。

```
POST  /api/config/update-database-settings
```

请求/返回参数见表格 78 数据库设置参数。

---

### 2.9.6.9 gateway-file-server-settings 获取网关文件服务器设置

此接口无请求参数。

```
GET  /api/config/gateway-file-server-settings
```

**返回示例**

```json
{
  "enable": false,
  "enableFtp": false,
  "enableSmb": false,
  "username": "dncuser",
  "password": "dncuser"
}
```

**表格 81 网关文件服务器设置参数**

| 参数 | 类型 | 说明 |
|------|------|------|
| enable | Bool | 启用网关文件服务器，true=开启，false=关闭 |
| enableFtp | String | 启用 FTP，true=开启，false=关闭 |
| enableSmb | String | 启用共享文件夹，true=开启，false=关闭 |
| username | String | 用户名，只读，不可修改 |
| password | String | 密码 |

---

### 2.9.6.10 update-gateway-file-server-settings 修改网关服务器设置

修改网关文件服务器设置并返回修改后的设置。

```
POST  /api/config/update-gateway-file-server-settings
```

请求/返回参数见表格 81 网关文件服务器设置参数。

---

### 2.9.6.11 http-settings 获取 HTTP 设置

此接口无请求参数。

```
GET  /api/config/http-settings
```

**返回示例**

```json
{
  "enable": true,
  "enableIpWhiteList": true,
  "ipWhiteList": "192.168.100.200;192.168.100.201;"
}
```

**表格 82 HTTP 设置参数**

| 参数 | 类型 | 说明 |
|------|------|------|
| Enable | Bool | 启用 HTTP，true=开启，false=关闭 |
| enableIpWhiteList | Bool | 启用 IP 白名单，true=开启，false=关闭 |
| ipWhiteList | String | 白名单列表（以;分隔）。未返回代表未设置 |

---

### 2.9.6.12 update-http-settings 修改 HTTP 设置

修改 HTTP 设置并返回修改后的设置。

```
POST  /api/config/update-http-settings
```

请求/返回参数见表格 82 HTTP 设置参数。

---

### 2.9.6.13 hub-settings 获取 Hub 设置

此接口无请求参数。

```
GET  /api/config/hub-settings
```

**返回示例**

```json
{
  "enable": false,
  "server": "serverAddress",
  "accessToken": "accessToken",
  "enableBroadcasting": false,
  "enableGatewayLinking": false,
  "gatewayLinks": "uid1,token1;uid2,token2;"
}
```

**表格 83 Hub 设置参数**

| 参数 | 类型 | 说明 |
|------|------|------|
| enable | Bool | 启用 Hub，true=开启，false=关闭 |
| server | String | 服务器地址。不返回代表未设置 |
| accessToken | String | 网关令牌。不返回代表未设置 |
| enableBroadcasting | Bool | 启用广播，true=开启，false=关闭。启用后通过 Hub 广播数据 |
| enableGatewayLinking | Bool | 启用网关关联，true=开启，false=关闭。启用后接收 Hub 下指定关联网关广播的数据 |
| gatewayLinks | String | 关联的网关。不返回代表未设置 |

---

### 2.9.6.14 update-hub-settings 修改 Hub 设置

修改 Hub 设置并返回修改后的设置。

```
POST  /api/config/update-hub-settings
```

请求/返回参数见表格 83 Hub 设置参数。

---

### 2.9.6.15 remote-access 获取远程访问设置

此接口无请求参数。

```
GET  /api/config/remote-access
```

**返回示例**

```json
{
  "host": "serverUrl",
  "hub": "XXXXXX-XXXXXX-XXXXXX-XXXXXX",
  "password": "password",
  "bridgeNetwork": "LAN1",
  "state": "Established",
  "expiration": "2999-12-31T23:59:59"
}
```

**表格 84 远程访问设置参数**

| 参数 | 类型 | 说明 |
|------|------|------|
| host | String | 远程服务器地址 |
| hub | String | 站点（只读），默认为网关 UID |
| password | String | 密码 |
| bridgeNetwork | String | 桥接网络："LAN1"，"LAN2"，""（无桥接） |
| state | String | 连接状态（只读）：Connecting, Negotiation, Retry（以上三种状态均为连接中状态），Auth（验证中），Established（已连接），Idle（未连接） |
| expiration | String | 截止日期（只读），仅当 state 为 Established（已连接）状态时返回 |

---

### 2.9.6.16 update-remote-access 修改远程访问设置

修改远程访问设置并返回修改后的设置。

```
POST  /api/config/update-remote-access
```

**请求体示例**

```json
{
  "host": "serverUrl2",
  "password": "password2",
  "bridgeNetwork": "LAN1"
}
```

请求/返回参数见表格 84 远程访问设置参数。

---

## 2.10 网关功能接口

网关功能接口用于命令网关执行特定功能，包括 Gateway 服务功能接口和 Core 服务功能接口。

---

### 2.10.1 Core 服务功能接口

基地址 `/api/core`。

---

#### 2.10.1.1 info 获取 Core 服务信息

此接口无请求参数。

| 方法 | URL |
|------|-----|
| GET | `/api/core/info` |

返回示例

```json
{
  "version": "1.19.4.18"
}
```

| 返回参数 | 类型 | 说明 |
|----------|------|------|
| version | String | (必需)版本号 |

---

#### 2.10.1.2 license-info 获取许可信息

获取许可详情，包括截至日期、许可数量、许可类型、许可状态等。此接口无请求参数。

| 方法 | URL |
|------|-----|
| GET | `/api/core/license-info` |

返回示例

```json
{
  "isValid": true,
  "license": {
    "company": "Bivrost",
    "product": "IoT Gateway",
    "machineCount": 255,
    "plcCount": 40,
    "robotCount": 60,
    "cncCount": 150,
    "laserCount": 5,
    "featureAppDNC": true,
    "licType": "Full",
    "uid": "XXXXXX-XXXXXX-XXXXXX-XXXXXX",
    "expiration": "2999-12-31T23:59:59"
  }
}
```

| 返回参数 | 类型 | 说明 |
|----------|------|------|
| isValid | Bool | (必需)许可是否有效，true=有效，false=无效。 |
| license | object | (必需)许可详情 |
| company | String | 授权该许可的公司名称。中性化版本不返回。 |
| product | String | (必需)许可对应的产品名称。 |
| machineCount | Int32 | (必需)许可总数。 |
| plcCount | Int32 | PLC 许可数。如不返回，PLC 许可数为许可总数。 |
| robotCount | Int32 | 机器人许可数。如不返回，机器人许可数为许可总数。 |
| cncCount | Int32 | CNC 许可数。如不返回，CNC 许可数为许可总数。 |
| laserCount | Int32 | 激光切割机许可数。如不返回，激光切割机许可数为许可总数。 |
| featureAppDNC | Bool | (必需)是否启用文件传输专业版，true=启用，false=不启用。 |
| licType | String | (必需)许可类型，Basic=基础版，Standard=标准版，Full=扩展版，DNC=DNC 版，PLC=PLC 版。 |
| uid | String | (必需)许可对应的网关 UID。 |
| expiration | String | (必需)截止有效期。 |

---

#### 2.10.1.3 service-status 获取服务状态

此接口获取包括云平台、MODBUS、MQTT、数据库、本地缓存等服务状态，此接口无请求参数。

| 方法 | URL |
|------|-----|
| GET | `/api/core/service-status` |

返回示例

```json
{
  "mqtt": 3,
  "queueSizeMqtt": 9,
  "modbus": 0,
  "queueSizeModbus": 0,
  "tbCloud": 0,
  "queueSizeTbCloud": 0,
  "localDB": 3,
  "queueSizeLocalDB": 0,
  "writeData": 2,
  "queueSizeWriteData": 0,
  "localDBLog": 0,
  "queueSizeLocalDBLog": 0,
  "hubBroadcasting": 2,
  "queueSizeHubBroadcasting": 0,
  "tbHubBroadcasting": 0,
  "queueSizeTbHubBroadcasting": 0,
  "needRestart": false
}
```

| 返回参数 | 类型 | 说明 |
|----------|------|------|
| mqtt | Int32 | (必需)MQTT 状态，参考表格 49 网关服务运行状态。 |
| queueSizeMqtt | Int32 | (必需)MQTT 队列长度 |
| modbus | Int32 | (必需)MODBUS 状态，参考表格 49 网关服务运行状态。 |
| queueSizeModbus | Int32 | (必需)MODBUS 队列长度 |
| tbCloud | Int32 | (必需)云平台状态，参考表格 49 网关服务运行状态。 |
| queueSizeTbCloud | Int32 | (必需)云平台队列长度 |
| localDB | Int32 | (必需)本地缓存状态，参考表格 49 网关服务运行状态。 |
| queueSizeLocalDB | Int32 | (必需)本地缓存队列长度 |
| writeData | Int32 | (必需)数据库状态，参考表格 49 网关服务运行状态。 |
| queueSizeWriteData | Int32 | (必需)数据库队列长度 |
| localDBLog | Int32 | (必需)日志数据库状态，参考表格 49 网关服务运行状态。 |
| queueSizeLocalDBLog | Int32 | (必需)日志数据库队列长度 |
| hubBroadcasting | Int32 | (必需)hub 广播状态，参考表格 49 网关服务运行状态。 |
| queueSizeHubBroadcasting | Int32 | (必需)hub 广播队列长度 |
| tbHubBroadcasting | Int32 | (必需)云平台广播状态，参考表格 49 网关服务运行状态。 |
| queueSizeTbHubBroadcasting | Int32 | (必需)云平台广播队列长度 |
| needRestart | Bool | (必需)需要重启服务以应用设置 |

---

#### 2.10.1.4 upload-license 上传网关许可

以字符串流的形式上传网关许可。

| 方法 | URL |
|------|-----|
| POST | `/api/core/upload-license` |

请求体示例

```json
{
  "Base64": "string"
}
```

> 网关许可文件应在上传前转换为 Base64 字符串格式，网关将使用 Base64 字符串格式读取文件内容。

返回示例

```json
{
  "errorCode": 0,
  "errorMsg": "Success"
}
```

| 返回参数 | 类型 | 说明 |
|----------|------|------|
| errorCode | Int32 | (必需)错误码，0 代表成功。 |
| errorMsg | String | (必需)错误内容 |

---

### 2.10.2 Gateway 服务功能接口

基地址 `/api/gateway`。

---

#### 2.10.2.1 alias 获取网关名称

此接口无请求参数。

| 方法 | URL |
|------|-----|
| GET | `/api/gateway/alias` |

返回示例

```json
{
  "alias": "iotgw"
}
```

| 返回参数 | 类型 | 说明 |
|----------|------|------|
| alias | String | (必需)网关名称 |

---

#### 2.10.2.2 update-alias 修改网关名称

此接口无请求参数。注：此修改在硬件重启后生效。

| 方法 | URL |
|------|-----|
| POST | `/api/gateway/update-alias` |

请求体示例 application/json

```json
{
  "alias": "newAlias"
}
```

| 请求参数 | 类型 | 说明 |
|----------|------|------|
| alias | String | (必需)网关名称 |

返回示例

```json
{
  "errorCode": 0,
  "errorMsg": "Success"
}
```

| 返回参数 | 类型 | 说明 |
|----------|------|------|
| errorCode | Int32 | (必需)错误码，0 代表成功。 |
| errorMsg | String | (必需)错误内容 |

---

#### 2.10.2.3 reboot 网关硬件重启

等效于在网关管理页面点击"电源"-"重启"按钮。此接口无请求参数。

| 方法 | URL |
|------|-----|
| GET | `/api/gateway/reboot` |

返回示例

```json
{
  "errorCode": 0,
  "errorMsg": "Success"
}
```

| 返回参数 | 类型 | 说明 |
|----------|------|------|
| errorCode | Int32 | (必需)错误码，0 代表成功。 |
| errorMsg | String | (必需)错误内容 |

---

#### 2.10.2.4 restart 重启所有服务

此接口用于重启 Core 服务与 Gateway 服务。此重启服务与网关主页的"重启服务"按键功能不同。此接口无请求参数。

| 方法 | URL |
|------|-----|
| GET | `/api/gateway/restart` |

返回示例

```json
{
  "errorCode": 0,
  "errorMsg": "Success"
}
```

| 返回参数 | 类型 | 说明 |
|----------|------|------|
| errorCode | Int32 | (必需)错误码，0 代表成功。 |
| errorMsg | String | (必需)错误内容 |

---

#### 2.10.2.5 restart-service 重启 Core 服务

用户修改了机台配置、机组配置、任务配置，或通讯配置后，需要使用此接口，等效于在网关主页点击"重启服务"按钮。此接口无请求参数。

| 方法 | URL |
|------|-----|
| GET | `/api/gateway/restart-service` |

返回示例

```json
{
  "errorCode": 0,
  "errorMsg": "Success"
}
```

| 返回参数 | 类型 | 说明 |
|----------|------|------|
| errorCode | Int32 | (必需)错误码，0 代表成功。 |
| errorMsg | String | (必需)错误内容 |

---

#### 2.10.2.6 shut-down 网关关机

等效于在网关管理页面点击"电源"-"关机"按钮。此接口无请求参数。

| 方法 | URL |
|------|-----|
| GET | `/api/gateway/shut-down` |

返回示例

```json
{
  "errorCode": 0,
  "errorMsg": "Success"
}
```

| 返回参数 | 类型 | 说明 |
|----------|------|------|
| errorCode | Int32 | (必需)错误码，0 代表成功。 |
| errorMsg | String | (必需)错误内容 |

---

#### 2.10.2.7 internet-connection 获取网关网络状态

获取网关与因特网的连接状态。此接口无请求参数。

| 方法 | URL |
|------|-----|
| GET | `/api/gateway/internet-connection` |

返回示例

```json
{
  "isOnline": true
}
```

| 返回参数 | 类型 | 说明 |
|----------|------|------|
| isOnline | Bool | (必需)是否联网，true=已连接，false=未连接。 |

---

#### 2.10.2.8 time 获取网关当前时间

此接口无请求参数。

| 方法 | URL |
|------|-----|
| GET | `/api/gateway/time` |

返回示例

```json
{
  "localTime": "2025-06-30T13:51:19.2864043+08:00"
}
```

| 返回参数 | 类型 | 说明 |
|----------|------|------|
| localTime | String | (必需)网关本地时间（ISO 8601） |

---

#### 2.10.2.9 sync-time 同步网关时间

| 方法 | URL |
|------|-----|
| GET | `/api/gateway/sync-time` |

| 请求参数 | 类型 | 说明 |
|----------|------|------|
| timeServerAddress | String | (必需)时间服务器地址，多个地址用";"分隔，网关会首先尝试与第一个地址同步时间，如失败，则尝试下一个地址，示例：`ntp1.aliyun.com;ntp2.aliyun.com;ntp3.aliyun.com;ntp4.aliyun.com;` |

返回示例

```json
{
  "errorCode": 0,
  "errorMsg": "Success"
}
```

| 返回参数 | 类型 | 说明 |
|----------|------|------|
| errorCode | Int32 | (必需)错误码，0 代表成功。 |
| errorMsg | String | (必需)错误内容 |

---

#### 2.10.2.10 time-zone 获取网关时区

此接口无请求参数。

| 方法 | URL |
|------|-----|
| GET | `/api/gateway/time-zone` |

返回示例

```json
{
  "timeZoneID": "China Standard Time"
}
```

| 返回参数 | 类型 | 说明 |
|----------|------|------|
| timeZoneID | String | (必需)网关时区（Microsoft Windows 时区 ID） |

---

#### 2.10.2.11 time-zones 获取时区选项

此接口无请求参数。

| 方法 | URL |
|------|-----|
| GET | `/api/gateway/time-zones` |

返回示例

```json
{
  "timeZoneIDs": [
    "Dateline Standard Time",
    "UTC-11",
    "Hawaiian Standard Time",
    "Aleutian Standard Time",
    ...
    "China Standard Time",
    ...
  ]
}
```

| 返回参数 | 类型 | 说明 |
|----------|------|------|
| timeZoneIDs | String[] | (必需)网关时区选项（Microsoft Windows 时区 ID） |

---

#### 2.10.2.12 update-time-zone 修改网关时区

| 方法 | URL |
|------|-----|
| POST | `/api/gateway/update-time-zone` |

请求体示例 application/json

```json
{
  "timeZoneID": "China Standard Time"
}
```

| 请求参数 | 类型 | 说明 |
|----------|------|------|
| timeZoneID | String | (必需)网关时区（Microsoft Windows 时区 ID），可通过 2.10.2.11 time-zones 获取时区选项获得可用选项。 |

返回示例

```json
{
  "errorCode": 0,
  "errorMsg": "Success"
}
```

| 返回参数 | 类型 | 说明 |
|----------|------|------|
| errorCode | Int32 | (必需)错误码，0 代表成功。 |
| errorMsg | String | (必需)错误内容 |

---

#### 2.10.2.13 network-adapters 获取网关网络适配器列表

此接口无请求参数。

| 方法 | URL |
|------|-----|
| GET | `/api/gateway/network-adapters` |

返回示例

```json
{
  "names": [
    "LAN1",
    "LAN2",
    "WLAN"
  ]
}
```

| 返回参数 | 类型 | 说明 |
|----------|------|------|
| names | String[] | (必需)网络适配器名称 |

---

#### 2.10.2.14 lan 获取有线网设置

| 方法 | URL |
|------|-----|
| GET | `/api/gateway/lan` |

| 请求参数 | 类型 | 说明 |
|----------|------|------|
| name | String | (必需)网络适配器名称，范围：LAN1 或 LAN2。 |

返回示例

```json
{
  "name": "LAN1",
  "macAddress": "00:E0:71:BC:D2:53",
  "state": "Disconnected",
  "isDHCPEnabled": false,
  "ipAddress": "192.168.100.1",
  "subMask": "255.255.0.0",
  "defaultGateway": "",
  "isDNSServerDHCPEnabled": false,
  "dnsServer1": "",
  "dnsServer2": ""
}
```

| 返回参数 | 类型 | 说明 |
|----------|------|------|
| name | String | (必需)网络适配器名称，范围：LAN1 或 LAN2。 |
| macAddress | String | (必需)物理地址 |
| state | String | (必需)状态，范围：Connected，Disconnected。 |
| isDHCPEnabled | Bool | (必需)自动获得 IP 地址 |
| ipAddress | String | (必需)IP 地址 |
| subMask | String | (必需)子网掩码 |
| defaultGateway | String | (必需)默认网关 |
| isDNSServerDHCPEnabled | Bool | (必需)自动获得 DNS 服务器地址 |
| dnsServer1 | String | (必需)首选 DNS 服务器 |
| dnsServer2 | String | (必需)备用 DNS 服务器 |

---

#### 2.10.2.15 update-lan 修改网关有线网设置

| 方法 | URL |
|------|-----|
| POST | `/api/gateway/update-lan` |

请求体示例 application/json

```json
{
  "name": "LAN1",
  "isDHCPEnabled": false,
  "ipAddress": "192.168.100.1",
  "subMask": "255.255.0.0",
  "defaultGateway": "",
  "isDNSServerDHCPEnabled": false,
  "dnsServer1": "",
  "dnsServer2": ""
}
```

| 请求参数 | 类型 | 说明 |
|----------|------|------|
| name | String | (必需)目标网络适配器名称，范围：LAN1 或 LAN2。 |
| isDHCPEnabled | Bool | 自动获得 IP 地址 |
| ipAddress | String | IP 地址 |
| subMask | String | 子网掩码 |
| defaultGateway | String | 默认网关 |
| isDNSServerDHCPEnabled | Bool | 自动获得 DNS 服务器地址 |
| dnsServer1 | String | 首选 DNS 服务器 |
| dnsServer2 | String | 备用 DNS 服务器 |

返回示例

```json
{
  "name": "LAN1",
  "macAddress": "00:E0:71:BC:D2:53",
  "state": "Disconnected",
  "isDHCPEnabled": false,
  "ipAddress": "192.168.100.1",
  "subMask": "255.255.0.0",
  "defaultGateway": "",
  "isDNSServerDHCPEnabled": false,
  "dnsServer1": "",
  "dnsServer2": ""
}
```

| 返回参数 | 类型 | 说明 |
|----------|------|------|
| name | String | (必需)网络适配器名称，范围：LAN1 或 LAN2。 |
| macAddress | String | (必需)物理地址 |
| state | String | (必需)状态，范围：Connected，Disconnected。 |
| isDHCPEnabled | Bool | (必需)自动获得 IP 地址 |
| ipAddress | String | (必需)IP 地址 |
| subMask | String | (必需)子网掩码 |
| defaultGateway | String | (必需)默认网关 |
| isDNSServerDHCPEnabled | Bool | (必需)自动获得 DNS 服务器地址 |
| dnsServer1 | String | (必需)首选 DNS 服务器 |
| dnsServer2 | String | (必需)备用 DNS 服务器 |

---

#### 2.10.2.16 wifi 获取无线网设置

此接口无请求参数。

| 方法 | URL |
|------|-----|
| GET | `/api/gateway/wifi` |

返回示例

```json
{
  "wifiName": "myWifi-5G",
  "signalStrength": 99,
  "macAddress": "00:A0:71:BD:E2:63",
  "state": "Connected",
  "isDHCPEnabled": true,
  "ipAddress": "192.168.1.88",
  "subMask": "255.255.255.0",
  "defaultGateway": "192.168.1.1",
  "isDNSServerDHCPEnabled": true,
  "dnsServer1": "192.168.211.1",
  "dnsServer2": "8.8.8.8"
}
```

| 返回参数 | 类型 | 说明 |
|----------|------|------|
| wifiName | String | (必需)无线网络 SSID |
| signalStrength | Int32 | 范围：0-100，越大信号越强 |
| macAddress | String | (必需)物理地址 |
| state | String | (必需)状态，范围：Connected，Disconnected。 |
| isDHCPEnabled | Bool | (必需)自动获得 IP 地址 |
| ipAddress | String | (必需)IP 地址 |
| subMask | String | (必需)子网掩码 |
| defaultGateway | String | (必需)默认网关 |
| isDNSServerDHCPEnabled | Bool | (必需)自动获得 DNS 服务器地址 |
| dnsServer1 | String | (必需)首选 DNS 服务器 |
| dnsServer2 | String | (必需)备用 DNS 服务器 |

---

#### 2.10.2.17 update-wifi 修改无线网设置

| 方法 | URL |
|------|-----|
| POST | `/api/gateway/update-wifi` |

请求体示例 application/json

```json
{
  "isDHCPEnabled": true,
  "ipAddress": "192.168.1.88",
  "subMask": "255.255.255.0",
  "defaultGateway": "192.168.1.1",
  "isDNSServerDHCPEnabled": true,
  "dnsServer1": "192.168.211.1",
  "dnsServer2": "8.8.8.8"
}
```

| 请求参数 | 类型 | 说明 |
|----------|------|------|
| isDHCPEnabled | Bool | 自动获得 IP 地址 |
| ipAddress | String | IP 地址 |
| subMask | String | 子网掩码 |
| defaultGateway | String | 默认网关 |
| isDNSServerDHCPEnabled | Bool | 自动获得 DNS 服务器地址 |
| dnsServer1 | String | 首选 DNS 服务器 |
| dnsServer2 | String | 备用 DNS 服务器 |

返回示例

```json
{
  "wifiName": "myWifi-5G",
  "signalStrength": 99,
  "macAddress": "00:A0:71:BD:E2:63",
  "state": "Connected",
  "isDHCPEnabled": true,
  "ipAddress": "192.168.1.88",
  "subMask": "255.255.255.0",
  "defaultGateway": "192.168.1.1",
  "isDNSServerDHCPEnabled": true,
  "dnsServer1": "192.168.211.1",
  "dnsServer2": "8.8.8.8"
}
```

| 返回参数 | 类型 | 说明 |
|----------|------|------|
| wifiName | String | (必需)无线网络 SSID |
| signalStrength | Int32 | 范围：0-100，越大信号越强 |
| macAddress | String | (必需)物理地址 |
| state | String | (必需)状态，范围：Connected，Disconnected。 |
| isDHCPEnabled | Bool | (必需)自动获得 IP 地址 |
| ipAddress | String | (必需)IP 地址 |
| subMask | String | (必需)子网掩码 |
| defaultGateway | String | (必需)默认网关 |
| isDNSServerDHCPEnabled | Bool | (必需)自动获得 DNS 服务器地址 |
| dnsServer1 | String | (必需)首选 DNS 服务器 |
| dnsServer2 | String | (必需)备用 DNS 服务器 |

---

#### 2.10.2.18 search-wifi 搜索无线网

此接口无请求参数。

| 方法 | URL |
|------|-----|
| GET | `/api/gateway/search-wifi` |

返回示例

```json
[
  {
    "wifiName": "myWifi-5G",
    "signalStrength": 99,
    "state": "Connected"
  },
  {
    "wifiName": "myWifi-2.4G",
    "signalStrength": 99,
    "state": "Disconnected"
  }
]
```

| 返回参数 | 类型 | 说明 |
|----------|------|------|
| wifiName | String | (必需)无线网络 SSID |
| signalStrength | Int32 | 范围：0-100，越大信号越强 |
| state | String | (必需)状态，范围：Connected，Disconnected。 |

---

#### 2.10.2.19 connect-wifi 连接无线网

| 方法 | URL |
|------|-----|
| GET | `/api/gateway/connect-wifi` |

| 请求参数 | 类型 | 说明 |
|----------|------|------|
| wifiName | String | (必需)目标无线网络 SSID |
| wifiPassword | String | 目标无线网络密码 |

返回示例

```json
{
  "errorCode": 0,
  "errorMsg": "Success"
}
```

| 返回参数 | 类型 | 说明 |
|----------|------|------|
| errorCode | Int32 | (必需)错误码，0 代表成功。 |
| errorMsg | String | (必需)错误内容 |

---

#### 2.10.2.20 disconnect-wifi 断开无线网

此接口无请求参数。

| 方法 | URL |
|------|-----|
| GET | `/api/gateway/disconnect-wifi` |

返回示例

```json
{
  "errorCode": 0,
  "errorMsg": "Success"
}
```

| 返回参数 | 类型 | 说明 |
|----------|------|------|
| errorCode | Int32 | (必需)错误码，0 代表成功。 |
| errorMsg | String | (必需)错误内容 |

---

#### 2.10.2.21 static-routing 获取静态路由设置

此接口无请求参数。

| 方法 | URL |
|------|-----|
| GET | `/api/gateway/static-routing` |

返回示例

```json
{
  "staticRouting": "0.0.0.0, 0.0.0.0, 192.168.100.1;"
}
```

| 返回参数 | 类型 | 说明 |
|----------|------|------|
| staticRouting | Int32 | (必需)静态路由。 |

---

#### 2.10.2.22 update-static-routing 修改静态路由设置

| 方法 | URL |
|------|-----|
| POST | `/api/gateway/update-static-routing` |

请求体示例 application/json

```json
{
  "staticRouting": "0.0.0.0, 0.0.0.0, 192.168.100.1;"
}
```

| 请求参数 | 类型 | 说明 |
|----------|------|------|
| staticRouting | Int32 | (必需)静态路由。 |

返回示例

```json
{
  "staticRouting": "0.0.0.0, 0.0.0.0, 192.168.100.1;"
}
```

| 返回参数 | 类型 | 说明 |
|----------|------|------|
| staticRouting | Int32 | (必需)静态路由。 |

---

#### 2.10.2.23 connect-remote-host 连接远程服务器

此接口无请求参数。

| 方法 | URL |
|------|-----|
| GET | `/api/gateway/connect-remote-host` |

返回示例

```json
{
  "errorCode": 0,
  "errorMsg": "Success"
}
```

| 返回参数 | 类型 | 说明 |
|----------|------|------|
| errorCode | Int32 | (必需)错误码，0 代表成功。 |
| errorMsg | String | (必需)错误内容 |

---

#### 2.10.2.24 disconnect-remote-host 断开远程服务器

此接口无请求参数。

| 方法 | URL |
|------|-----|
| GET | `/api/gateway/disconnect-remote-host` |

返回示例

```json
{
  "errorCode": 0,
  "errorMsg": "Success"
}
```

| 返回参数 | 类型 | 说明 |
|----------|------|------|
| errorCode | Int32 | (必需)错误码，0 代表成功。 |
| errorMsg | String | (必需)错误内容 |

---

#### 2.10.2.25 file-server-items 获取网关文件服务器列表

获取网关文件服务器根目录下的文件与子目录列表。子目录与机台对应，名称为机台的 IP 地址。此接口无请求参数。

| 方法 | URL |
|------|-----|
| GET | `/api/gateway/file-server-items` |

返回示例

```json
{
  "totalSpace": "10.00 GB",
  "usedSpace": "120 B",
  "files": [],
  "subDirs": [
    {
      "name": "127.0.0.1",
      "size": "20 B",
      "machineName": "1",
      "machineID": "1",
      "ip": "127.0.0.1",
      "status": "Activated"
    },
    {
      "name": "127.0.0.2",
      "size": "100 B",
      "machineName": "2",
      "machineID": "2",
      "ip": "127.0.0.2",
      "status": "Activated"
    }
  ]
}
```

| 返回参数 | 类型 | 说明 |
|----------|------|------|
| totalSpace | String | (必需)总空间 |
| usedSpace | String | (必需)已使用空间 |
| files | Object[] | (必需)根目录下的文件列表，一般为空。 |
| subDirs | Object[] | (必需)根目录下的子目录列表。 |
| name | String | 文件/目录名 |
| size | String | 文件/目录大小 |
| machineName | String | 关联机台名称 |
| machineID | String | 关联机台标识 |
| ip | String | 关联机台 ip |
| status | String | 状态，范围 Unlinked（未关联），Activated（已激活），Unactivated（未激活）。 |

---

#### 2.10.2.26 delete-file-server-item 删除网关文件服务器项目

删除根目录下指定文件或子目录。

| 方法 | URL |
|------|-----|
| GET | `/api/gateway/delete-file-server-item` |

| 请求参数 | 类型 | 说明 |
|----------|------|------|
| fileName | String | 文件名 |
| dirName | String | 子目录名 |

返回示例

```json
{
  "errorCode": 0,
  "errorMsg": "Success"
}
```

| 返回参数 | 类型 | 说明 |
|----------|------|------|
| errorCode | Int32 | (必需)错误码，0 代表成功。 |
| errorMsg | String | (必需)错误内容 |

---

## 三、MODBUS 通讯

启用 MODBUS 通讯，并开启目标机台/机组的自动采集任务（详见《说明书》5.3.1. 添加机台下的各类型机台的任务设置，以及 5.4.1.2. 机组任务设置）后，网关会基于 MODBUS 协议，将自动采集任务结果数据存在相应地址中。MODBUS 通讯地址为\<网关 IP\>，端口为 502。使用 MODBUS 通讯，机床最后一段 IP 作为从站 ID 区分。如机床 IP 为 192.168.100.2，该机床对应从站 ID 为 2。使用 MODBUS 时，机床最后一段 IP 不可设置为 0（0 为网关保留从站），且同一网关下连接的各机床 IP 最后一段必须各不相同，否则会出现数据识别别错误。用户可以参照《说明书》5.6.2.MODBUS 配置的说明配置 MODBUS 服务。

**注：网关 MODBUS 服务端地址位设置基于 0 位，客户端如基于 1 位时相应地址位需要加 1。**

---

### 3.1 机台相关数据

MODBUS 数据地址如下：

| 地址 | 名称 | 数据类型 | 单位 | 备注 |
|------|------|----------|------|------|
| 400010 | 连接状态 | UInt16 | – | 1=已连接；2=未连接；3=错误 |
| 400011 | 报警数 | UInt16 | 条 | 当前报警数量 |
| 400012 | CNC 运行状态 | Int16 | – | 当前运行状态码，详见 5.1. 机台状态 |
| 400013 | 累计警报数 | UInt32 | 条 | |
| 400015 | 累计警报时间 | UInt32 | 秒 | |
| 400040~400075 | 第 1 至第 18 轴名称 | String(4) | – | 以 MODBUS 配置中设定的编码转换为长度为 4 的 Byte 数组（2 个地址位）。 |
| 400100 | 加工计数 | UInt32 | 件 | 从机台系统获取的加工计数 |
| 400102 | 主轴倍率 | Float | % | 主轴转速倍率 |
| 400104 | 主轴转速 | Float | 同机床设置 | 进给量倍率 |
| 400106 | 进给倍率 | Float | % | |
| 400108 | 进给速度 | Float | 同机床设置 | |
| 400110~400115 | 第 1 至第 3 主轴负载 | Float | % | |
| 400120 | 快速进给倍率 | Float | % | |
| 400172 | 累计通电时间 1 | Int32 | 分钟 | 时间计算方式详见 1.2.25.ToolLife：刀具寿命数据。如时间数值为 -2147483648，代表机床系统型号不支持该时间数据。 |
| 400174 | 累计通电时间 2 | Int32 | 毫秒 | |
| 400176 | 当前通电时间 1 | Int32 | 分钟 | |
| 400178 | 当前通电时间 2 | Int32 | 毫秒 | |
| 400180 | 累计运行时间 1 | Int32 | 分钟 | |
| 400182 | 累计运行时间 2 | Int32 | 毫秒 | |
| 400184 | 当前运行时间 1 | Int32 | 分钟 | |
| 400186 | 当前运行时间 2 | Int32 | 毫秒 | |
| 400188 | 累计加工时间 1 | Int32 | 分钟 | |
| 400190 | 累计加工时间 2 | Int32 | 毫秒 | |
| 400192 | 当前加工时间 1 | Int32 | 分钟 | |
| 400194 | 当前加工时间 2 | Int32 | 毫秒 | |
| 400196 | 上次循环时间 1 | Int32 | 分钟 | |
| 400198 | 上次循环时间 2 | Int32 | 毫秒 | |
| 400200 | 当前循环时间 1 | Int32 | 分钟 | |
| 400202 | 当前循环时间 2 | Int32 | 毫秒 | |
| 400204 | 当前切削时间 1 | Int32 | 分钟 | |
| 400206 | 当前切削时间 2 | Int32 | 毫秒 | |
| 400208 | 剩余循环时间 1 | Int32 | 分钟 | |
| 400210 | 剩余循环时间 2 | Int32 | 毫秒 | |
| 400220 | 当前刀号 | String(16) | – | 以 MODBUS 配置中设定的编码转换为长度为 16 的 Byte 数组（8 个地址位）。 |
| 400228 | 运行程序名 | String(32) | – | 当前执行子程序名 |
| 400244 | 主程序名 | String(32) | – | 当前主程序名 |
| 400260 | 运行程序段顺序号 | String(16) | – | 当前执行子程序段顺序号 |
| 400268 | 当前程序段 | String(70) | – | 当前运行的程序段内容 |
| 400498 | 当前加工计数 | UInt32 | 件 | 当前监控时间内的加工计数 |
| 400500 | 累计加工计数 | UInt32 | 件 | |
| 400502 | 关机时间 | UInt32 | 秒 | |
| 400504 | 急停时间 | UInt32 | 秒 | |
| 400506 | 待机时间 | UInt32 | 秒 | |
| 400508 | 自动运行时间 | UInt32 | 秒 | |
| 400510 | 调机时间 | UInt32 | 秒 | |
| 400512 | 机台监控开动率 | Float | % | |
| 400520 | 累计关机时间 | UInt32 | 秒 | |
| 400522 | 累计急停时间 | UInt32 | 秒 | |
| 400524 | 累计待机时间 | UInt32 | 秒 | |
| 400526 | 累计自动运行时间 | UInt32 | 秒 | |
| 400528 | 累计调机时间 | UInt32 | 秒 | |
| 400546 | 上次节拍时间 | UInt32 | 秒 | |
| 400600 | 程序堆栈 | String(128) | – | 以 MODBUS 配置中设定的编码转换为长度为 128 的 Byte 数组（64 个地址位）。 |
| 400664 | 当前刀补号 | String(16) | – | |
| 400900 | 预设功率 | Float | % | 激光切割机预设功率 |
| 400902 | 实际功率 | Float | % | 激光切割机实际功率 |
| 401100~401135 | 第 1 至第 18 轴负载 | Float | % | |
| 401136~401171 | 第 1 至第 18 轴机械坐标 | Float | 同机床设置 | |
| 401172~401207 | 第 1 至第 18 轴相对坐标 | Float | 同机床设置 | |
| 401208~401243 | 第 1 至第 18 轴剩余距离 | Float | 同机床设置 | |
| 401244~401279 | 第 1 至第 18 轴绝对坐标 | Float | 同机床设置 | |
| 401400~401405 | 第 1 至第 3 主轴累计过载时间 | UInt32 | 毫秒 | |
| 401410~401445 | 第 1 至第 18 轴累计过载时间 | UInt32 | 毫秒 | |
| 405000 | 警报 1 | String(200) | – | 含警报内容，时间，级别 |
| 405100 | 警报 2 | String(200) | – | 同上 |
| 405200 | 警报 3 | String(200) | – | 同上 |
| 405300 | 警报 4 | String(200) | – | 同上 |
| 405400 | 警报 5 | String(200) | – | 同上 |
| 420000~429999 | 第 1 至 10000 位 PLC 数据 | UInt16 | – | PLC 任务数据与外部 PLC 任务数据，PLC 任务数据在前，外部 PLC 任务数据在后，按照任务顺序排列。32 位型数据，64 位型数据，String 类型数据，以 MODBUS 配置中设定的方式转换为 UInt16。 |

**注 1：** 累计警报数与累计加工计数为自从网关开始自动采集这台设备，累计的警报数与加工计数。这两个值保存在网关中，与 machineID（即机床 IP 后两段）绑定，不会被重置。

**注 2：** 400502-400510 各机台状态时间是机台在监控时间内的各状态时间。400512 机台开动率是机台在监控时间内的开动率。详见《说明书》6.1.1. 机台 OEE 数据。

**注 3：** String(200)表示这个 String 以设置的编码（详见《说明书》5.6.2.MODBUS 配置）转换为长度为 200 的 Byte 数组，换算成 MODBUS 地址位（UInt16）为 100 个地址位。

**注 4：** 上次节拍时间由网关机台节拍数据任务监测。如网关重启后第一个节拍尚未结束，此数值为 0。上次节拍时间定义上与上次循环时间相同，但前者由网关统计，所有可统计产量与状态的机台都支持。后者由机台本身提供，只有部分机台支持。

---

### 3.2 机组相关数据

机组相关数据统一保存于从站 0 中，数据地址如下：

| 地址 | 名称 | 数据类型 | 单位 | 备注 |
|------|------|----------|------|------|
| 400100 | 机组 1 累计加工计数 | UInt32 | 件 | |
| 400102 | 当前机组 1 中关机机台数量 | Int16 | 台 | |
| 400103 | 当前机组 1 中急停机台数量 | Int16 | 台 | |
| 400104 | 当前机组 1 中待机机台数量 | Int16 | 台 | |
| 400105 | 当前机组 1 中自动运行机台数量 | Int16 | 台 | |
| 400106 | 当前机组 1 中调机机台数量 | Int16 | 台 | |
| 400110 | 机组 1 关机时间 | UInt32 | 秒 | |
| 400112 | 机组 1 急停时间 | UInt32 | 秒 | |
| 400114 | 机组 1 待机时间 | UInt32 | 秒 | |
| 400116 | 机组 1 自动运行时间 | UInt32 | 秒 | |
| 400118 | 机组 1 调机时间 | UInt32 | 秒 | |
| 400120 | 机组 1 监控开动率 | Float | % | |
| 400130 | 机组 1 累计关机时间 | UInt32 | 秒 | |
| 400132 | 机组 1 累计急停时间 | UInt32 | 秒 | |
| 400134 | 机组 1 累计待机时间 | UInt32 | 秒 | |
| 400136 | 机组 1 累计自动运行时间 | UInt32 | 秒 | |
| 400138 | 机组 1 累计调机时间 | UInt32 | 秒 | |
| 400200~400299 | 机组 2（相应地址为组 1 对应名称地址加 100） | | | |
| …… | | | | |
| 401600~401699 | 机组 16（相应地址为组 1 对应名称地址加 1500） | | | |

**注 1：** 400100 机组累计加工计数为自从网关开始自动采集这组设备，累计的加工机数。详见《说明书》6.1.3. 机组加工计数。

**注 2：** 400110-400118 机组各状态时间是机组中所有激活状态的机台在监控时间内的各状态时间之和。400120 机组监控开动率是机组在监控时间内的机组开动率。详见《说明书》6.1.2. 机组 OEE 数据。

---

## 四、MQTT 通讯

启用 MQTT 通讯，并开启目标机台/机组的自动采集任务（详见《说明书》5.3.1. 添加机台下的各类型机台的任务设置，以及 5.4.1.2. 机组任务设置）后，网关会基于 MQTT 协议，将自动采集任务结果数据转化成 JSON 格式的报文，并发布至指定 MQTT 服务器，数据上报的报文默认主题为"r"。网关也支持 RPC 接口。用户可以参照《说明书》5.6.3.MQTT 配置的说明配置 MQTT 服务。

---

### 4.1 数据上报报文格式

网关 MQTT 协议数据上报的报文支持多种模式，包括 Default, MKT, TB, TB2, Brm, IoTDA, WisIoT 等。

报文内容结构如下：

| 模式 | 数据上报报文格式 |
|------|----------------|
| Default | `{ "type": <type>, "unixtimestamp": <time>, "data": { "<field>": <value> }, "<tag>": <value>, "<entityID>": <value> }` |
| MKT | `{ "unixtimestamp": <time>, "<entityID>_<fieldID>_<field>": <value> }` |
| TB | `{ "<alias>": [ { "ts": <time>, "values": { "<fieldID>_<field>": <value> } } ] }` |
| TB2 | `{ "<machineID>": [ { "ts": <time>, "values": { "<fieldID>_<field>": <value> } } ] }` |
| Brm | `[ { "type": <type>, "ts": <time>, "data": { "<field>": <value> }, "<tag>": <value>, "<entityID>": <value> } ]` |
| IoTDA | `{ "devices": [ { "device_id": <entityID>, "services": [ { "service_id": <type>, "properties": { "<tagField>_<field>": <value> }, "event_time": <time> } ] } ] }` |
| WisIoT | `{ "properties": [ { "key": <entityID>_<fieldID>_<field>, "name": <fieldID>_<field>, "value": <value>, "time": <time> } ] }` |

#### 重要概念

1. **`<entityID>`** — 机台或机组标识：如当前数据属于机台数据时，`<entityID>` 为机台标识 machineID；如当前数据属于机组数据时，`<entityID>` 为机组标识 groupID。machineID 与 groupID 见 1.1 基本说明。

2. **`<alias>`** — 机台或机组名称：用户自定义的机台名称或机组名称（详见《说明书》5.3.1. 添加机台、5.4.1. 添加机组）。

3. **`<type>`** 类、**`<field>`** 字段与 **`<tag>`** 标签：一个**类**包含至少一个**字段**和不定数量的**标签**。**字段**是数据的名称。当某**类**不能仅以机台或机组进行区分时，我们需要为此数据种类添加**标签**。例如，类 SpindleOverload（主轴过载数据）包含**字段** CumulativeTime（累计过载时间），和**标签** SpindleNo（主轴号）。

4. **`<tagField>`** — 标签的字段形式，由**标签**缩写与**标签值**组成。如 S1 是 SpindleNo=1 的字段形式。

5. **`<fieldID>`** — 字段标识：若**类**中不包含**标签**，则**字段标识**与**类**一致。若**类**包含**标签**，则**字段标识**由**类**和**标签的字段形式**构成。**类**和多个**标签的字段形式**间由下划线隔开。**标签**在字段形式中的顺序由下文中**标签**的序号决定。例如，**字段标识** SpindleOverload_S1 表示第一主轴的过载数据，其中 S1 是 SpindleNo=1 的字段形式；**字段标识** ToolLife_G1_I2 表示刀组 1 中第 2 把刀的寿命数据，其中 G1_I2 是 GroupNum=1;Index=2 的字段形式。

6. **`<time>`** — 时间戳：表示任务执行时的时间，单位是毫秒。

7. **`<value>`** — 数值：数值或内容。

8. Default 和 MKT 模式，每条报文仅含来自同一机台或机组 `<entityID>` 的同一数据类 `<type>` 的数据。TB, TB2, IoTDA, Brm, WisIoT 等模式，支持把来自不同机台或机组 `<entityID>` 的不同数据类 `<type>` 的数据合并到一条报文中。

---

#### 报文示例

##### 示例 1（Default 模式）

```json
{
  "type": "CNCStatus",
  "unixtimestamp": 1698908463135,
  "data": {
    "cncStatus": "MANUAL",
    "alarmStatus": "NO_ALARM"
  },
  "machineID": "10"
}
```

- `"type": "CNCStatus"` — 数据类，用"CNCStatus"作为关键词，可以在 1.2 数据说明中找到 1.2.4.CNCStatus: 机台状态，识别本条报文中的数据为机台状态数据。
- `"unixtimestamp": 1698908463135` — 时间戳，即此条报文的时间戳。
- `"data": { "cncStatus": "MANUAL", "alarmStatus": "NO_ALARM" }` — 数据内容，可通过 `<type>` 申明的数据类查找对应内容的解释说明。
- `"machineID": "10"` — `<entityID>` 机台或机组标识，第 8 行内容代表这条报文的数据来自机台标识为 10 的机台。

##### 示例 2（Default 模式）

```json
{
  "type": "GroupCount",
  "unixtimestamp": 1698911434710,
  "data": {
    "cumulativeCount": 233
  },
  "groupID": 1
}
```

- `"type": "GroupCount"` — 数据类，用"GroupCount"作为关键词，可以在 1.2.11.GroupCount: 机组加工计数数据中找到，`"cumulativeCount"` 是数据 GroupCount 下的字段，代表机组累计加工计数。
- `"groupID": 1` — `<entityID>` 此处为 groupID 机组标识，代表这条报文的数据来自 1 号机组。

##### 示例 3（Default 模式）

```json
{
  "type": "ToolLife",
  "unixtimestamp": 1698908397751,
  "data": {
    "timeLimit": 1800,
    "currentTime": 1620,
    "prewarningTime": 1680
  },
  "toolNum": 9,
  "toolOffsetNum": 2,
  "machineID": "10"
}
```

- `"type": "ToolLife"` — 数据类，用"ToolLife"作为关键词，可以在 1.2.27.ToolLife: 刀具寿命数据中找到。
- `"data"` — `"timeLimit"` 是寿命极限[秒]，`"currentTime"` 是当前寿命[秒]，`"prewarningTime"` 是预警寿命[秒]。
- `"toolNum": 9, "toolOffsetNum": 2` — 这两行内容代表这条报文的刀补数据属于 9 号刀 2 号刀补。

##### 示例 4（MKT 模式）

```json
{
  "unixtimestamp": 1698908397751,
  "10_ToolLife_T9_02_timeLimit": 1800,
  "10_ToolLife_T9_02_currentTime": 1620,
  "10_ToolLife_T9_02_prewarningTime": 1680
}
```

- `"10_ToolLife_T9_02_timeLimit": 1800` — 格式为 `<entityID>_<fieldID>_<field>`: `<value>`
  - 10 是 `<entityID>` 机台标识
  - ToolLife_T9_02 是 `<fieldID>` 数据字段标识（ToolLife 是 `<type>`，T9_02 是标签字段形式，T 是 toolNum 缩写，O 是 toolOffsetNum 缩写）
  - timeLimit 是 `<field>` 字段（寿命极限[秒]）

##### 示例 5（TB 模式）

```json
{
  "机台 10": [
    {
      "ts": 1698908397751,
      "values": {
        "ToolLife_T9_02_timeLimit": 1800,
        "ToolLife_T9_02_currentTime": 1620,
        "ToolLife_T9_02_prewarningTime": 1680
      }
    }
  ]
}
```

- `"机台 10"` — `<alias>` 机台或机组名称，由用户在网关机台配置页添加/编辑机台（机组）窗口设置，如未设置，则默认 alias 与 entityID 机台或机组标识相同。
- `"values"` 中 `"ToolLife_T9_02_timeLimit": 1800` — 格式为 `<fieldID>_<field>`: `<value>`，ToolLife_T9_02 是 `<fieldID>`，timeLimit 是 `<field>`。

##### 示例 6（IoTDA 模式）

```json
{
  "devices": [
    {
      "device_id": "10",
      "services": [
        {
          "service_id": "ToolLife",
          "properties": {
            "T9_02_timeLimit": 1800,
            "T9_02_currentTime": 1620,
            "T9_02_prewarningTime": 1680
          },
          "event_time": 1698908397751
        }
      ]
    }
  ]
}
```

- `"device_id": "10"` — 格式为 `"device_id": <entityID>`，此处为 machineID 机台标识。
- `"service_id": "ToolLife"` — 格式为 `"service_id": <type>`，用"ToolLife"作为关键词，识别本条报文中的数据为刀具寿命数据。
- `"T9_02_timeLimit": 1800` — T9_02 是 `<tagField>` 标签的字段形式，T 是 toolNum 刀号的缩写，0 是 toolOffsetNum 刀补号的缩写；timeLimit 是 `<field>` 字段（寿命极限[秒]）。
- `"event_time": 1698908397751` — 格式为 `"event_time": <time>`，数值 1698908397751 即此条报文的时间戳。

---

### 4.2 RPC 接口

网关支持基于 MQTT 协议的 RPC 接口，用户必须在网关管理页面设定 RPC 请求主题和 RPC 回复主题，详见《说明书》5.6.3.MQTT 配置。设定完成后网关会监听 RPC 请求主题，并将 RPC 请求的结果发布至 RPC 回复主题。RPC 接口数据编码为 MQTT 配置中设定的编码。

如果需要在主题中嵌入 RPC 请求的标识，可在需要嵌入标识的位置使用通配符 `${request_id}` 表示。

例如：
- RPC 请求主题：`request/${request_id}`
- RPC 回复主题：`response/${request_id}`

按照此设置，当网关收到 `request/24` 的请求时，网关会将执行结果发布至主题 `response/24`。

> **注意：** `${request_id}` 的位置建议放在主题的尾部。如果需要把 `${request_id}` 位置放于主题中间，`${request_id}` 前必须有"/"作为分隔符。

网关 MQTT 协议支持多种报文模式，包括 Default, MKT, Brm, TB, TB2 等。

#### RPC 请求报文格式

| 模式 | RPC 请求报文格式 |
|------|----------------|
| Default/MKT/Brm | `{ "id": <request_id>, "method": "<method>", "params": <params> }` |
| TB/TB2 | `{ "device": "<deviceName>", "data": { "id": "<request_id>", "method": "<method>", "params": <params> } }` |
| WisIoT/IoTDA | 暂不支持 |

#### RPC 回复报文格式

| 模式 | RPC 回复报文格式 |
|------|----------------|
| Default/MKT/Brm | `{ "id": <request_id>, "data": <response> }` |
| TB/TB2 | `{ "device": "<deviceName>", "id": <request_id>, "data": <response> }` |
| WisIoT/IoTDA | 暂不支持 |

其中 `<response>` 为 RPC 命令的返回结果；`<deviceName>` 为机台名称；`<request_id>` 为自定义请求标识。注意在 TB 模式下，`<params>` 中的参数"machineID"无需输入，机台将由 `<deviceName>` 指定。

---

#### 支持的 RPC 命令

除了鉴权接口，和部分文件管理接口，RPC 命令与二、HTTP 通讯中对应的接口一一对应，输入参数与返回结果可参照二、HTTP 通讯中的接口说明。

| RPC 命令 | 说明 |
|----------|------|
| **数据读写接口—直接读写，前缀 /cnc/** | |
| readAlarm | 读取警报信息 |
| readCNCStatus | 读取机台状态 |
| readCNCStatusDetails | 读取机台状态详情 |
| readCount | 读取加工计数 |
| readCurrentToolNumber | 读取当前刀号 |
| readEnergyConsumption | 读取能耗数据 |
| readFeed | 读取进给数据 |
| readFeedAndSpindle | 读取进给转速数据 |
| readLaserPower | 读取激光功率 |
| readLoad | 读取负载数据 |
| readLog | 读取日志信息 |
| readOffsetData | 读取刀补数据 |
| batchReadOffsetData | 批量读取刀具补偿 |
| writeOffsetData | 写入刀补数据 |
| readPosition | 读取坐标数据 |
| readProgramBlock | 读取当前程序段 |
| readProgramInfo | 读取当前程序 |
| readPlcData | 读取 PLC 数据 |
| writePlcData | 写入 PLC 数据 |
| readTimeData | 读取机台时间数据 |
| readToolLife | 读取刀具寿命 |
| batchReadToolLife | 批量读取刀具寿命 |
| readToolLifeDetails | 读取刀具寿命详情 |
| batchReadToolLifeDetails | 批量读取刀具寿命详情 |
| **数据读写接口—缓存读取，前缀 /cnc/** | |
| readTaskData | 读取机台任务数据 |
| batchReadTaskData | 批量读取机台任务数据 |
| readGroupTaskData | 读取机组任务数据 |
| batchReadGroupTaskData | 批量读取机组任务数据 |
| batchReadErrors | 批量读取机台连接状态 |
| readErrorSummary | 读取状态简报 |
| **文件管理接口，前缀 /cnc/** | |
| readProgramList | 读取机台文件列表 |
| receiveFile | 接收机台文件 |
| readCurrentProgram | 接收机台当前运行的文件 |
| sendFile | 发送文件至机台 |
| batchSendFile | 批量发送文件至机台 |
| deleteFile | 删除机台文件 |
| lockFileByRange | 锁定/解锁机台程序编辑 |
| createDir | 创建机台目录 |
| deleteDir | 删除机台目录 |
| selectProgram | 选择程序 |
| readAllPrograms | 浏览所有文件 |
| searchFile | 搜索机台文件 |
| **机台数据分析接口，前缀 /analysis/** | |
| oee | 机台 OEE 数据分析 |
| alarm | 机台警报数据分析 |
| count | 机台计数数据分析 |
| overall | 机台综合数据分析 |
| cycle | 机台节拍数据分析 |
| **机组数据分析接口，前缀 /group-analysis/** | |
| oee | 机组 OEE 数据分析 |
| alarm | 机组警报数据分析 |
| count | 机组计数数据分析 |
| overall | 机组综合数据分析 |
| cycle | 机组节拍数据分析 |
| **历史数据接口，前缀 /db/** | |
| machine | 机台历史数据 |
| group-machine | 机组内所有机台历史数据 |
| query | 查询历史数据 |
| **全局配置接口，前缀 /config/** | |
| gateway-info | 获取网关信息 |
| settings | 获取网关全局设置 |
| update-settings | 修改网关全局设置 |
| security | 获取网关全局安全设置 |
| update-security | 修改网关全局安全设置 |
| **用户配置接口，前缀 /config/** | |
| user | 获取用户设置 |
| users | 获取所有用户设置 |
| create-user | 创建新用户 |
| update-user | 修改用户设置 |
| delete-user | 删除用户 |
| user-security | 获取用户安全设置 |
| update-user-security | 修改用户安全设置 |
| **机台配置接口，前缀 /config/** | |
| machine | 获取机台配置 |
| machines | 获取所有机台配置 |
| create-machine | 添加机台配置 |
| update-machine | 修改机台配置 |
| delete-machine | 删除机台配置 |
| batch-delete-machine | 批量删除机台配置 |
| **机组配置接口，前缀 /config/** | |
| group | 获取机组配置 |
| groups | 获取所有机组配置 |
| create-group | 添加机组配置 |
| update-group | 修改机组配置 |
| delete-group | 删除机组配置 |
| batch-delete-group | 批量删除机组配置 |
| **任务配置接口，前缀 /config/** | |
| machine-task-interval-settings | 获取机台任务间隔设置 |
| update-machine-task-interval-settings | 修改机台任务间隔设置 |
| group-task-interval-settings | 获取机组任务间隔设置 |
| update-group-task-interval-settings | 修改机组任务间隔设置 |
| oee-monitoring-settings | 获取 OEE 监控设置 |
| update-oee-monitoring-settings | 修改 OEE 监控设置 |
| tool-life-monitoring-settings | 获取刀具寿命监控设置 |
| update-oee-monitoring-settings | 修改刀具寿命监控设置 |
| count-monitoring-settings | 获取加工计数监控设置 |
| update-count-monitoring-settings | 修改加工计数监控设置 |
| overload-monitoring-settings | 获取过载监控设置 |
| update-overload-monitoring-settings | 修改过载监控设置 |
| alarm-monitoring-settings | 获取警报监控设置 |
| update-alarm-monitoring-settings | 修改警报监控设置 |
| machine-status-monitoring-settings | 获取机台状态监控设置 |
| update-machine-status-monitoring-settings | 修改机台状态监控设置 |
| **通讯配置接口，前缀 /config/** | |
| cloud-settings | 获取云平台设置 |
| update-cloud-settings | 修改云平台设置 |
| modbus-settings | 获取 MODBUS 设置 |
| update-modbus-settings | 修改 MODBUS 设置 |
| mqtt-settings | 获取 MQTT 设置 |
| update-mqtt-settings | 修改 MQTT 设置 |
| database-settings | 获取数据库设置 |
| update-database-settings | 修改数据库设置 |
| gateway-file-server-settings | 获取网关文件服务器设置 |
| update-gateway-file-server-settings | 修改网关服务器设置 |
| http-settings | 获取 HTTP 设置 |
| update-http-settings | 修改 HTTP 设置 |
| hub-settings | 获取 Hub 设置 |
| update-hub-settings | 修改 Hub 设置 |
| remote-access | 获取远程访问设置 |
| update-remote-access | 修改远程访问设置 |
| **Core 服务功能接口，前缀 /core/** | |
| info | 获取 Core 服务信息 |
| license-info | 获取许可信息 |
| service-status | 获取服务状态 |
| upload-license | 上传网关许可 |
| **Gateway 服务功能接口，前缀 /gateway/** | |
| alias | 获取网关名称 |
| update-alias | 修改网关名称 |
| reboot | 网关硬件重启 |
| restart | 重启所有服务 |
| restart-service | 重启 Core 服务 |
| shut-down | 网关关机 |
| internet-connection | 获取网关网络状态 |
| time | 获取网关当前时间 |
| sync-time | 同步网关时间 |
| time-zone | 获取网关时区 |
| time-zones | 获取时区选项 |
| update-time-zone | 修改网关时区 |
| network-adapters | 获取网关网络适配器列表 |
| lan | 获取有线网设置 |
| update-lan | 修改网关有线网设置 |
| wifi | 获取无线网设置 |
| update-wifi | 修改无线网设置 |
| search-wifi | 搜索无线网 |
| connect-wifi | 连接无线网 |
| disconnect-wifi | 断开无线网 |
| static-routing | 获取静态路由设置 |
| update-static-routing | 修改静态路由设置 |
| connect-remote-host | 连接远程服务器 |
| disconnect-remote-host | 断开远程服务器 |
| file-server-items | 获取网关文件服务器列表 |
| delete-file-server-item | 删除网关文件服务器项目 |

---

#### RPC 示例

##### 示例 1（Default 模式 — sendFile 发送文件）

在 Default 模式下，要发送 ASCII 编码的文件内容"fileContent"到 machineID 为 1010 的机台的 Dir/Prog 目录下，保存为 2222，应使用请求主题："request/1"，其中 1 为自定义请求标识。

请求报文：

```json
{
  "method": "sendFile",
  "params": {
    "machineID": "1010",
    "fileName": "2222",
    "dirAtCNC": "Dir/Prog",
    "data": {
      "content": "fileContent",
      "encoding": "us-ascii"
    }
  }
}
```

回复主题"response/1"，回复报文：

```json
{
  "errorCode": 0,
  "errorMsg": "Success"
}
```

其中 machineID, fileName, dirAtCNC 为 HTTP 接口 2.6.6. sendFile 发送文件至机台 URL 中的请求参数，直接嵌入"params"字段里。POST 请求的请求体应嵌入"params"内的"data"字段中。

##### 示例 2（Default 模式 — writeOffsetData 写入刀补数据）

在 Default 模式下，要写入刀补号为 1 的刀补数据，应使用请求主题："request/2"，其中 2 为自定义请求标识。

请求报文：

```json
{
  "method": "writeOffsetData",
  "params": {
    "machineID": "1010",
    "offsetNum": 1,
    "data": {
      "toolNose": 3,
      "lengthWear": 0.0001,
      "radiusWear": 0.03,
      "lengthGeom": 0.0,
      "radiusGeom": 0.002
    }
  }
}
```

回复主题"response/2"，回复报文：

```json
{
  "errorCode": 0,
  "errorMsg": "Success"
}
```

其中 machineID, offsetNum 为 HTTP 接口 2.5.1.14. writeOffsetData 写入刀补数据 URL 中的参数，直接嵌入"params"字段里。POST 请求的请求体应嵌入"params"内的"data"字段中。

---

## 五、数据库通讯

启用数据库通讯，并开启目标机台/机组的自动采集任务（详见《说明书》5.3.1. 添加机台下的各类型机台的任务设置，以及 5.4.1.2. 机组任务设置）后，网关将自动采集任务结果写入到指定数据库。当前支持的数据库类型包括：InfluxDB v2.x、MySQL、SQL Server、PostgreSQL 等。用户可以参照《说明书》5.6.4. 数据库配置的说明配置数据库服务。

数据库表名为**[表前缀][数据类]**的形式，其中表前缀在网关通讯配置页设置，详见《说明书》5.6.4. 数据库配置；数据库表名称与 MQTT 通讯中的数据类 `type` 相同（详见 1.2. 数据说明）。如下为未设置表前缀、保存模式为日志模式时，数据库各表名（示例）：

| 表名 |
|------|
| alarmhistory |
| alarmlog |
| cncstatus |
| count |
| currenttoolnumber |
| cycle |
| energyconsum |
| feedandspindle |
| groupcount |
| groupcumulative... |
| groupoee |
| load |
| loghistory |
| machine |
| oee |
| offset |
| plc |
| position |
| programblock |
| programinfo |
| timedata |
| toollife |

数据库各表中的字段与对应数据类 `type` 中的数据标签 tag 和数据字段 field 相同（详见 1.2. 数据说明）。以表 `cncStatus` 为例，其表字段包括：

| 字段名 | 数据类型 |
|--------|----------|
| id | BIGINT（自动递增） |
| cncStatus | TEXT |
| adjustedStatus | TEXT |
| alarmStatus | TEXT |
| alarmLevel | TEXT |
| offTime | BIGINT |
| waitTime | BIGINT |
| emergencyTime | BIGINT |
| autoRunTime | BIGINT |
| manualTime | BIGINT |
| channel | VARCHAR(128) |
| machineID | VARCHAR(128) |
| time | DATETIME |
| uid | VARCHAR(128) |

---

## 六、模拟机台测试

若需要在没有实际连接机床的情况下快速测试通讯协议，可在网关管理页面**机台配置**中添加模拟机台，设置本地 IP：127.0.0.X，其机台 ID 与从站 ID 默认为 X，X 可设置为 1~255（详见《说明书》5.3. 机台配置）。激活该机台并打开其自动采集选项。在首页重启服务，即可测试 HTTP 协议。如需测试更多通讯协议，请在网关管理页面**通讯配置**中启用对应通讯并配置通讯参数，在首页重启服务，即可测试。实际使用时，请删除模拟机台，以避免从站 ID 冲突。

---

## 七、常见问题

### 7.1 HTTP 通讯时，返回"无法访问此网站（ERR_CONNECTION_REFUSED）"

请检查当前使用的计算机能否访问网关管理页面。如果不能，请检查网关是否开机，当前计算机与网关的网络连接是否正常。

---

### 7.2 HTTP 通讯时，返回"errorCode":3

请使用网关管理页面的**接口测试**功能检查网关与机台之间的通讯。（详见《说明书》5.8. 接口测试）。如在**接口测试**页"选择机台"右侧下拉框找不到目标设备，说明该设备未被添加或激活。请参照《说明书》5.3. 机台配置添加与激活机台。完成设置后，必须在**主页**点击**重启服务**。

如在**接口测试**页"选择机台"处找到了目标设备，点击**读取设备**，返回"读取失败"，请根据"读取失败"下方的"故障排查"提示处理。

---

### 7.3 MODBUS 或 MQTT 通讯时，没有收到任何数据

请检查机台的自动采集设置（详见《说明书》5.3. 机台配置）。完成设置后，必须在**主页**点击**重启服务**。

请检查任务配置（详见《说明书》5.5. 任务配置）。完成设置后，必须在**主页**点击**重启服务**。

如仍然无法收到任何数据，请按照 6.2. 所述步骤处理。

---

### 7.4 MODBUS 通讯时，在给定的地址位无法获取有效数据

常见原因是 MODBUS 客户端设置问题，此设置为基于 0 位，而不是基于 1 位。网关的 MODBUS 服务端是基于 0 位的，如果客户端基于 1 位，地址位应加 1。测试时，推荐使用 Modbus Poll 软件获取地址位数据，在设置地址位范围时**不要勾选"(Base 1)"**，即设置为基于 0 位。

有部分型号系统软件版本较低的 CNC，不支持部分采集内容，这些内容对应的地址位数据保持为 0。

---

### 7.5 使用任意通讯协议，可以收到机台数据，但收不到机组数据

请检查机组是否正确激活以及是否开启了机组任务设置（详见《说明书》5.4. 机组配置）。完成设置后，必须在**主页**点击**重启服务**。

请检查任务配置（详见《说明书》5.5. 任务配置）。完成设置后，必须在**主页**点击**重启服务**。

---

### 7.6 使用接口查看文件列表，或者接收/发送/删除文件时失败，同时网关程序传输页可以正常使用

路径或文件名中有特殊符号或空格等不安全字符，需要转换成 url 编码。如：

- 路径 `TNC:\nc_prog` 应转为 `TNC%3A%5Cnc_prog`
- `Sinumerik/FileSystem/Part Program` 应转为 `Sinumerik%2FFileSystem%2FPart%20Program`

一般情况下，大部分浏览器和测试工具会自动转换 url 编码，但在一些软件中调用接口时，仍需要手动转换。

---

## 版本变更历史记录

| 版本号 | 变更日期 | 变更描述 | 发布时间 |
|--------|----------|----------|----------|
| 1.3.5 | 20211227 | 1. 所有警报时间结果由精确到秒改为精确到毫秒。<br>2. 移除 HTTP 接口 ReadPosition 中的 decPoint。<br>3. 修改 HTTP 接口 ReadProgramList，增加返回量 dirAtCNC 与 subDirs，保留原返回 programs 结构不变，继承对旧版接口的支持。<br>4. 新增 Modbus 协议输出地址位 40260 运行程序段顺序号。<br>5. 新增 Modbus 协议输出地址位 40500 累计产量。 | 20211227 |
| 1.4.1 | 20220215 | 1. 新增 MODBUS 协议与 MQTT 协议 GroupCount，GroupOEE，OEE 等相关输出量。<br>2. MODBUS 协议输出量分为机台相关数据与机组相关数据。<br>3. 补充 MQTT 协议说明。<br>4. 修正 MQTT 协议中 AxisData 部分的错误信息。<br>5. 新增五、虚拟机床测试。 | 20220215 |
| 1.4.2 | 20220315 | 1. 修正 MODBUS 与 MQTT 协议部分输出数据类型。<br>2. 修正 CNC 状态，CNC 运行状态，警报状态的表述。<br>3. 增加新的一章，常见问题。<br>4. 修正常见错误中的部分说明。 | 20220219 |
| 1.4.3 | 20220328 | 1. 修订部分文字内容。 | 20220328 |
| 1.5.0 | 20220420 | 1. 更改 HTTP 协议中刀补相关的接口。<br>2. 更改 MQTT 协议报文内容结构。<br>3. MQTT 协议数据种类原 AxisData 拆分为 FeedAndSpindle，Load，和 Position。<br>4. MQTT 协议 AlarmHistory 改为警报历史。<br>5. MQTT 协议 CurrentToolNumber 关键字更改。<br>6. 新增文件传输相关错误代码。<br>7. 修订部分文字内容。 | 20220420 |
| 1.5.1 | 20220426 | 1. 更改 OEE 监控设置相关说明。 | 20220426 |
| 1.5.2 | 20220509 | 1. 负载数据 axialLoad 与 spindleLoad 类型由 Int32 变为 Float。<br>2. 增加 HTTP 接口 /readPlcData，增加 MODBUS 与 MQTT 输出 PLC 数据。<br>3. 增加 HTTP 接口 api/analysis/oee。<br>4. MQTT 通讯增加引用网关名称相关内容，增加引用自定义机组名称内容。<br>5. 移除多通道相关内容。 | 20220509 |
| 1.5.3 | 20220531 | 1. 更改 HTTP 接口 /readPlcData 的输入量。<br>2. 新增 CNC 状态"调机：试运行"。 | 20220531 |
| 1.5.4 | 20220617 | 1. 以下 HTTP 接口名称变动，地址不变：1.5.CNC 系统时间数据改为机台时间数据；1.6.CNC 状态改为机台状态；1.14.CNC 本地程序列表改为机台本地程序列表；1.15.接收 CNC 文件改为接收机台文件；1.16.发送文件至 CNC 改为发送文件至机台；1.17.删除 CNC 本地文件改为删除机台本文件；1.18.锁定/解锁 CNC 本地程序编辑改为锁定/解锁机台本地程序编辑。<br>2. 修订机台 OEE，机组 OEE 相关描述。 | 20220617 |
| 1.5.5 | 20220619 | 1. 由于《说明书》改动，修改引用《说明书》位置。<br>2. 修订一、HTTP 通讯中文件传输相关接口的描述。<br>3. 新增 MQTT 通讯 RPC 接口相关内容 3.3.RPC 接口。 | 20220624 |
| 1.5.6 | 20220713 | 1. 由于《说明书》改动，修改引用《说明书》位置。<br>2. 增加程序传输的文件服务器类型的说明。修改了 Fanuc [0i-D, 0i-F, 30i, 31i, 32i, PMi] 的默认目录路径。<br>3. 修改 HTTP 接口 /readPlcData 说明。 | 20220727 |
| 1.5.7 | 20220803 | 1. HTTP 接口 /readPlcData 新增 String 类型数据支持说明。<br>2. 新增 RPC 接口 /readCurrentProgram。<br>3. 新增数据库通讯相关内容。<br>4. 修复 MODBUS 输出轴名称错误的问题。 | 20220808 |
| 1.5.8 | 20220817 | 1. 新增 HTTP 接口 /readProgramBlock。新增该接口对应的 MODBUS，MQTT，以及数据库通讯相关内容。<br>2. 新增 HTTP 接口 /api/analysis/alarm。 | 20220915 |
| 1.5.9 | 20220921 | 1. 在 MODBUS，MQTT，数据库通讯中，新增累计警报数。 | 20220921 |
| 1.6.0 | 20221031 | 1. 修改 HTTP 接口 /readPlcData 返回结果，原所有数据类型均返回 UInt16 数组，改为按照用户输入的数据类型返回对应数据。<br>2. 移除 HTTP 接口 /readPlcData 对数据类型 Char 的支持。如需获取 Char 数据类型，用户可以获取 Byte 类型数据后自行转换。<br>3. 修改 HTTP 接口 /readPlcData 对 String 类型的支持。当类型为 String 时，Count 表示要读取的数据的最大长度（Byte 数）。<br>4. 在 HTTP 接口 /readPlcData 集成获取机台宏变量（本地变量，公共变量等）支持。<br>5. 在 MODBUS，MQTT，数据库通讯中，新增机台累计状态时间和机组累计状态时间。<br>6. 所有 MODBUS 通讯映射地址位长度调整以扩充容量。PLC 数据映射地址由原 4000 改为 20000，长度由原 1000 改为 10000。<br>7. 新增 MODBUS 通讯对 64 位型格式数据支持。<br>8. 调整 MQTT 通讯中 PLC 数据标签与内容。<br>9. 调整 RPC 请求与回复时间格式。<br>10. 新增 RPC 接口 /analysisOEE，/analysisAlarm。<br>11. 新增机台状态 MANUAL_RAPID。 | 20221031 |
| 1.6.1 | 20221111 | 1. 修改 HTTP 接口 /readOffsetData 与 /writeOffsetData，新增可选输入量 ToolNum 以支持西门子机床刀补读写。<br>2. 修订 RPC 接口说明。 | 20221111 |
| 1.6.2 | 20221209 | 1. 新增 HTTP 接口 /writePlcData。<br>2. 新增 RPC 接口 /readPlcData 与 /writePlcData。<br>3. Modbus，MQTT，数据库通讯新增上传数据变量当前加工计数 CurrentCount 与主轴过载时间 OverLoadS\<i\>。<br>4. 新增 MQTT 通讯中 PLC 数据对任务命令中设置的标签名的支持。 | 20221209 |
| 1.7.0 | 20221212 | 1. 修改 HTTP 接口 /writePlcData，/writeOffsetData 等请求体结构。<br>2. 修改 HTTP 接口 /readOffsetData 回复结构。<br>3. 修改 RPC 接口 /writePlcData，/writeOffsetData，/sendFile 等请求报文结构。 | 20221212 |
| 1.7.5 | 20230310 | 1. 修改 HTTP 与 RPC 接口 /readAlarm，增加输出内容警报级别 alarmLevel。<br>2. 在 MODBUS，MQTT，数据库中为数据 Alarm 增加变量警报级别。<br>3. 在 MQTT，数据库中为 AlarmHistory 增加变量警报级别。<br>4. 在 MODBUS，MQTT，数据库中新增机台累计警报时间，使用前需要激活机台警报信息任务。<br>5. 在 MODBUS，MQTT，数据库中新增机台节拍数据，使用前需要激活机台节拍数据任务。<br>6. 修改 HTTP 与 RPC 接口 /readPlcData 与 /writePlcData，支持部分型号机台以变量名形式读取与写入。<br>7. 新增 HTTP 接口 /api/analysis/count。<br>8. 新增更多 RPC 接口支持，现在所有 HTTP 接口都有对应的 RPC 接口。 | 20230310 |
| 1.8.0 | 20230512 | 1. 修正三菱系统 CNC 默认根目录路径。<br>2. 新增 HTTP 与 RPC 接口 /readToolLife 与 /readToolLifeDetails，原接口 /readToolOffset 中寿命相关变量移入新接口。<br>3. 修正 /sendFile 与 /receiveFile 中关键词 content 为 Content。<br>4. 新增接口 group-analysis/oee，group-analysis/alarm，group-analysis/count，group-analysis/overall，analysis/overall。<br>5. 接口 /readProgramInfo 新增 programStack 变量。<br>6. 调整 HTTP 通讯各接口顺序，将 HTTP 接口分为状态读写，文件传输，与数据分析三类。 | 20230512 |
| 1.8.1 | 20230619 | 1. 从 /readAlarm 接口移除 alarmTime。MODBUS，数据库，MQTT 中的 alarmLog 移除 alarmTime。<br>2. 现在要获取机台的警报起始时间，可以通过 HTTP 或 RPC 接口 analysis/alarm 获取。或根据 alarmHistory 中警报的激活/解激记录计算时间。 | 20230619 |
| 1.8.2 | 20230620 | 1. MODBUS，数据库，MQTT 中的 alarmHistory 移除 alarmTime。 | 20230620 |
| 1.9.0 | 20230621 | 1. 改动 MQTT 通讯数据上报报文格式，改动后仍兼容旧版本除 OverLoadS 与 Plc 以外的所有数据类。<br>2. MQTT 通讯协议新增数据类 AxialOverLoad。<br>3. MQTT 通讯协议修改数据类 OverLoadS 为 SpindleOverLoad。改动后不再兼容旧版本 OverLoadS 数据类。<br>4. Modbus 新增地址位，包括快速进给倍率，与第 1 至第 18 轴累计过载时间。<br>5. Modbus 调整地址位，包括主轴负载，与主轴累计过载时间。 | 20230621 |
| 1.9.1 | 20230625 | 1. MQTT 通讯协议修改数据类 Plc 为 PLC。改动后不再兼容旧版本 Plc 数据类。 | 20230625 |
| 1.9.2 | 20230628 | 1. HTTP，MODBUS，MQTT，数据库等通讯方式新增当前刀补支持。 | 20230628 |
| 1.9.3 | 20230710 | 1. 移除数据库通讯按机台写入相关内容。旧版本按机台写入模式在新版本中将会以日志模式运行。（说明书）<br>2. 补充 MQTT 通讯下的 ToolLife 与 ToolLifeDetails 数据类。<br>3. 新增接口 /createDir 与 /deleteDir。<br>4. 新增机台状态 MANUAL_SINGLE_BLOCK（调机状态：单段运行）。 | 20230710 |
| 1.10.0 | 20230822 | 1. 新增 HTTP 与 RPC 接口 /readFeed，适用于 CNC 和激光切割机，获取进给数据。<br>2. 新增 HTTP 与 RPC 接口 /readEnergyConsumption，适用于 CNC，获取能耗数据。<br>3. 新增 HTTP 与 RPC 接口 /readLaserPower，适用于激光切割机，获取激光切割机预设功率与实际功率数据。<br>4. 新增 MODBUS，MQTT，数据库等通讯方式对激光切割机激光功率数据的支持。<br>5. 修正 MODBUS 机组数据地址错误。每组数据地址位相差 100 而不是 1000。<br>6. 新增部分 HTTP 与 RPC 接口对多通道系统的支持。<br>7. 修改 Modbus 通讯，原 3000 及以后的地址位调整为 1000 及以后。 | 20230822 |
| 1.11.0 | 20230906 | 1. 调整部分 RPC 数据分析相关接口，使其与 HTTP 相关接口一致。<br>2. 新增 /receiveFile 与 /sendFile 接口对二进制文件的支持。 | 20230906 |
| 1.12.0 | 20230926 | 1. 新增 HTTP 和 RPC 接口 /readTaskData，从网关缓存中获取对应任务的最近一次数据。<br>2. 数据分析接口新增分组间隔支持。所有分析接口输出新增变量 StartTime 和 EndTime。 | 20230926 |
| 1.13.0 | 20231023 | 1. 新增 HTTP 与 RPC 接口 /batchReadOffsetData，/bathReadToolLife，/bathReadToolLifeDetails。 | 20231023 |
| 1.14.0 | 20231101 | 1. 新增 HTTP 与 RPC 接口 /readTaskData，/bathReadTaskData，/readGroupTaskData。<br>2. 修正接口 /readTimeData 中对广数机床能获取到数据的错误描述。补充了新支持设备系统型号的说明。<br>3. 修改了 /readPlcData 与 /writePlcData 中请求 area 的格式。<br>4. 修改章节一、HTTP 通讯中接口说明的格式。<br>5. 修改章节 3.1. 数据上报报文格式中的内容。 | 20231101 |
| 1.15.0 | 20231128 | 1. 新增 HTTP 与 RPC 接口 /bathReadGroupTaskData。<br>2. /readPlcData 接口新增 Siemens 西门子[通用型]对 S7 标签支持说明的说明。<br>3. /readTimeData 接口新增返回参数 remainingCycleTimeMin 与 remainingCycleTimeMs。<br>4. 新增了 Kede 科德机床相关说明。<br>5. /readProgramInfo，/readProgramBlock 接口说明，新增请求参数 channel 支持。<br>6. 更正了数据上报报文 type 中 Position 的拼写错误。<br>7. 修正了文件传输接口中，关键词首字母大写的问题。现在所有接口的关键词首字母均为小写。<br>8. 修改 Modbus 通讯中轴名称的地址位长度为 2，以支持最多 4 个字符的轴名。<br>9. 在 MODBUS 通讯与 MQTT 通讯中补充外部 PLC 任务数据相关内容。 | 20231128 |
| 1.15.1 | 20231206 | 1. 修订部分说明内容。 | 20240202 |
| 1.15.2 | 20231218 | 1. 新增 HTTP 接口 /sendFileStream 和 /receiveFileStream 接口以支持大文件传输。 | 20240204 |
| 1.15.3 | 20231226 | 1. 所有文件传输接口新增 subDir 参数支持。<br>2. HTTP 与 RPC 接口 /ToolLife 接口的 rawRemainingCount，rawPrewarningRemainingCount 类型由 Double 改为 Int32。 | 20240204 |
| 1.15.5 | 20240122 | 1. 更新文件传输接口支持系统型号相关表格。 | 20240204 |
| 1.15.7 | 20240120 | 1. 修改 Fanuc [0i-D, 0i-F, 30i, 31i, 32i, 35i, PMi] 的默认目录路径为 //CNC_MEM/。 | 20240204 |
| 1.16.0 | 20240130 | 1. HTTP 接口，RPC 接口，MQTT 与数据库中的机组号 groupNum 被替代为机组标识 groupID。 | 20240205 |
| 1.16.1 | 20240221 | 1. 调整文档内容结构，新增章节《一、重要说明》，将各通讯方式通用的说明内容移入新章节。其它章节序号随应调整。<br>2. 新增数据类 AxialLoad：伺服轴负载，LaserPower：激光功率，Offset：刀补数据，SpindleLoad：主轴负载。<br>3. 部分数据类增加新标签 channel 通道号。 | 20240221 |
| 1.16.2 | 20240304 | 1. HTTP 接口，RPC 接口新增接口分类，历史数据接口，包括 machine 机台历史数据和 group-machine 机组内所有机台历史数据。<br>2. 数据读写接口中的 readTaskData 读取机台任务数据，batchReadTaskData 批量读取机台任务数据，readGroupTaskData 读取机组任务数据，batchReadGroupTaskData 批量读取机组任务数据，新增返回参数 time 数据的获取时间。<br>3. MQTT 通讯，新增 MQTT 模式 IoTDA 相关说明。<br>4. 调整 readPlcData 读取 PLC 数据与 writePlcData 写入 PLC 数据接口相关内容，新增部分支持机床系统说明。 | 20240304 |
| 1.16.3 | 20240308 | 1. HTTP 接口，RPC 接口中的文件传输接口分类，新增接口 backupFiles 备份机台文件。 | 20240308 |
| 1.16.4 | 20240308 | 1. HTTP 接口，RPC 接口中的文件传输接口分类，新增接口 batchSendFile 批量发送文件至机台。 | 20240308 |
| 1.16.5 | 20240308 | 1. HTTP 接口，RPC 接口中的文件传输接口分类，新增接口 batchDeleteFile 批量删除机台文件。 | 20240308 |
| 1.17.0 | 20240315 | 1. 修改批量处理任务接口 batchReadOffsetData，batchReadToolLife，batchReadToolLifeDetails 的返回体，现在如果某条请求失败时，返回体数组对应位置为其错误信息。 | 20240315 |
| 1.17.1 | 20240319 | 1. 新增 HTTP 接口，RPC 接口：batchReadErrors 批量读取机台连接状态。 | 20240319 |
| 1.17.2 | 20240319 | 1. 新增 HTTP 接口，RPC 接口：selectProgram 选择程序。 | 20240319 |
| 1.17.3 | 20240329 | 1. 移除 Cycle：节拍数据中不再使用的字段 runningPrgName。<br>2. readPlcData 接口，如果获取的 Double 类型数值为 double.Nan，原先会转为 double.Min 输出，现在支持直接输出 double.Nan。 | 20240329 |
| 1.17.5 | 20240401 | 1. 移除 Cycle：节拍数据中不再使用的字段 runningPrgName。<br>2. CNCStatus：机台状态数据中，新增字段 adjustedStatus。 | 20240401 |
| 1.17.6 | 20240416 | 1. 新增 HTTP 接口，RPC 接口：readAllPrograms 浏览所有文件。此接口用于获取指定路径下所有的程序名及其路径，包括子文件夹下的（如果机台支持切换目录）。<br>2. 新增 MAZAK 马扎克机床刀具补偿刀具寿命相关说明。 | 20240416 |
| 1.18.0 | 20240429 | 1. 调整部分文档内容。 | 20240429 |
| 1.18.1 | 20240614 | 1. 新增网关功能接口与配置接口。<br>2. 新增 ID 数据库标识说明。<br>3. 修正接口 batchDeleteFile 批量删除机台文件内容。 | 20240614 |
| 1.18.8 | 20241108 | 1. 新增机台配置接口中的大量字段。<br>2. 修正机台配置接口中的 taskEnergy 的拼写错误。<br>3. 新增获取机台状态监控设置接口的部分字段。 | 20241108 |
| 1.19.1 | 20250514 | 1. Fanuc 型号 PMi 改为 Power Motion i-A。<br>2. 修复失效超链接。<br>3. 更新刀具寿命数据标签组合表。<br>4. 新增以下接口：/core/restart，/config/settings，/config/update-settings，/config/update-security，/config/remote-access，/config/update-remote-access，/gateway/alias，/gateway/update-alias，/gateway/time，/gateway/sync-time，/gateway/time-zone，/gateway/update-time-zone，/gateway/system-locale，/gateway/update-system-locale，/gateway/lan，/gateway/update-lan，/gateway/wifi，/gateway/update-wifi，/gateway/search-wifi，/gateway/connect-wifi，/gateway/disconnect-wifi，/gateway/static-routing，/gateway/update-static-routing，/gateway/connect-remote-host，/gateway/disconnect-remote-host，/gateway/list-file-server-items，/gateway/delete-file-server-item，/gateway/network-adapters，/api/cnc/readLog。<br>5. 调整部分机台配置接口的变量名与顺序。 | 20250514 |
| 1.19.2 | 20250603 | 1. 新增以下接口：/config/batch-delete-machines，/config/batch-delete-groups，/analysis/cycle，/group-analysis/cycle。<br>2. 原机台任务 alarm 警报信息，拆分为 alarm 当前警报与 alarmhistory 警报历史。<br>3. 调整部分机台配置接口的变量名与顺序。<br>4. 移除过载监控设置中的变量 monitorOverloadInterval，在机台任务间隔设置中新增变量 readOverloadInterval 代替。 | 20250603 |
| 1.19.3 | 20251222 | 1. 修正错误描述：readCount 读取加工计数接口，返回响应，数据 count 的类型，修正为 Int32。<br>2. 移除不再使用的数据类 AxialLoad 伺服轴负载类与 SpindleLoad 主轴负载类。如需相关数据，应使用数据类 Load 负载数据。<br>3. 合并数据类 ToolLife 刀具寿命与 ToolLifeDetails 刀具寿命详情类。<br>4. 新增鉴权方式与鉴权接口说明。<br>5. 修订接口分类，文件传输接口更名为文件管理接口。<br>6. 新增接口：readErrorSummary 读取状态简报，searchFile 搜索机台文件。<br>7. 新增数据类型 LogHistory 日志历史，新增相应机台任务。<br>8. 从 MQTT 设置参数中移除已失效参数，UseGatewayAlias 引用网关名，和 KeepAliveInterval 保活周期。<br>9. 机台配置参数新增 numberOfTasks 启用的任务数，自定义状态相关参数，自定义警报相关参数，自定义加工计数相关参数。<br>10. 更新刀具补偿数据标签组合表。<br>11. 更新刀具寿命数据标签组合表。<br>12. 新增接口 remote-access 获取远程访问设置与 update-remote-access 修改远程访问设置。<br>13. ReadPlcData 接口，WritePlcData 接口，新增请求参数 Channel（通道号）支持。<br>14. 修改以下接口：/api/gateway/wifi，/api/gateway/update-wifi，/api/gateway/search-wifi，/api/config/gateway-info，/api/config/cloud-settings，/api/config/update-cloud-settings。<br>15. 新增接口 /core/license-info。 | 20251222 |
| 1.19.4 | 20260211 | 1. 鉴权方式修改，原 API Key 方式改为 Secret Key 方式。<br>2. 原机台任务 Cumulative Status Time 累计状态时间合并入 Machine Status 机台状态任务，获取机台状态的同时自动累计时间。<br>3. Cycle 节拍数据新增变量 LastTotalTime 上次节拍总时间。<br>4. /api/analysis/cycle 机台节拍数据分析接口，/api/group-analysis/cycle 机组节拍数据分析接口，新增输出变量 StartTime 节拍开始时间。<br>5. 机组号由 1-8 扩展到 1-16。<br>6. 修订支持的 RPC 接口表。 | 20260211 |